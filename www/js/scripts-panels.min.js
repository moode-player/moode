/*!
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-MM-DD TC moOde 7.0.0
 *
 */
jQuery(document).ready(function(e){"use strict";null!=window.ui_notify&&ui_notify(),GLOBAL.scriptSection="panels",e("#config-back").hide(),e("#config-tabs").css("display","none"),e("#menu-bottom").css("display","flex"),document.addEventListener("visibilitychange",function(){"visible"==document.visibilityState&&sendMpdCmd("subscribe dumy_channel")}),e(window).bind("resize",function(t){UI.mobile=e(window).width()<=480,getThumbHW()}),e("meta[name=viewport]").attr("content","height="+e(window).height()+", width="+e(window).width()+", initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),e.post("command/moode.php?cmd=updcfgsystem",{library_pixelratio:window.devicePixelRatio});var t=e("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");GLOBAL.sbw=t.width()-t[0].clientWidth,e("body").get(0).style.setProperty("--sbw",GLOBAL.sbw+"px"),GLOBAL.sbw&&e("body").addClass("custom-scrollbars"),"loading"in HTMLImageElement.prototype&&(GLOBAL.nativeLazyLoad=!0),e.getJSON("command/moode.php?cmd=read_cfgs",function(t){SESSION.json=t.cfg_system,THEME.json=t.cfg_theme,RADIO.json=t.cfg_radio,"viewport"==SESSION.json.pkgid_suffix&&notify("viewport",window.innerWidth+"x"+window.innerHeight,1e4),currentView=SESSION.json.current_view,UI.mobile=e(window).width()<480,getThumbHW(),loadLibrary(),mpdDbCmd("lsinfo",""),mpdDbCmd("lsinfo_radio"),UI.radioPos=parseInt(SESSION.json.radio_pos);var a=SESSION.json.lib_pos.split(",");UI.libPos[0]=parseInt(a[0]),UI.libPos[1]=parseInt(a[1]),UI.libPos[2]=parseInt(a[2]),e("#volume, #volume-2").attr("data-max",SESSION.json.volume_mpd_max),GLOBAL.mpdMaxVolume=parseInt(SESSION.json.volume_mpd_max),setFontSize();var s=SESSION.json.first_use_help.split(",");function o(t){t.forEach(function(t){e("#alpha-blend span").text()<1?e("#cover-options").show():e("#cover-options").css("display","")})}"y"==s[0]&&e("#playback-firstuse-help").css("display","block"),"y"==s[1]&&e("#playbar-firstuse-help").css("display","block"),"None"!=SESSION.json.library_ignore_articles&&(GLOBAL.regExIgnoreArticles=new RegExp("^("+SESSION.json.library_ignore_articles.split(",").join("|")+") (.*)","gi")),"ontouchstart"in window||navigator.msMaxTouchPoints||e("body").addClass("no-touch"),themeColor=str2hex(THEME.json[SESSION.json.themename].tx_color),themeBack="rgba("+THEME.json[SESSION.json.themename].bg_color+","+SESSION.json.alphablend+")",themeMcolor=str2hex(THEME.json[SESSION.json.themename].tx_color),"No"==SESSION.json.adaptive&&document.body.style.setProperty("--adaptmbg",themeBack),1==blurrr?themeOp=.85:themeOp=.95,jQuery(document).ready(function(){var e=document.querySelector("#alpha-blend span");new MutationObserver(o).observe(e,{characterData:!0,attributes:!1,childList:!0,subtree:!1})}),tempcolor=THEME.json[SESSION.json.themename].mbg_color.split(","),themeMback="rgba("+tempcolor[0]+","+tempcolor[1]+","+tempcolor[2]+","+themeOp+")",accentColor=themeToColors(SESSION.json.accent_color),document.body.style.setProperty("--themetext",themeMcolor),adaptColor=themeColor,adaptBack=themeBack,adaptMhalf=themeMback,adaptMcolor=themeMcolor,adaptMback=themeMback,tempback=themeMback,abFound=!1,showMenuTopW=!1,showMenuTopR=!1,setColors(),e(".ralbum").html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M475.31 364.144L288 256l187.31-108.144c5.74-3.314 7.706-10.653 4.392-16.392l-4-6.928c-3.314-5.74-10.653-7.706-16.392-4.392L272 228.287V12c0-6.627-5.373-12-12-12h-8c-6.627 0-12 5.373-12 12v216.287L52.69 120.144c-5.74-3.314-13.079-1.347-16.392 4.392l-4 6.928c-3.314 5.74-1.347 13.079 4.392 16.392L224 256 36.69 364.144c-5.74 3.314-7.706 10.653-4.392 16.392l4 6.928c3.314 5.74 10.653 7.706 16.392 4.392L240 283.713V500c0 6.627 5.373 12 12 12h8c6.627 0 12-5.373 12-12V283.713l187.31 108.143c5.74 3.314 13.079 1.347 16.392-4.392l4-6.928c3.314-5.74 1.347-13.079-4.392-16.392z"/></svg>'),engineMpd(),engineCmd(),e.pnotify.defaults.history=!1,UI.mobile||e("#playbtns, #togglebtns").show(),"Animated"==SESSION.json.scnsaver_style?(e("#ss-style").css("background",""),e("#ss-style").css("animation","colors2 60s infinite"),e("#ss-style, #ss-backdrop").css("display","")):"Theme"==SESSION.json.scnsaver_style?e("#ss-style, #ss-backdrop").css("display","none"):"Gradient (Linear)"==SESSION.json.scnsaver_style?(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","linear-gradient(to bottom, rgba(0,0,0,0.15) 0%,rgba(0,0,0,0.60) 25%,rgba(0,0,0,0.75) 40%, rgba(0,0,0,.8) 60%, rgba(0,0,0,.9) 100%)"),e("#ss-style, #ss-backdrop").css("display","")):"Gradient (Radial)"==SESSION.json.scnsaver_style?(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","radial-gradient(circle at 50% center, rgba(64, 64, 64, .5) 5%, rgba(0, 0, 0, .85) 60%)"),e("#ss-style, #ss-backdrop").css("display","")):"Pure Black"==SESSION.json.scnsaver_style&&(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","rgba(0,0,0,1)"),e("#ss-style, #ss-backdrop").css("display","")),"Clock Radio"==SESSION.json.clkradio_mode||"Sleep Timer"==SESSION.json.clkradio_mode?(e("#clockradio-icon").removeClass("clockradio-off"),e("#clockradio-icon").addClass("clockradio-on")):(e("#clockradio-icon").removeClass("clockradio-on"),e("#clockradio-icon").addClass("clockradio-off")),"disabled"==SESSION.json.mpdmixer?(disableVolKnob(),SESSION.json.volknob="0",SESSION.json.volmute="0",e.post("command/moode.php?cmd=updcfgsystem",{volknob:"0",volmute:"0"})):(e("#volume").val(SESSION.json.volknob),e("#volume-2").val(SESSION.json.volknob),e(".volume-display").css("opacity",""),e(".volume-display div").text(SESSION.json.volknob)),"Yes"==SESSION.json.playhist?e("#playhistory-hide").css("display","block"):e("#playhistory-hide").css("display","none"),e("#tagview-header-text").text("Albums"+("Album"==SESSION.json.library_tagview_sort||"Album/Year"==SESSION.json.library_tagview_sort?"":" by "+SESSION.json.library_tagview_sort)),e("#artistheader > div").html("Album Artist +"==SESSION.json.library_tagview_artist?"Album Artists +":SESSION.json.library_tagview_artist+"s"),"Year"==SESSION.json.library_albumview_sort&&e("#index-albums, #index-albumcovers").hide(),SESSION.json.feat_bitmask&FEAT_RECORDER&&(e("#radio-manager-stream-recorder").show(),"Not installed"!=SESSION.json.recorder_status&&(e("#stream-recorder-options").show(),e("#context-menu-stream-recorder").show(),"On"==SESSION.json.recorder_status?(e(".playback-context-menu i").addClass("recorder-on"),e("#menu-check-recorder").css("display","inline")):(e(".playback-context-menu i").removeClass("recorder-on"),e("#menu-check-recorder").css("display","none")))),UI.mobile&&"Yes"==SESSION.json.library_show_genres&&e(function(){e("#top-columns").swipe({swipeLeft:function(t,a,s,o,n){e("#top-columns").animate({left:"-50%"},100)}}),e("#top-columns").swipe({swipeRight:function(t,a,s,o,n){e("#top-columns").animate({left:"0%"},100)}})}),e("#folder-panel, #radio-panel").removeClass("active"),-1!=currentView.indexOf("playback")?(e("#playback-panel").addClass("active"),e(window).scrollTop(0),UI.mobile?(e("#container-playlist").css("visibility","hidden"),e("#playback-controls").show()):customScroll("playlist",parseInt(MPD.json.song)),e("#menu-bottom").hide()):(e("#menu-bottom, #viewswitch").css("display","flex"),e("#playback-switch").hide()),"radio"==currentView?makeActive(".radio-view-btn","#radio-panel",currentView):"folder"==currentView?(makeActive(".folder-view-btn","#folder-panel","folder"),mpdDbCmd("lsinfo","")):"tag"==currentView?(makeActive(".tag-view-btn","#library-panel","tag"),"Yes"==SESSION.json.library_show_genres?e("#top-columns").removeClass("nogenre"):e("#top-columns").addClass("nogenre")):"album"==currentView&&makeActive(".album-view-btn","#library-panel","album")}),e(".radio-view-btn").click(function(e){makeActive(".radio-view-btn","#radio-panel","radio")}),e(".folder-view-btn").click(function(e){makeActive(".folder-view-btn","#folder-panel","folder")}),e(".tag-view-btn").click(function(t){makeActive(".tag-view-btn","#library-panel","tag"),"Yes"==SESSION.json.library_show_genres?e("#top-columns").removeClass("nogenre"):e("#top-columns").addClass("nogenre"),e("#albumsList .lib-entry").removeClass("active"),-2==UI.libPos[0]?(e("#lib-album").scrollTo(0,0),e("#lib-artist").scrollTo(0,0),UI.libPos[0]=-1,storeLibPos(UI.libPos)):-3==UI.libPos[0]&&(e("#albumsList .lib-entry").removeClass("active"),e("#lib-album").scrollTo(0,0),e("#lib-coverart-img").html('<a href="#notarget" data-toggle="context" data-target="#context-menu-lib-album"><img class="lib-coverart" src="'+UI.defCover+'"></a>'),e("#lib-albumname, #lib-artistname, #lib-albumyear, #lib-numtracks, #songsList").html(""),UI.libPos[0]=-1,storeLibPos(UI.libPos))}),e(".album-view-btn").click(function(t){e("#library-panel").addClass("covers").removeClass("tag"),GLOBAL.lazyCovers=!1,makeActive(".album-view-btn","#library-panel","album"),GLOBAL.libRendered||loadLibrary(),e("#albumcovers .lib-entry").removeClass("active"),-2!=UI.libPos[1]&&-3!=UI.libPos[1]||(e("#lib-albumcover").scrollTo(0,0),UI.libPos[1]=-1,storeLibPos(UI.libPos))}),e(".btn-clear-libcache").on("click",function(t){e.get("command/moode.php?cmd=clear_libcache_all"),notify("clear_libcache","Auto-refresh in 2 seconds"),setTimeout(function(){location.reload(!0)},2e3)}),e(".volume-display").on("click",function(e){if("disabled"==SESSION.json.mpdmixer)return!1;volMuteSwitch()}),e(document).on("click",".volume-popup-btn",function(t){"block"==e("#volume-popup").css("display")?e("#volume-popup").modal("toggle"):("disabled"==SESSION.json.mpdmixer&&e(".volume-display").css("opacity",".3"),e("#volume-popup").modal())}),e(".play").click(function(t){if("play"==MPD.json.state)if(e("#countdown-display").countdown("pause"),"http"==MPD.json.file.substr(0,4).toLowerCase())var a="Radio station"==MPD.json.artist?"stop":"pause";else a="pause";else if("pause"==MPD.json.state){e("#countdown-display").countdown("resume"),customScroll("playlist",parseInt(MPD.json.song),200);a="play"}else if("stop"==MPD.json.state){"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?e("#countdown-display").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}):e("#countdown-display").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),UI.mobile||customScroll("playlist",parseInt(MPD.json.song),200);a="play"}return window.clearInterval(UI.knob),sendMpdCmd(a),!1}),e(".next").click(function(t){var a=e(".playlist li").length==(parseInt(MPD.json.song)+1).toString()?"play 0":"next";return sendMpdCmd(a),!1}),e(".prev").click(function(t){e.getJSON("command/moode.php?cmd=getmpdstatus",function(e){return parseInt(MPD.json.time)>0&&parseInt(e.elapsed)>0?(window.clearInterval(UI.knob),"pause"!=MPD.json.state&&sendMpdCmd("pause"),setTimeout(function(){sendMpdCmd("seek "+MPD.json.song+" 0")},DEFAULT_TIMEOUT)):sendMpdCmd("previous"),!1})}),e("#volumeup,#volumeup-2").click(function(e){"1"==SESSION.json.volmute&&volMuteSwitch();var t=parseInt(SESSION.json.volknob),a=t<GLOBAL.mpdMaxVolume?t+1:GLOBAL.mpdMaxVolume;return setVolume(a,"volume_up"),!1}),e("#volumedn,#volumedn-2").click(function(e){"1"==SESSION.json.volmute&&volMuteSwitch();var t=parseInt(SESSION.json.volknob);return setVolume(t>0?t-1:0,"volune_down"),!1}),e(".btn-toggle").click(function(t){var a=e(this).data("cmd"),s=e(this).hasClass("btn-primary")?"0":"1";"random"==a&&"1"==SESSION.json.ashufflesvc?(e.get("command/moode.php?cmd=ashuffle",{ashuffle:s}),e(".random").toggleClass("btn-primary"),e(".consume").toggleClass("btn-primary"),sendMpdCmd("consume "+s)):("consume"==a&&e("#menu-check-consume").toggle(),e("."+a).toggleClass("btn-primary"),sendMpdCmd(a+" "+s))}),e(".playbackknob").knob({configure:{fgColor:accentColor},inline:!1,change:function(t){if("stop"!=MPD.json.state){window.clearInterval(UI.knob);var a=Math.floor(t*parseInt(MPD.json.time)/1e3);"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?e("#countdown-display").html(formatSongTime(a)):e("#countdown-display").html(formatSongTime(parseInt(MPD.json.time)-a))}else e("#time").val(0);UI.knobPainted=!1},release:function(t){if("stop"!=MPD.json.state){window.clearInterval(UI.knob);var a=Math.floor(t*parseInt(MPD.json.time)/1e3);sendMpdCmd("seek "+MPD.json.song+" "+a),"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?e("#countdown-display").countdown({since:-a,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}):e("#countdown-display").countdown({until:a,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})}UI.knobPainted=!1}}),e(".volumeknob").knob({configure:{fgColor:accentColor},change:function(e){e=e>GLOBAL.mpdMaxVolume?GLOBAL.mpdMaxVolume:e,setVolume(e,"knob_change")}}),e("#playback-panel").hasClass("newui")&&e(".playbackknob, .volumeknob").trigger("configure",{thickness:".09"}),e("#countdown-display, #m-countdown").click(function(t){"Radio station"!=MPD.json.artist&&("1"==SESSION.json.timecountup?SESSION.json.timecountup="0":SESSION.json.timecountup="1",e.post("command/moode.php?cmd=updcfgsystem",{timecountup:SESSION.json.timecountup}),e.getJSON("command/moode.php?cmd=getmpdstatus",function(t){"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?updKnobStartFrom(parseInt(t.elapsed),MPD.json.state):updKnobStartFrom(parseInt(MPD.json.time-parseInt(t.elapsed)),MPD.json.state),e("#total").html(formatSongTime(MPD.json.time))}))}),e(".playlist, .cv-playlist").on("click",".pl-entry",function(t){if(GLOBAL.plActionClicked)GLOBAL.plActionClicked=!1;else{var a=e(this).parent().hasClass("playlist")?".playlist":".cv-playlist",s=e(a+" .pl-entry").index(this);sendMpdCmd("play "+s),e(this).parent().addClass("active")}}),e(".playlist").on("click",".pl-action",function(t){if(GLOBAL.plActionClicked=!0,UI.dbEntry[0]=e(".playlist .pl-action").index(this),"<i"==e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").html().substr(0,2)){var a=(s=e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").html()).substr(s.indexOf("</i>")+4);UI.dbEntry[5]=a.trim()}else{var s,o=e("#pl-"+(UI.dbEntry[0]+1)+" .pll1").html().trim(),n=(s=e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").text()).substr(0,s.indexOf("-")-1);UI.dbEntry[5]=o+", "+n}}),e("#pl-btnSave").click(function(t){var a=e("#pl-saveName").val();a?~a.indexOf("NAS")||~a.indexOf("RADIO")||~a.indexOf("SDCARD")?notify("plnameerror"):(e.get("command/moode.php?cmd=savepl&plname="+a),notify("savepl")):notify("needplname")}),e("#savepl-modal").on("shown.bs.modal",function(t){e("#pl-saveName").focus()}),e("#pl-btnSetFav").click(function(t){var a=e("#pl-favName").val();a?~a.indexOf("NAS")||~a.indexOf("RADIO")||~a.indexOf("SDCARD")?notify("plnameerror"):(e.get("command/moode.php?cmd=setfav&favname="+a),notify("favset")):notify("needplname")}),e("#setfav-modal").on("shown.bs.modal",function(){e("#pl-favName").focus()}),e(".addfav").click(function(t){e(".addfav i").addClass("pulse"),e(".addfav i").addClass("fas"),setTimeout(function(){e(".addfav i").removeClass("fas"),e(".addfav i").removeClass("pulse")},1e3),null!=MPD.json.file?(e.get("command/moode.php?cmd=addfav&favitem="+encodeURIComponent(MPD.json.file)),notify("favadded")):notify("nofavtoadd")}),e("#lib-artistname").click(function(t){e("#artistsList .lib-entry").filter(function(){return e(this).text()==e("#lib-artistname").text()}).click(),customScroll("artists",UI.libPos[2],200)}),e("#playback-panel").click(function(t){e("#playback-panel").hasClass("cv")&&t.preventDefault()}),e("#currentartist").click(function(t){if(!e("#playback-panel").hasClass("cv"))if("Radio station"==MPD.json.artist){var a=0;e(".database-radio li").each(function(t){if(e(this).hasClass("horiz-rule-radioview")&&(a+=1),e(this).children("span").text()==RADIO.json[MPD.json.file].name)return UI.radioPos=t+1,!1}),currentView="playback,radio",e("#playback-switch").click(),e(".radio-view-btn").hasClass("active")||e(".radio-view-btn").click(),e(".database-radio li").removeClass("active"),setTimeout(function(){e("#ra-"+(UI.radioPos-a)).addClass("active"),UI.dbEntry[3]="ra-"+(UI.radioPos-a),customScroll("radio",UI.radioPos,200)},DEFAULT_TIMEOUT)}else{var s=-1!=e(this).text().indexOf("...")?e(this).text().slice(0,-3):e(this).text();e("#playback-switch").click(),e(".tag-view-btn").click(),e("#artistsList .lib-entry").filter(function(){return e(this).text()==s}).click(),customScroll("artists",UI.libPos[2],200)}}),e(".database").on("click",".db-browse",function(t){if(e(this).hasClass("db-folder")||e(this).hasClass("db-savedplaylist")){var a=e(this).hasClass("db-folder")?"lsinfo":"listsavedpl";UI.dbEntry[3]=e(this).parent().attr("id"),UI.dbPos[UI.dbPos[10]]=e(this).parent().attr("id").replace("db-",""),++UI.dbPos[10],mpdDbCmd(a,e(this).parent().data("path"))}}),e(".database").on("click",".db-action, .db-album, .db-song",function(t){e("#db-"+UI.dbPos[UI.dbPos[10]].toString()).removeClass("active"),UI.dbEntry[0]=e(this).parent().attr("data-path"),UI.dbEntry[3]=e(this).parent().attr("id"),e("#db-search-results").css("font-weight","normal"),e(this).parent().addClass("active")}),e("#db-back").click(function(t){if(e("#db-search-results").hide(),e("#dbfs").val(""),UI.dbPos[10]>0){--UI.dbPos[10];var a=(s=UI.path).lastIndexOf("/");if(-1!=a)var s=s.slice(0,a);else s="";mpdDbCmd("lsinfo",s),0==UI.dbPos[10]&&UI.dbPos.fill(0)}}),e("#db-home").click(function(t){e("#db-search-results").hide(),e("#dbfs").val(""),UI.dbPos.fill(0),UI.path="",mpdDbCmd("lsinfo","")}),e("#db-refresh").click(function(e){UI.dbCmd="lsinfo"!=UI.dbCmd&&"listsavedpl"!=UI.dbCmd?"lsinfo":UI.dbCmd,UI.dbPos[UI.dbPos[10]]=0,"lsinfo"!=UI.dbCmd&&"listsavedpl"!=UI.dbCmd||mpdDbCmd(UI.dbCmd,UI.path)}),e("#db-search-submit").click(function(t){var a="";""!=e("#dbsearch-alltags").val()?(a=e("#dbsearch-alltags").val().trim(),"folder"==currentView?e.post("command/moode.php?cmd=search&tagname=any",{query:a},function(e){renderFolderView(e,"",a)},"json"):"tag"!=currentView&&"album"!=currentView||(a="(any contains '"+a+"')",applyLibFilter("tags",a))):(a+=""==e("#dbsearch-genre").val()?"":" AND (genre contains '"+e("#dbsearch-genre").val().trim()+"')",a+=""==e("#dbsearch-artist").val()?"":" AND (artist contains '"+e("#dbsearch-artist").val().trim()+"')",a+=""==e("#dbsearch-album").val()?"":" AND (album contains '"+e("#dbsearch-album").val().trim()+"')",a+=""==e("#dbsearch-title").val()?"":" AND (title contains '"+e("#dbsearch-title").val().trim()+"')",a+=""==e("#dbsearch-albumartist").val()?"":" AND (albumartist contains '"+e("#dbsearch-albumartist").val().trim()+"')",a+=""==e("#dbsearch-date").val()?"":" AND (date contains '"+e("#dbsearch-date").val().trim()+"')",a+=""==e("#dbsearch-composer").val()?"":" AND (composer contains '"+e("#dbsearch-composer").val().trim()+"')",a+=""==e("#dbsearch-conductor").val()?"":" AND (conductor contains '"+e("#dbsearch-conductor").val().trim()+"')",a+=""==e("#dbsearch-performer").val()?"":" AND (performer contains '"+e("#dbsearch-performer").val().trim()+"')",a+=""==e("#dbsearch-work").val()?"":" AND (work contains '"+e("#dbsearch-work").val().trim()+"')",a+=""==e("#dbsearch-comment").val()?"":" AND (comment contains '"+e("#dbsearch-comment").val().trim()+"')",""!=(a+=""==e("#dbsearch-file").val()?"":" AND (file contains '"+e("#dbsearch-file").val().trim()+"')")&&(a=a.slice(5),"folder"==currentView?e.post("command/moode.php?cmd=search&tagname=specific",{query:a},function(e){renderFolderView(e,"",a)},"json"):"tag"!=currentView&&"album"!=currentView||applyLibFilter("tags",a)))}),e("#db-search-reset").click(function(t){e("#dbsearch-alltags, #dbsearch-genre, #dbsearch-artist, #dbsearch-album, #dbsearch-title, #dbsearch-albumartist, #dbsearch-date, #dbsearch-composer, #dbsearch-conductor, #dbsearch-performer, #dbsearch-comment, #dbsearch-file").val(""),e("#dbsearch-alltags").focus()}),e("#dbsearch-modal").on("shown.bs.modal",function(){e("#db-search-results").css("font-weight","normal"),e(".database li").removeClass("active"),e("#dbsearch-alltags").focus()}),e("#db-search-results").click(function(t){e(".database li").removeClass("active"),e("#db-search-results").css("font-weight","bold"),dbFilterResults=[],e(".database li").each(function(){e(this).children("div").hasClass("db-song")&&dbFilterResults.push(e(this).attr("data-path"))})}),e("#context-menu-db-search-results a").click(function(t){e("#db-search-results").css("font-weight","normal"),"add_group"==e(this).data("cmd")&&(mpdDbCmd("add_group",dbFilterResults),notify(e(this).data("cmd"))),"play_group"==e(this).data("cmd")&&(mpdDbCmd("play_group",dbFilterResults),notify(e(this).data("cmd"))),"clear_play_group"==e(this).data("cmd")&&(mpdDbCmd("clear_play_group",dbFilterResults),notify(e(this).data("cmd")))}),e("#ra-refresh").click(function(t){mpdDbCmd("lsinfo_radio"),lazyLode("radio"),e("#database-radio").scrollTo(0,200),UI.radioPos=-1,storeRadioPos(UI.radioPos),e("#searchResetRa").hide(),showSearchResetRa=!1}),e("#ra-new").click(function(t){e("#new-station-name").val("New station"),e("#new-station-url").val("http://"),e("#new-logoimage").val(""),e("#preview-new-logoimage").html(""),e("#info-toggle-new-logoimage").css("margin-left","unset"),e("#new-station-tags").css("margin-top","0"),e("#new-station-type span").text("Regular"),e("#new-station-genre").val(""),e("#new-station-broadcaster").val(""),e("#new-station-language").val(""),e("#new-station-country").val(""),e("#new-station-region").val(""),e("#new-station-bitrate").val(""),e("#new-station-format").val(""),e("#new-station-geo-fenced span").text("No"),e("#newstation-modal").modal()}),e("#newstation-modal").on("shown.bs.modal",function(){e("#new-station-name").focus()}),e("#ra-filter").keyup(function(t){showSearchResetRa||(e("#searchResetRa").show(),showSearchResetRa=!0),clearTimeout(searchTimer);var a=this;searchTimer=setTimeout(function(){var t=e(a).val().trim();""==t&&(e("#searchResetRa").hide(),showSearchResetRa=!1),e(".database-radio li").each(function(){e(this).text().search(new RegExp(t,"i"))<0?e(this).hide():(e(this).show(),0)});lazyLode("radio"),e("#database-radio").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetRa").click(function(t){e(".database-radio li").css("display","inline-block"),e("#searchResetRa").hide(),showSearchResetRa=!1}),e("#pl-filter").keyup(function(t){showSearchResetPl||(e("#searchResetPl").show(),showSearchResetPl=!0),clearTimeout(searchTimer);var a=this;searchTimer=setTimeout(function(){var t=e(a).val().trim();""==t&&(e("#searchResetPl").hide(),showSearchResetPl=!1),e(".playlist li").each(function(){e(this).text().search(new RegExp(t,"i"))<0?e(this).hide():(e(this).show(),0)});e("#container-playlist").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetPl").click(function(t){e("#searchResetPl").hide(),showSearchResetPl=!1,e(".playlist li").css("display","block")}),e("#lib-album-filter").on("keydown keyup",function(t){if("keyup"==t.type&&t.preventDefault(),e("#lib-album-filter").val().length>0?e("#searchResetLib").show():e("#searchResetLib").hide(),"Enter"==t.key&&e("#lib-album-filter").val().length>0){e("#lib-album-filter").blur();var a=e(this).val().trim().toLowerCase(),s=splitStringAtFirstSpace(a);1==s.length&&(s[1]=""),GLOBAL.allFilters.includes(s[0])?GLOBAL.twoArgFilters.includes(s[0])?applyLibFilter(s[0],s[1]):applyLibFilter(s[0]):applyLibFilter("any",s[0]+(s[1]?" "+s[1]:"")),e("#viewswitch").click()}}),e("#searchResetLib").click(function(t){return t.preventDefault(),document.getElementById("lib-album-filter").focus(),e("#lib-album-filter").val(""),e("#searchResetLib").hide(),!1}),e("#ph-filter").keyup(function(t){showSearchResetPh||(e("#searchResetPh").show(),showSearchResetPh=!0),clearTimeout(searchTimer);var a=this;searchTimer=setTimeout(function(){var t=e(a).val().trim(),s=0;e(".playhistory li").each(function(){e(this).text().search(new RegExp(t,"i"))<0?e(this).hide():(e(this).show(),s++)});var o=1==s?"":"s";""!=t?e("#ph-filter-results").html(+s+"&nbsp;item"+o):e("#ph-filter-results").html(""),e("#container-playhistory").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetPh").click(function(t){e("#searchResetPh").hide(),showSearchResetPh=!1,e(".playhistory li").css("display","list-item"),e("#ph-filter-results").html("")}),e(".database-radio").on("click",".cover-menu",function(t){var a=e(this).parents("li").index(),s=e(this).parents("li").data("path");UI.dbEntry[0]=s,UI.radioPos=a,storeRadioPos(UI.radioPos),e("#"+UI.dbEntry[3]).removeClass("active"),UI.dbEntry[3]=e(this).parents("li").attr("id"),e(this).parents("li").addClass("active")}),e(".btn-del-savedpl").click(function(e){mpdDbCmd("delsavedpl",UI.dbEntry[0]),notify("delsavedpl")}),e("#btn-create-station").click(function(t){""==e("#new-station-name").val().trim()||""==e("#new-station-url").val().trim()?notify("blankentries","Station not created"):mpdDbCmd("newstation",{name:e("#new-station-name").val(),url:e("#new-station-url").val(),type:getParamOrValue("value",e("#new-station-type span").text()),genre:e("#new-station-genre").val(),broadcaster:e("#new-station-broadcaster").val(),language:e("#new-station-language").val(),country:e("#new-station-country").val(),region:e("#new-station-region").val(),bitrate:e("#new-station-bitrate").val(),format:e("#new-station-format").val(),geo_fenced:e("#new-station-geo-fenced span").text(),reserved1:"NULL",reserved2:"NULL"})}),e("#btn-update-station").click(function(t){""==e("#edit-station-name").val().trim()||""==e("#edit-station-url").val().trim()?notify("blankentries","Station not updated"):mpdDbCmd("updstation",{id:GLOBAL.editStationId,name:e("#edit-station-name").val(),url:e("#edit-station-url").val(),type:getParamOrValue("value",e("#edit-station-type span").text()),genre:e("#edit-station-genre").val(),broadcaster:e("#edit-station-broadcaster").val(),language:e("#edit-station-language").val(),country:e("#edit-station-country").val(),region:e("#edit-station-region").val(),bitrate:e("#edit-station-bitrate").val(),format:e("#edit-station-format").val(),geo_fenced:e("#edit-station-geo-fenced span").text(),reserved1:"NULL",reserved2:"NULL"})}),e("#btn-del-station").click(function(e){mpdDbCmd("delstation",UI.dbEntry[0])}),e(".btn-delete-plitem").click(function(t){var a="",s=e("#delete-plitem-begpos").val()-1,o=e("#delete-plitem-endpos").val()-1;a=s==o?"delplitem&range="+s:"delplitem&range="+s+":"+(o+1),notify("remove"),e.get("command/moode.php?cmd="+a)}),e("#btn-delete-setpos-top").click(function(t){return e("#delete-plitem-begpos").val(1),!1}),e("#btn-delete-setpos-bot").click(function(t){return e("#delete-plitem-endpos").val(UI.dbEntry[4]),!1}),e(".btn-move-plitem").click(function(t){var a="",s=e("#move-plitem-begpos").val()-1,o=e("#move-plitem-endpos").val()-1,n=e("#move-plitem-newpos").val()-1;a=s==o?"moveplitem&range="+s+"&newpos="+n:"moveplitem&range="+s+":"+(o+1)+"&newpos="+n,notify("move"),e.get("command/moode.php?cmd="+a)}),e("#btn-move-setpos-top").click(function(t){return e("#move-plitem-begpos").val(1),!1}),e("#btn-move-setpos-bot").click(function(t){return e("#move-plitem-endpos").val(UI.dbEntry[4]),!1}),e("#btn-move-setnewpos-top").click(function(t){return e("#move-plitem-newpos").val(1),!1}),e("#btn-move-setnewpos-bot").click(function(t){return e("#move-plitem-newpos").val(UI.dbEntry[4]),!1}),e(".ph-firstPage").click(function(t){e("#container-playhistory").scrollTo(0,200)}),e(".ph-lastPage").click(function(t){e("#container-playhistory").scrollTo("100%",200)}),e(".coverview").on("click",function(e){e.stopImmediatePropagation(),screenSaver("1")}),e("#cv-playlist-btn").on("click",function(t){e("#cv-playlist").toggle(),"block"==e("#cv-playlist").css("display")?(e("#cv-playlist ul").html(e("#playlist ul").html()),"Yes"==SESSION.json.playlist_art&&lazyLode("cv-playlist"),customScroll("cv-playlist",parseInt(MPD.json.song)),GLOBAL.playbarPlaylistTimer=setTimeout(function(){e("#cv-playlist ul").html(""),e("#cv-playlist").hide()},2e4)):(t.preventDefault(),e("#cv-playlist ul").html(""),window.clearTimeout(GLOBAL.playbarPlaylistTimer))}),e(document).on("click",".disconnect-renderer",function(t){var a=e(this).data("job");e.post("command/moode.php?cmd=disconnect-renderer",{job:a})}),e("#playback-firstuse-help").click(function(t){e("#playback-firstuse-help").css("display",""),SESSION.json.first_use_help="n,"+SESSION.json.first_use_help.split(",")[1],e.post("command/moode.php?cmd=updcfgsystem",{first_use_help:SESSION.json.first_use_help})}),e("#playbar-firstuse-help").click(function(t){e("#playbar-firstuse-help").css("display",""),SESSION.json.first_use_help=SESSION.json.first_use_help.split(",")[0]+",n",e.post("command/moode.php?cmd=updcfgsystem",{first_use_help:SESSION.json.first_use_help})}),e("#extra-tags-display").click(function(t){if(""!=e("#currentsong").html()){var a="Radio station"==MPD.json.artist?"station_info":"track_info";audioinfo(a,MPD.json.file)}}),e("#audioinfo-track").live("click",function(t){e("#audioinfo-modal").removeClass("hardware").addClass("track")}),e("#audioinfo-hardware").live("click",function(t){e("#audioinfo-modal").removeClass("track").addClass("hardware")}),e("#screen-saver, #playback-panel, #library-panel, #folder-panel, #radio-panel, #menu-bottom").click(function(t){"menu-bottom"!=e(this).attr("id")&&(coverView?(e("body").removeClass("cv"),coverView=!1,setColors(),e("#cv-playlist ul").html(""),e("#cv-playlist").hide(),e("#lib-coverart-img").show(),UI.mobile?e("#playback-queue").css("width","99.9%"):e("#playback-queue").css("width","38.1%"),setTimeout(function(){e("#playback-queue").css("width","")},DEFAULT_TIMEOUT),"Yes"==SESSION.json.playlist_art&&lazyLode("playlist"),customScroll("playlist",parseInt(MPD.json.song))):"Never"!=SESSION.json.scnsaver_timeout&&setTimeout(function(){e.get("command/moode.php?cmd=resetscnsaver")},3e3))}),e(".info-toggle").click(function(t){var a="#"+e(this).data("cmd");e(a).hasClass("hide")?e(a).removeClass("hide"):e(a).addClass("hide")})});
