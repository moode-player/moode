/*!
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-MM-DD TC moOde 7.0.0
 *
 */
jQuery(document).ready(function(e){"use strict";GLOBAL.scriptSection="panels",e("#config-back").hide(),e("#config-tabs").css("display","none"),e("#menu-bottom").css("display","flex"),e("meta[name=viewport]").attr("content","height="+e(window).height()+", width="+e(window).width()+", initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"),e.post("command/moode.php?cmd=updcfgsystem",{library_pixelratio:window.devicePixelRatio});var t=e("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),s=t.width()-t[0].clientWidth;e("body").get(0).style.setProperty("--sbw",s+"px"),s&&e("body").addClass("custom-scrollbars"),"loading"in HTMLImageElement.prototype&&(GLOBAL.nativeLazyLoad=!0),e.getJSON("command/moode.php?cmd=read_cfgs",function(t){SESSION.json=t.cfg_system,THEME.json=t.cfg_theme,RADIO.json=t.cfg_radio,"viewport"==SESSION.json.pkgid_suffix&&notify("viewport",window.innerWidth+"x"+window.innerHeight,1e4),currentView=SESSION.json.current_view,setLibraryThumbnailCols(SESSION.json.library_thumbnail_columns.substring(0,1)),loadLibrary(),mpdDbCmd("lsinfo",""),mpdDbCmd("lsinfo_radio"),UI.radioPos=parseInt(SESSION.json.radio_pos);var s=SESSION.json.lib_pos.split(",");UI.libPos[0]=parseInt(s[0]),UI.libPos[1]=parseInt(s[1]),UI.libPos[2]=parseInt(s[2]),UI.mobile=e(window).width()<480,e("#volume, #volume-2").attr("data-max",SESSION.json.volume_mpd_max),GLOBAL.mpdMaxVolume=parseInt(SESSION.json.volume_mpd_max),setFontSize();var a=SESSION.json.first_use_help.split(",");"y"==a[0]&&e("#playback-firstuse-help").css("display","block"),"y"==a[1]&&e("#playbar-firstuse-help").css("display","block"),"None"!=SESSION.json.library_ignore_articles&&(GLOBAL.regExIgnoreArticles=new RegExp("^("+SESSION.json.library_ignore_articles.split(",").join("|")+") (.*)","gi")),"ontouchstart"in window||navigator.msMaxTouchPoints||e("body").addClass("no-touch"),themeColor=str2hex(THEME.json[SESSION.json.themename].tx_color),themeBack="rgba("+THEME.json[SESSION.json.themename].bg_color+","+SESSION.json.alphablend+")",themeMcolor=str2hex(THEME.json[SESSION.json.themename].tx_color),"No"==SESSION.json.adaptive&&document.body.style.setProperty("--adaptmbg",themeBack),1==blurrr?themeOp=.85:themeOp=.95,e("#alpha-blend").on("DOMSubtreeModified",function(){e("#alpha-blend span").text()<1?e("#cover-options").show():e("#cover-options").css("display","")}),tempcolor=THEME.json[SESSION.json.themename].mbg_color.split(","),themeMback="rgba("+tempcolor[0]+","+tempcolor[1]+","+tempcolor[2]+","+themeOp+")",accentColor=themeToColors(SESSION.json.accent_color),document.body.style.setProperty("--themetext",themeMcolor),adaptColor=themeColor,adaptBack=themeBack,adaptMhalf=themeMback,adaptMcolor=themeMcolor,adaptMback=themeMback,tempback=themeMback,abFound=!1,showMenuTopW=!1,showMenuTopR=!1,setColors(),e(".ralbum").html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M475.31 364.144L288 256l187.31-108.144c5.74-3.314 7.706-10.653 4.392-16.392l-4-6.928c-3.314-5.74-10.653-7.706-16.392-4.392L272 228.287V12c0-6.627-5.373-12-12-12h-8c-6.627 0-12 5.373-12 12v216.287L52.69 120.144c-5.74-3.314-13.079-1.347-16.392 4.392l-4 6.928c-3.314 5.74-1.347 13.079 4.392 16.392L224 256 36.69 364.144c-5.74 3.314-7.706 10.653-4.392 16.392l4 6.928c3.314 5.74 10.653 7.706 16.392 4.392L240 283.713V500c0 6.627 5.373 12 12 12h8c6.627 0 12-5.373 12-12V283.713l187.31 108.143c5.74 3.314 13.079 1.347 16.392-4.392l4-6.928c3.314-5.74 1.347-13.079-4.392-16.392z"/></svg>'),engineMpd(),engineCmd(),e.pnotify.defaults.history=!1,UI.mobile||e("#playbtns, #togglebtns").show(),"Animated"==SESSION.json.scnsaver_style?(e("#ss-style").css("background",""),e("#ss-style").css("animation","colors2 60s infinite"),e("#ss-style, #ss-backdrop").css("display","")):"Theme"==SESSION.json.scnsaver_style?e("#ss-style, #ss-backdrop").css("display","none"):"Gradient (Linear)"==SESSION.json.scnsaver_style?(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","linear-gradient(to bottom, rgba(0,0,0,0.15) 0%,rgba(0,0,0,0.60) 25%,rgba(0,0,0,0.75) 40%, rgba(0,0,0,.8) 60%, rgba(0,0,0,.9) 100%)"),e("#ss-style, #ss-backdrop").css("display","")):"Gradient (Radial)"==SESSION.json.scnsaver_style?(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","radial-gradient(circle at 50% center, rgba(64, 64, 64, .5) 5%, rgba(0, 0, 0, .85) 60%)"),e("#ss-style, #ss-backdrop").css("display","")):"Pure Black"==SESSION.json.scnsaver_style&&(e("#ss-style").css("animation","initial"),e("#ss-style").css("background","rgba(0,0,0,1)"),e("#ss-style, #ss-backdrop").css("display","")),"Clock Radio"==SESSION.json.clkradio_mode||"Sleep Timer"==SESSION.json.clkradio_mode?(e("#clockradio-icon").removeClass("clockradio-off"),e("#clockradio-icon").addClass("clockradio-on")):(e("#clockradio-icon").removeClass("clockradio-on"),e("#clockradio-icon").addClass("clockradio-off")),"disabled"==SESSION.json.mpdmixer?(disableVolKnob(),SESSION.json.volknob="0",SESSION.json.volmute="0",e.post("command/moode.php?cmd=updcfgsystem",{volknob:"0",volmute:"0"})):(e("#volume").val(SESSION.json.volknob),e("#volume-2").val(SESSION.json.volknob),e(".volume-display").css("opacity",""),e(".volume-display div").text(SESSION.json.volknob)),"Yes"==SESSION.json.playhist?e("#playhistory-hide").css("display","block"):e("#playhistory-hide").css("display","none"),e("#tagview-header-text").text("Albums"+("Album"==SESSION.json.library_tagview_sort||"Album/Year"==SESSION.json.library_tagview_sort?"":" by "+SESSION.json.library_tagview_sort)),"Year"==SESSION.json.library_albumview_sort&&e("#index-albums, #index-albumcovers").hide(),UI.mobile&&"Yes"==SESSION.json.library_show_genres&&e(function(){e("#top-columns").swipe({swipeLeft:function(){e("#top-columns").animate({left:"-50%"},100)}}),e("#top-columns").swipe({swipeRight:function(){e("#top-columns").animate({left:"0%"},100)}})}),e("#folder-panel, #radio-panel").removeClass("active"),-1!=currentView.indexOf("playback")?(e("#playback-panel").addClass("active"),e(window).scrollTop(0),UI.mobile?(e("#container-playlist").css("visibility","hidden"),e("#playback-controls").show()):setTimeout(function(){customScroll("playlist",parseInt(MPD.json.song))},DEFAULT_TIMEOUT),e("#menu-bottom").hide()):(e("#menu-bottom, #viewswitch").css("display","flex"),e("#playback-switch").hide()),"radio"==currentView?(makeActive(".radio-view-btn","#radio-panel",currentView),setTimeout(function(){UI.radioPos>=0&&customScroll("radio",UI.radioPos,200)},DEFAULT_TIMEOUT)):"folder"==currentView?(makeActive(".folder-view-btn","#folder-panel","folder"),mpdDbCmd("lsinfo","")):"tag"==currentView?(makeActive(".tag-view-btn","#library-panel","tag"),"Yes"==SESSION.json.library_show_genres?e("#top-columns").removeClass("nogenre"):e("#top-columns").addClass("nogenre"),!GLOBAL.libRendered,setTimeout(function(){UI.libPos[0]>=0&&(e("#albumsList .lib-entry").removeClass("active"),e("#albumsList .lib-entry").eq(UI.libPos[0]).addClass("active"),customScroll("albums",UI.libPos[0],200),e("#albumsList .lib-entry").eq(UI.libPos[0]).click())},DEFAULT_TIMEOUT)):"album"==currentView&&(makeActive(".album-view-btn","#library-panel","album"),!GLOBAL.libRendered,setTimeout(function(){UI.libPos[1]>=0&&(e("#albumcovers .lib-entry").removeClass("active"),e("#albumcovers .lib-entry").eq(UI.libPos[1]).addClass("active"),customScroll("albumcovers",UI.libPos[1],0))},DEFAULT_TIMEOUT))}),e(".radio-view-btn").click(function(){makeActive(".radio-view-btn","#radio-panel","radio"),setTimeout(function(){UI.radioPos>=0&&customScroll("radio",UI.radioPos,0)},DEFAULT_TIMEOUT)}),e(".folder-view-btn").click(function(){makeActive(".folder-view-btn","#folder-panel","folder"),mpdDbCmd("lsinfo","")}),e(".tag-view-btn").click(function(){makeActive(".tag-view-btn","#library-panel","tag"),"Yes"==SESSION.json.library_show_genres?e("#top-columns").removeClass("nogenre"):e("#top-columns").addClass("nogenre"),GLOBAL.libRendered||loadLibrary(),setTimeout(function(){UI.libPos[0]>=0?(e("#albumsList .lib-entry").removeClass("active"),e("#albumsList .lib-entry").eq(UI.libPos[0]).addClass("active"),customScroll("albums",UI.libPos[0],0)):-2==UI.libPos[0]?(e("#albumsList .lib-entry").removeClass("active"),e("#lib-album").scrollTo(0,0),e("#lib-artist").scrollTo(0,0),UI.libPos[0]=-1,storeLibPos(UI.libPos)):-3==UI.libPos[0]&&(e("#albumsList .lib-entry").removeClass("active"),e("#lib-album").scrollTo(0,0),e("#lib-coverart-img").html('<a href="#notarget" data-toggle="context" data-target="#context-menu-lib-album"><img class="lib-coverart" src="'+UI.defCover+'"></a>'),e("#lib-albumname, #lib-artistname, #lib-albumyear, #lib-numtracks, #songsList").html(""),UI.libPos[0]=-1,storeLibPos(UI.libPos))},DEFAULT_TIMEOUT)}),e(".album-view-btn").click(function(){e("#library-panel").addClass("covers").removeClass("tag"),GLOBAL.lazyCovers=!1,makeActive(".album-view-btn","#library-panel","album"),GLOBAL.libRendered||loadLibrary(),setTimeout(function(){UI.libPos[1]>=0?(e("#albumcovers .lib-entry").removeClass("active"),e("#albumcovers .lib-entry").eq(UI.libPos[1]).addClass("active"),customScroll("albumcovers",UI.libPos[1],0)):-2!=UI.libPos[1]&&-3!=UI.libPos[1]||(e("#albumcovers .lib-entry").removeClass("active"),e("#lib-albumcover").scrollTo(0,0),UI.libPos[1]=-1,storeLibPos(UI.libPos))},DEFAULT_TIMEOUT)}),e(".btn-clear-libcache").on("click",function(){e.get("command/moode.php?cmd=clear_libcache"),notify("clear_libcache","Auto-refresh in 2 seconds"),setTimeout(function(){location.reload(!0)},2e3)}),e(".volume-display").on("click",function(){return"disabled"==SESSION.json.mpdmixer?!1:void volMuteSwitch()}),e(document).on("click",".volume-popup-btn",function(){"block"==e("#volume-popup").css("display")?e("#volume-popup").modal("toggle"):("disabled"==SESSION.json.mpdmixer&&e(".volume-display").css("opacity",".3"),e("#volume-popup").modal())}),e(".play").click(function(){if("play"==MPD.json.state)if(e("#playbar-mcount").countdown("pause"),UI.mobile?e("#m-countdown").countdown("pause"):e("#countdown-display, #playbar-countdown").countdown("pause"),"http"==MPD.json.file.substr(0,4).toLowerCase())var t="Radio station"==MPD.json.artist?"stop":"pause";else var t="pause";else if("pause"==MPD.json.state){e("#playbar-mcount").countdown("resume"),UI.mobile?e("#m-countdown").countdown("resume"):(e("#countdown-display, #playbar-countdown, #playbar-mcount").countdown("resume"),customScroll("playlist",parseInt(MPD.json.song),200));var t="play"}else if("stop"==MPD.json.state){"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?(e("#countdown-display").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),e("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})):(e("#countdown-display").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),e("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})),UI.mobile||customScroll("playlist",parseInt(MPD.json.song),200);var t="play"}return window.clearInterval(UI.knob),sendMpdCmd(t),!1}),e(".next").click(function(){var t=e(".playlist li").length==(parseInt(MPD.json.song)+1).toString()?"play 0":"next";return sendMpdCmd(t),!1}),e(".prev").click(function(){e.getJSON("command/moode.php?cmd=getmpdstatus",function(e){return parseInt(MPD.json.time)>0&&parseInt(e.elapsed)>0?(window.clearInterval(UI.knob),refreshTimer(0,0,"stop"),sendMpdCmd("seek "+MPD.json.song+" 0"),"pause"!=MPD.json.state&&sendMpdCmd("pause")):sendMpdCmd("previous"),!1})}),e("#volumeup,#volumeup-2").click(function(){"1"==SESSION.json.volmute?volMuteSwitch():"";var e=parseInt(SESSION.json.volknob),t=e<GLOBAL.mpdMaxVolume?e+1:GLOBAL.mpdMaxVolume;return setVolume(t,"volume_up"),!1}),e("#volumedn,#volumedn-2").click(function(){"1"==SESSION.json.volmute?volMuteSwitch():"";var e=parseInt(SESSION.json.volknob),t=e>0?e-1:0;return setVolume(t,"volune_down"),!1}),e(".btn-toggle").click(function(){var t=e(this).data("cmd"),s=e(this).hasClass("btn-primary")?"0":"1";"random"==t&&"1"==SESSION.json.ashufflesvc?(e.get("command/moode.php?cmd=ashuffle",{ashuffle:s}),e(".random").toggleClass("btn-primary"),e(".consume").toggleClass("btn-primary"),sendMpdCmd("consume "+s)):("consume"==t&&e("#menu-check-consume").toggle(),e("."+t).toggleClass("btn-primary"),sendMpdCmd(t+" "+s))}),e(".playbackknob").knob({configure:{fgColor:accentColor},inline:!1,change:function(t){if("stop"!=MPD.json.state){window.clearInterval(UI.knob);var s=Math.floor(t*parseInt(MPD.json.time)/1e3);"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?e("#countdown-display").html(formatSongTime(s)):e("#countdown-display").html(formatSongTime(parseInt(MPD.json.time)-s))}else e("#time").val(0);UI.knobPainted=!1},release:function(t){if("stop"!=MPD.json.state){window.clearInterval(UI.knob);var s=Math.floor(t*parseInt(MPD.json.time)/1e3);sendMpdCmd("seek "+MPD.json.song+" "+s),"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?e("#countdown-display").countdown({since:-s,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}):e("#countdown-display").countdown({until:s,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})}UI.knobPainted=!1}}),e(".volumeknob").knob({configure:{fgColor:accentColor},change:function(e){e=e>GLOBAL.mpdMaxVolume?GLOBAL.mpdMaxVolume:e,setVolume(e,"knob_change")}}),e("#playback-panel").hasClass("newui")&&e(".playbackknob, .volumeknob").trigger("configure",{thickness:".09"}),e("#countdown-display, #m-countdown").click(function(){"Radio station"!=MPD.json.artist&&("1"==SESSION.json.timecountup?SESSION.json.timecountup="0":SESSION.json.timecountup="1",e.post("command/moode.php?cmd=updcfgsystem",{timecountup:SESSION.json.timecountup}),e.getJSON("command/moode.php?cmd=getmpdstatus",function(t){"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?(refreshTimer(parseInt(t.elapsed),parseInt(MPD.json.time),MPD.json.state),e("#total").html(formatSongTime(MPD.json.time)+'<i class="fas fa-caret-up countdown-caret"></i>')):(refreshTimer(parseInt(MPD.json.time-parseInt(t.elapsed)),0,MPD.json.state),e("#total").html(formatSongTime(MPD.json.time)+'<i class="fas fa-caret-down countdown-caret"></i>'))}))}),e(".playlist, .cv-playlist").on("click",".pl-entry",function(){if(GLOBAL.plActionClicked)return void(GLOBAL.plActionClicked=!1);var t=e(this).parent().hasClass("playlist")?".playlist":".cv-playlist",s=e(t+" .pl-entry").index(this);sendMpdCmd("play "+s),e(this).parent().addClass("active")}),e(".playlist").on("click",".pl-action",function(){if(GLOBAL.plActionClicked=!0,UI.dbEntry[0]=e(".playlist .pl-action").index(this),"<i"==e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").html().substr(0,2)){var t=e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").html(),s=t.substr(t.indexOf("</i>")+4);UI.dbEntry[3]=s.trim()}else{var a=e("#pl-"+(UI.dbEntry[0]+1)+" .pll1").html().trim(),t=e("#pl-"+(UI.dbEntry[0]+1)+" .pll2").text(),o=t.substr(0,t.indexOf("-")-1);UI.dbEntry[3]=a+", "+o}}),e("#pl-btnSave").click(function(){var t=e("#pl-saveName").val();t?~t.indexOf("NAS")||~t.indexOf("RADIO")||~t.indexOf("SDCARD")?notify("plnameerror"):(e.get("command/moode.php?cmd=savepl&plname="+t),notify("savepl")):notify("needplname")}),e("#savepl-modal").on("shown.bs.modal",function(){e("#pl-saveName").focus()}),e("#pl-btnSetFav").click(function(){var t=e("#pl-favName").val();t?~t.indexOf("NAS")||~t.indexOf("RADIO")||~t.indexOf("SDCARD")?notify("plnameerror"):(e.get("command/moode.php?cmd=setfav&favname="+t),notify("favset")):notify("needplname")}),e("#setfav-modal").on("shown.bs.modal",function(){e("#pl-favName").focus()}),e(".addfav").click(function(){e(".addfav i").addClass("pulse"),e(".addfav i").addClass("fas"),setTimeout(function(){e(".addfav i").removeClass("fas"),e(".addfav i").removeClass("pulse")},1e3),null!=MPD.json.file?(e.get("command/moode.php?cmd=addfav&favitem="+encodeURIComponent(MPD.json.file)),notify("favadded")):notify("nofavtoadd")}),e("#lib-artistname").click(function(){e("#artistsList .lib-entry").filter(function(){return e(this).text()==e("#lib-artistname").text()}).click(),customScroll("artists",UI.libPos[2],200)}),e("#playback-panel").click(function(t){e("#playback-panel").hasClass("cv")&&t.preventDefault()}),e("#currentalbum").click(function(){if(!e("#playback-panel").hasClass("cv"))if("Radio station"==MPD.json.artist){var t=0;e(".database-radio li").each(function(s){return e(this).hasClass("horiz-rule-radioview")&&(t+=1),e(this).children("span").text()==RADIO.json[MPD.json.file].name?(UI.radioPos=s+1,!1):void 0}),currentView="playback,radio",e("#playback-switch").click(),e(".radio-view-btn").hasClass("active")||e(".radio-view-btn").click(),e(".database-radio li").removeClass("active"),setTimeout(function(){e("#ra-"+(UI.radioPos-t)).addClass("active"),UI.dbEntry[3]="ra-"+(UI.radioPos-t)},DEFAULT_TIMEOUT)}else e("#playback-switch").click(),e(".tag-view-btn").click(),setTimeout(function(){e("#artistsList .lib-entry").filter(function(){return e(this).text()==MPD.json.artist}).click(),customScroll("artists",UI.libPos[2],200)},DEFAULT_TIMEOUT)}),e(".database").on("click",".db-browse",function(){if(e(this).hasClass("db-folder")||e(this).hasClass("db-savedplaylist")){var t=e(this).hasClass("db-folder")?"lsinfo":"listsavedpl";UI.dbEntry[3]=e(this).parent().attr("id"),UI.dbPos[UI.dbPos[10]]=e(this).parent().attr("id").replace("db-",""),++UI.dbPos[10],mpdDbCmd(t,e(this).parent().data("path"))}}),e(".database").on("click",".db-action",function(){UI.dbEntry[0]=e(this).parent().attr("data-path"),UI.dbEntry[3]=e(this).parent().attr("id"),e("#db-search-results").css("font-weight","normal"),e(".database li").removeClass("active"),e(this).parent().addClass("active")}),e("#db-back").click(function(){if(e("#db-search-results").hide(),e("#dbfs").val(""),UI.dbPos[10]>0){--UI.dbPos[10];var t=UI.path,s=t.lastIndexOf("/");if(-1!=s)var t=t.slice(0,s);else t="";mpdDbCmd("lsinfo",t),0==UI.dbPos[10]&&UI.dbPos.fill(0)}}),e("#db-home").click(function(){e("#db-search-results").hide(),e("#dbfs").val(""),UI.dbPos.fill(0),UI.path="",mpdDbCmd("lsinfo","")}),e("#db-refresh").click(function(){UI.dbCmd="lsinfo"!=UI.dbCmd&&"listsavedpl"!=UI.dbCmd?"lsinfo":UI.dbCmd,"lsinfo"!=UI.dbCmd&&"listsavedpl"!=UI.dbCmd||mpdDbCmd(UI.dbCmd,UI.path)}),e("#db-search-submit").click(function(){var t="";""!=e("#dbsearch-alltags").val()?(t=e("#dbsearch-alltags").val().trim(),e.post("command/moode.php?cmd=search&tagname=any",{query:t},function(e){renderFolderView(e,"",t)},"json")):(t+=""==e("#dbsearch-genre").val()?"":'genre "'+e("#dbsearch-genre").val().trim()+'"',t+=""==e("#dbsearch-artist").val()?"":' artist "'+e("#dbsearch-artist").val().trim()+'"',t+=""==e("#dbsearch-album").val()?"":' album "'+e("#dbsearch-album").val().trim()+'"',t+=""==e("#dbsearch-title").val()?"":' title "'+e("#dbsearch-title").val().trim()+'"',t+=""==e("#dbsearch-albumartist").val()?"":' albumartist "'+e("#dbsearch-albumartist").val().trim()+'"',t+=""==e("#dbsearch-date").val()?"":' date "'+e("#dbsearch-date").val().trim()+'"',t+=""==e("#dbsearch-composer").val()?"":' composer "'+e("#dbsearch-composer").val().trim()+'"',t+=""==e("#dbsearch-performer").val()?"":' performer "'+e("#dbsearch-performer").val().trim()+'"',t+=""==e("#dbsearch-comment").val()?"":' comment "'+e("#dbsearch-comment").val().trim()+'"',t+=""==e("#dbsearch-file").val()?"":' file "'+e("#dbsearch-file").val().trim()+'"',""!=t&&e.post("command/moode.php?cmd=search&tagname=specific",{query:t},function(e){renderFolderView(e,"",t)},"json"))}),e("#db-search-reset").click(function(){e("#dbsearch-alltags, #dbsearch-genre, #dbsearch-artist, #dbsearch-album, #dbsearch-title, #dbsearch-albumartist, #dbsearch-date, #dbsearch-composer, #dbsearch-performer, #dbsearch-comment, #dbsearch-file").val(""),e("#dbsearch-alltags").focus()}),e("#dbsearch-modal").on("shown.bs.modal",function(){e("#db-search-results").css("font-weight","normal"),e(".database li").removeClass("active"),e("#dbsearch-alltags").focus()}),e("#db-search-results").click(function(){e(".database li").removeClass("active"),e("#db-search-results").css("font-weight","bold"),dbFilterResults=[],e(".database li").each(function(){dbFilterResults.push(e(this).attr("data-path"))})}),e("#context-menu-db-search-results a").click(function(){e("#db-search-results").css("font-weight","normal"),"add_group"==e(this).data("cmd")&&(mpdDbCmd("add_group",dbFilterResults),notify(e(this).data("cmd"))),"play_group"==e(this).data("cmd")&&(mpdDbCmd("play_group",dbFilterResults),notify(e(this).data("cmd"))),"clear_play_group"==e(this).data("cmd")&&(mpdDbCmd("clear_play_group",dbFilterResults),notify(e(this).data("cmd")))}),e("#ra-refresh").click(function(){mpdDbCmd("lsinfo_radio"),setTimeout(function(){lazyLode("radio")},DEFAULT_TIMEOUT),setTimeout(function(){e("#database-radio").scrollTo(0,200)},DEFAULT_TIMEOUT),UI.radioPos=-1,storeRadioPos(UI.radioPos),e("#searchResetRa").hide(),showSearchResetRa=!1}),e("#ra-new").click(function(){e("#new-station-name").val("New station"),e("#new-station-url").val("http://"),e("#new-logoimage").val(""),e("#preview-new-logoimage").html(""),e("#info-toggle-new-logoimage").css("margin-left","unset"),e("#new-station-tags").css("margin-top","0"),e("#new-station-type span").text("Regular"),e("#new-station-genre").val(""),e("#new-station-broadcaster").val(""),e("#new-station-language").val(""),e("#new-station-country").val(""),e("#new-station-region").val(""),e("#new-station-bitrate").val(""),e("#new-station-format").val(""),e("#new-station-geo-fenced span").text("No"),e("#newstation-modal").modal()}),e("#newstation-modal").on("shown.bs.modal",function(){e("#new-station-name").focus()}),e("#ra-filter").keyup(function(){showSearchResetRa||(e("#searchResetRa").show(),showSearchResetRa=!0),clearTimeout(searchTimer);var t=this;searchTimer=setTimeout(function(){var s=e(t).val().trim(),a=0;""==s&&(e("#searchResetRa").hide(),showSearchResetRa=!1),e(".database-radio li").each(function(){e(this).text().search(new RegExp(s,"i"))<0?e(this).hide():(e(this).show(),a++)});lazyLode("radio"),e("#database-radio").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetRa").click(function(){e(".database-radio li").css("display","inline-block"),e("#searchResetRa").hide(),showSearchResetRa=!1}),e("#pl-filter").keyup(function(){showSearchResetPl||(e("#searchResetPl").show(),showSearchResetPl=!0),clearTimeout(searchTimer);var t=this;searchTimer=setTimeout(function(){var s=e(t).val().trim(),a=0;""==s&&(e("#searchResetPl").hide(),showSearchResetPl=!1),e(".playlist li").each(function(){e(this).text().search(new RegExp(s,"i"))<0?e(this).hide():(e(this).show(),a++)});e("#container-playlist").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetPl").click(function(){e("#searchResetPl").hide(),showSearchResetPl=!1,e(".playlist li").css("display","block")}),e("#lib-album-filter").keyup(function(t){t.preventDefault(),showSearchResetLib||(e("#searchResetLib").show(),showSearchResetLib=!0),clearTimeout(searchTimer);var s=e(this).val().trim();"Enter"==t.key||"!r"==s.slice(s.length-2)?(e("#lib-album-filter").blur(),e("#viewswitch").click(),"!r"==s.slice(s.length-2)&&(s=s.slice(0,s.length-2)),LIB.filters.year=s.split("-").map(Number),LIB.filters.year[0]?(LIB.recentlyAddedClicked=!1,LIB.filters.albums.length=0,e("#menu-header").text("Albums from "+LIB.filters.year[0]+(LIB.filters.year[1]?" to "+LIB.filters.year[1]:"")),GLOBAL.searchLib=e("#menu-header").text(),e(".view-recents span").hide(),e(".view-all span").hide(),UI.libPos.fill(-2),filterLib(),renderAlbums(),"album"==currentView&&(e("#bottom-row").css("display",""),e("#tracklist-toggle").html('<i class="fal fa-list sx"></i> Show tracks'))):LIB.filters.year=""):searchTimer=setTimeout(function(){var t=0;e(".albumslist li").each(function(){e(this).text().search(new RegExp(s,"i"))<0?e(this).hide():(e(this).show(),t++)}),e(".albumcovers li").each(function(){e(this).text().search(new RegExp(s,"i"))<0?e(this).hide():e(this).show()});""!=s&&(e("#menu-header").text(+t+" albums found"),GLOBAL.searchLib=e("#menu-header").text()),"tag"==currentView?lazyLode("tag"):(lazyLode("album"),e("#bottom-row").css("display",""),e("#tracklist-toggle").html('<i class="fal fa-list sx"></i> Show tracks')),e("#albumcovers .lib-entry").removeClass("active"),e("#albumsList .lib-entry").removeClass("active"),e("#lib-albumcover").css("height","100%"),UI.libPos.fill(-3)},DEFAULT_TIMEOUT),""==s&&(e("#searchResetLib").hide(),showSearchResetLib=!1,e("#searchResetLib").click())}),e("#searchResetLib").click(function(t){return t.preventDefault(),GLOBAL.searchLib="",setLibMenuHeader(),LIB.filters.albums.length=0,LIB.filters.year="",UI.libPos.fill(-2),storeLibPos(UI.libPos),clickedLibItem(void 0,void 0,LIB.filters.albums,renderAlbums),e("#searchResetLib").hide(),showSearchResetLib=!1,document.getElementById("lib-album-filter").focus(),!1}),e("#ph-filter").keyup(function(){showSearchResetPh||(e("#searchResetPh").show(),showSearchResetPh=!0),clearTimeout(searchTimer);var t=this;searchTimer=setTimeout(function(){var s=e(t).val().trim(),a=0;e(".playhistory li").each(function(){e(this).text().search(new RegExp(s,"i"))<0?e(this).hide():(e(this).show(),a++)});var o=1==a?"":"s";""!=s?e("#ph-filter-results").html(+a+"&nbsp;item"+o):e("#ph-filter-results").html(""),e("#container-playhistory").scrollTo(0,200)},SEARCH_TIMEOUT)}),e("#searchResetPh").click(function(){e("#searchResetPh").hide(),showSearchResetPh=!1,e(".playhistory li").css("display","list-item"),e("#ph-filter-results").html("")}),e(".database-radio").on("click",".cover-menu",function(){var t=e(this).parents("li").index(),s=e(this).parents("li").data("path");UI.dbEntry[0]=s,UI.radioPos=t,storeRadioPos(UI.radioPos),e("#"+UI.dbEntry[3]).removeClass("active"),UI.dbEntry[3]=e(this).parents("li").attr("id"),e(this).parents("li").addClass("active")}),e(".btn-del-savedpl").click(function(){mpdDbCmd("delsavedpl",UI.dbEntry[0]),notify("delsavedpl")}),e("#btn-create-station").click(function(){""==e("#new-station-name").val().trim()||""==e("#new-station-url").val().trim()?notify("blankentries","Station not created"):mpdDbCmd("newstation",{name:e("#new-station-name").val(),url:e("#new-station-url").val(),type:getParamOrValue("value",e("#new-station-type span").text()),genre:e("#new-station-genre").val(),broadcaster:e("#new-station-broadcaster").val(),language:e("#new-station-language").val(),country:e("#new-station-country").val(),region:e("#new-station-region").val(),bitrate:e("#new-station-bitrate").val(),format:e("#new-station-format").val(),geo_fenced:e("#new-station-geo-fenced span").text(),reserved1:"NULL",reserved2:"NULL"})}),e("#btn-update-station").click(function(){""==e("#edit-station-name").val().trim()||""==e("#edit-station-url").val().trim()?notify("blankentries","Station not updated"):mpdDbCmd("updstation",{id:GLOBAL.editStationId,name:e("#edit-station-name").val(),url:e("#edit-station-url").val(),type:getParamOrValue("value",e("#edit-station-type span").text()),genre:e("#edit-station-genre").val(),broadcaster:e("#edit-station-broadcaster").val(),language:e("#edit-station-language").val(),country:e("#edit-station-country").val(),region:e("#edit-station-region").val(),bitrate:e("#edit-station-bitrate").val(),format:e("#edit-station-format").val(),geo_fenced:e("#edit-station-geo-fenced span").text(),reserved1:"NULL",reserved2:"NULL"})}),e("#btn-del-station").click(function(){mpdDbCmd("delstation",UI.dbEntry[0])}),e(".btn-delete-plitem").click(function(){var t="",s=e("#delete-plitem-begpos").val()-1,a=e("#delete-plitem-endpos").val()-1;t=s==a?"delplitem&range="+s:"delplitem&range="+s+":"+(a+1),notify("remove"),e.get("command/moode.php?cmd="+t)}),e("#btn-delete-setpos-top").click(function(){return e("#delete-plitem-begpos").val(1),!1}),e("#btn-delete-setpos-bot").click(function(){return e("#delete-plitem-endpos").val(UI.dbEntry[4]),!1}),e(".btn-move-plitem").click(function(){var t="",s=e("#move-plitem-begpos").val()-1,a=e("#move-plitem-endpos").val()-1,o=e("#move-plitem-newpos").val()-1;t=s==a?"moveplitem&range="+s+"&newpos="+o:"moveplitem&range="+s+":"+(a+1)+"&newpos="+o,notify("move"),e.get("command/moode.php?cmd="+t)}),e("#btn-move-setpos-top").click(function(){return e("#move-plitem-begpos").val(1),!1}),e("#btn-move-setpos-bot").click(function(){return e("#move-plitem-endpos").val(UI.dbEntry[4]),!1}),e("#btn-move-setnewpos-top").click(function(){return e("#move-plitem-newpos").val(1),!1}),e("#btn-move-setnewpos-bot").click(function(){return e("#move-plitem-newpos").val(UI.dbEntry[4]),!1}),e(".ph-firstPage").click(function(){e("#container-playhistory").scrollTo(0,200)}),e(".ph-lastPage").click(function(){e("#container-playhistory").scrollTo("100%",200)}),e(".playback-context-menu").click(function(){var t=e(".consume").hasClass("btn-primary")?"var(--accentxts)":"inherit";e("#consume-menu-icon").css("color",t)}),e(".coverview").on("click",function(e){e.stopImmediatePropagation(),screenSaver("1")}),e("#cv-playlist-btn").on("click",function(t){e("#cv-playlist").toggle(),"block"==e("#cv-playlist").css("display")?(e("#cv-playlist ul").html(e("#playlist ul").html()),setTimeout(function(){"Yes"==SESSION.json.playlist_art&&lazyLode("cv-playlist"),customScroll("cv-playlist",parseInt(MPD.json.song))},DEFAULT_TIMEOUT),GLOBAL.playbarPlaylistTimer=setTimeout(function(){e("#cv-playlist ul").html(""),e("#cv-playlist").hide()},2e4)):(t.preventDefault(),e("#cv-playlist ul").html(""),window.clearTimeout(GLOBAL.playbarPlaylistTimer))}),e(document).on("click",".disconnect-renderer",function(){var t=e(this).data("job");e.post("command/moode.php?cmd=disconnect-renderer",{job:t})}),e("#screen-saver, #playback-panel, #library-panel, #folder-panel, #radio-panel, #menu-bottom").click(function(){"menu-bottom"!=e(this).attr("id")&&(coverView?(e("body").removeClass("cv"),coverView=!1,setColors(),e("#cv-playlist ul").html(""),e("#cv-playlist").hide(),e("#lib-coverart-img").show(),UI.mobile?e("#playback-queue").css("width","99.9%"):e("#playback-queue").css("width","38.1%"),setTimeout(function(){e("#playback-queue").css("width",""),"Yes"==SESSION.json.playlist_art&&lazyLode("playlist"),customScroll("playlist",parseInt(MPD.json.song))},DEFAULT_TIMEOUT)):"Never"!=SESSION.json.scnsaver_timeout&&setTimeout(function(){e.get("command/moode.php?cmd=resetscnsaver")},3e3))}),e("#playback-firstuse-help i").click(function(){e("#playback-firstuse-help").css("display","none"),e.post("command/moode.php?cmd=updcfgsystem",{first_use_help:"n,"+SESSION.json.first_use_help.split(",")[1]})}),e("#playbar-firstuse-help i").click(function(){e("#playbar-firstuse-help").css("display","none"),e.post("command/moode.php?cmd=updcfgsystem",{first_use_help:SESSION.json.first_use_help.split(",")[0]+",n"})}),e(".info-toggle").click(function(){var t="#"+e(this).data("cmd");e(t).hasClass("hide")?e(t).removeClass("hide"):e(t).addClass("hide")})});
