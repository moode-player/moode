/*!
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-MM-DD TC moOde 7.0.0
 *
 */
const FEAT_KERNEL=1,FEAT_AIRPLAY=2,FEAT_MINIDLNA=4,FEAT_RECORDER=8,FEAT_SQUEEZELITE=16,FEAT_UPMPDCLI=32,FEAT_SQSHCHK=64,FEAT_RESERVED1=128,FEAT_LOCALUI=256,FEAT_INPSOURCE=512,FEAT_UPNPSYNC=1024,FEAT_SPOTIFY=2048,FEAT_GPIO=4096,FEAT_DJMOUNT=8192,FEAT_BLUETOOTH=16384,FEAT_DEVTWEAKS=32768,DEFAULT_TIMEOUT=250,CLRPLAY_TIMEOUT=500,LAZYLOAD_TIMEOUT=500,SEARCH_TIMEOUT=750,RALBUM_TIMEOUT=500,ENGINE_TIMEOUT=3e3,ALBUM_HD_BADGE_TEXT="HD",ALBUM_BIT_DEPTH_THRESHOLD=16,ALBUM_SAMPLE_RATE_THRESHOLD=44100,RADIO_HD_BADGE_TEXT="HiRes",RADIO_BITRATE_THRESHOLD=128;var UI={knob:null,path:"",restart:"",currentFile:"blank",currentHash:"blank",currentSongId:"blank",defCover:"images/default-cover-v6.svg",knobPainted:!1,chipOptions:"",hideReconnect:!1,bgImgChange:!1,clientIP:"",dbPos:[0,0,0,0,0,0,0,0,0,0,0],dbEntry:["","","","",""],dbCmd:"",libPos:[-1,-1,-1],radioPos:-1,libAlbum:"",mobile:!1,npIcon:'url("../images/4band-npicon/audiod.svg")',npIconPaused:'url("../images/4band-npicon/audiod-flat.svg")',thumbHW:"0px"},MPD={json:0},SESSION={json:0},RADIO={json:0},THEME={json:0},NETWORK={json:0},GLOBAL={musicScope:"all",searchRadio:"",searchFolder:"",scriptSection:"panels",regExIgnoreArticles:"",libRendered:!1,libLoading:!1,playbarPlaylistTimer:"",plActionClicked:!1,mpdMaxVolume:0,lastTimeCount:0,editStationId:"",nativeLazyLoad:!1,playlistChanged:!1,initTime:0,oneArgFilters:["full_lib","hdonly","lossless","lossy"],twoArgFilters:["album","albumartist","any","artist","composer","conductor","encoded","file","folder","format","genre","label","performer","title","work","year"],allFilters:[]};GLOBAL.allFilters=GLOBAL.oneArgFilters.concat(GLOBAL.twoArgFilters);var themeColor,themeBack,themeMcolor,tempcolor,themeOp,themeMback,adaptColor,adaptBack,adaptMhalf,adaptMcolor,adaptMback,tempback,accentColor,abFound,showMenuTopW,showMenuTopR,alphabitsFilter,timeSliderMove=!1,thumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='3.5'/></svg>",thumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='3.5'/></svg>",fatthumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='5.5'/></svg>",fatthumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='5.5'/></svg>",blurrr=CSS.supports("-webkit-backdrop-filter","blur(1px)"),dbFilterResults=[],searchTimer="",showSearchResetPl=!1,showSearchResetRa=!1,showSearchResetPh=!1,eqGainUpdInterval="",toolbarTimer="",toggleSongId="blank",currentView="playback",lastYIQ="",coverView=!1;function debugLog(e){"1"==SESSION.json.debuglog&&console.log(Date.now()+": "+e)}function sendMpdCmd(e,t){void 0===t&&(t=!0),$.ajax({type:"GET",url:"command/index.php?cmd="+e,async:t,cache:!1,success:function(e){}})}function sendVolCmd(e,t,a,o){var s;return void 0===a&&(a=""),void 0===o&&(o=!1),$.ajax({type:e,url:"command/moode.php?cmd="+t,async:o,cache:!1,data:a,success:function(e){s=JSON.parse(e)},error:function(){s=!1}}),s}function engineMpd(){$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){try{MPD.json=JSON.parse(e)}catch(e){MPD.json.error=e}if(void 0===MPD.json.error)!0===UI.hideReconnect&&hideReconnect(),MPD.json.idle_timeout_event,"changed: update"==MPD.json.idle_timeout_event?void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide():"changed: mixer"==MPD.json.idle_timeout_event?renderUIVol():"changed: player"==MPD.json.idle_timeout_event&&null==MPD.json.file?resetPlayCtls():(MPD.json.date&&(MPD.json.date=MPD.json.date.slice(0,4)),renderUI()),engineMpd();else{if(debugLog("engineMpd(): success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),"object"==typeof MPD.json.error){var t=void 0===MPD.json.error.code?"":" ("+MPD.json.error.code+")";"JSON Parse error: Unexpected EOF"!=MPD.json.error.message&&notify("mpderror",MPD.json.error.message+t)}else'Failed to open "ALSA bluetooth" (alsa); Failed to open ALSA device "btstream": No such device'==MPD.json.error?notify("mpderror","Failed to open ALSA bluetooth output, no such device or connection"):"SyntaxError: JSON Parse error: Unexpected EOF"==MPD.json.error?notify("mpderror","JSON Parse error: Unexpected EOF"):"Not seekable"==MPD.json.error||notify("mpderror",MPD.json.error);renderUI(),setTimeout(function(){engineMpd()},ENGINE_TIMEOUT)}},error:function(e){debugLog("engineMpd(): error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpd()},ENGINE_TIMEOUT)}})}function engineMpdLite(){$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){try{MPD.json=JSON.parse(e)}catch(e){MPD.json.error=e}void 0===MPD.json.error?(!0===UI.hideReconnect&&hideReconnect(),void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide(),engineMpdLite()):setTimeout(function(){debugLog("engineMpdLite(): success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),engineMpdLite()},ENGINE_TIMEOUT)},error:function(e){debugLog("engineMpdLite(): error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpdLite()},ENGINE_TIMEOUT)}})}function engineCmd(){var e;$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(t){switch((e=JSON.parse(t).split(","))[0]){case"inpactive1":case"inpactive0":inpSrcIndicator(e[0],e[1]+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>');break;case"btactive1":case"btactive0":inpSrcIndicator(e[0],"Bluetooth Active"+e[1]+'<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>');break;case"aplactive1":case"aplactive0":inpSrcIndicator(e[0],'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>');break;case"spotactive1":case"spotactive0":inpSrcIndicator(e[0],'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>');break;case"slactive1":case"slactive0":inpSrcIndicator(e[0],'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>');break;case"scnactive1":screenSaver(e[0]);break;case"libupd_done":$(".busy-spinner").hide(),loadLibrary();break;case"set_logo_image1":$(".busy-spinner").show();break;case"set_logo_image0":$(".busy-spinner").hide()}engineCmd()},error:function(e){setTimeout(function(){engineCmd()},ENGINE_TIMEOUT)}})}function engineCmdLite(){$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(e){"libregen_done"==JSON.parse(e).split(",")[0]&&($(".busy-spinner").hide(),loadLibrary()),engineCmdLite()},error:function(e){setTimeout(function(){engineCmdLite()},ENGINE_TIMEOUT)}})}function inpSrcIndicator(e,t){UI.currentFile="blank","Yes"==SESSION.json.renderer_backdrop&&("Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#inpsrc-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#inpsrc-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#inpsrc-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):""!=SESSION.json.bgimage&&($("#inpsrc-backdrop").html('<img class="ss-backdrop" src="'+SESSION.json.bgimage+'">'),$("#inpsrc-backdrop").css("filter","blur(0px)"),$("#inpsrc-backdrop").css("transform","scale(1.0)"))),"1"==e.slice(-1)?($("#inpsrc-indicator").css("display","block"),$("#inpsrc-msg").html(t),$("#inpsrc-preamp-volume").text("disabled"==SESSION.json.mpdmixer?"0dB":SESSION.json.volknob)):($("#inpsrc-msg").html(""),$("#inpsrc-indicator").css("display",""))}function screenSaver(e){"block"==$("#inpsrc-indicator").css("display")||UI.mobile||"1"==e.slice(-1)&&($("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),$("body").addClass("cv"),$("#lib-coverart-img").hide(),coverView=!0)}function renderReconnect(){"restart"==UI.restart?$("#restart").show():"shutdown"==UI.restart?$("#shutdown").show():$("#reconnect").show(),$("#countdown-display").countdown("pause"),window.clearInterval(UI.knob),UI.hideReconnect=!0}function hideReconnect(){$("#reconnect, #restart, #shutdown").hide(),UI.hideReconnect=!1}function disableVolKnob(){SESSION.json.volmute,$("#volumedn, #volumeup, #volumedn-2, #volumeup-2").prop("disabled",!0),$("#volumeup, #volumedn, #volumedn-2, #volumeup-2, .volume-display").css("opacity",".3"),$(".volume-display div, #inpsrc-preamp-volume, #playbar-volume-level").text("0dB"),$(".volume-display").css("cursor","unset"),$(".volume-popup-btn").hide(),UI.mobile&&($("#mvol-progress").css("width","100%"),$(".repeat").show())}function resetPlayCtls(){console.log("resetPlayCtls():"),$("#m-total, #playbar-total, #playbar-mtotal").text(formatKnobTotal("0")),$(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),$("#total").html(formatKnobTotal("0")),$(".playlist li.active ").removeClass("active"),updKnobAndTimeTrack(),updKnobStartFrom(0,MPD.json.state),$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").text("00:00")}function renderUIVol(){$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){!1===e?console.log("renderUIVol(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(SESSION.json.feat_bitmask&FEAT_UPNPSYNC&&"0"==SESSION.json.btactive&&"0"==SESSION.json.airplayactv&&"0"==SESSION.json.spotactive&&"0"==SESSION.json.slsvc&&SESSION.json.volknob!=MPD.json.volume&&"0"==SESSION.json.volmute&&(SESSION.json.volknob=MPD.json.volume,$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob})),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume, #playbar-volume-level").text(SESSION.json.volknob),$(".volume-display-db").text("1"==SESSION.json.volume_db_display?MPD.json.mapped_db_vol:""),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?($(".volume-display div, #inpsrc-preamp-volume").text("mute"),$("#playbar-volume-level").text("x")):$(".volume-display div, #playbar-volume-level").text(SESSION.json.volknob))})}function renderUI(){$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){if(!1===e?console.log("renderUI(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(UI.mobile&&$(".volume-popup-btn").show(),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume, #playbar-volume-level").text(SESSION.json.volknob),$(".volume-display-db").text("1"==SESSION.json.volume_db_display?MPD.json.mapped_db_vol:""),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?($(".volume-display div, #inpsrc-preamp-volume").text("mute"),$("#playbar-volume-level").text("x")):$(".volume-display div, #playbar-volume-level").text(SESSION.json.volknob)),"play"==MPD.json.state){if($(".play i").removeClass("fas fa-play").addClass("fas fa-pause"),$(".playlist li.active, .cv-playlist li.active").removeClass("active"),$(".playlist li.paused, .cv-playlist li.paused").removeClass("paused"),$(".playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("active"),$(".cv-playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("active"),$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight"),"Radio station"!=MPD.json.artist&&$("#songsList li").length>0)for(i=0;i<filteredSongs.length;i++)if(filteredSongs[i].title==MPD.json.title&&filteredSongs[i].album==MPD.json.album){$("#lib-song-"+(i+1)+" .lib-entry-song .songtrack").addClass("lib-track-highlight");break}}else"pause"!=MPD.json.state&&"stop"!=MPD.json.state||($(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),void 0!==MPD.json.song&&($(".playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("paused"),$(".cv-playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("paused")),$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight"));if($("#total").html(formatKnobTotal(MPD.json.time?MPD.json.time:0)),$("#m-total, #playbar-total").html(formatKnobTotal(MPD.json.time?MPD.json.time:0)),$("#playbar-mtotal").html("&nbsp;/&nbsp;"+formatKnobTotal(MPD.json.time)),$("#playbar-total").text().length>5?$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").addClass("long-time"):$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").removeClass("long-time"),MPD.json.file!==UI.currentFile&&MPD.json.cover_art_hash!==UI.currentHash){if($("#coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" data-adaptive-background="1" alt="Cover art not found">'),MPD.json.file&&-1==MPD.json.coverurl.indexOf("wimpmusic")&&MPD.json.coverurl){var t="Radio station"==MPD.json.artist?encodeURIComponent(MPD.json.coverurl.replace("imagesw/radio-logos","imagesw/radio-logos/thumbs")):"/imagesw/thmcache/"+encodeURIComponent($.md5(MPD.json.file.substring(0,MPD.json.file.lastIndexOf("/"))))+".jpg";$("#playbar-cover").html('<img src="'+t+'">')}else $("#coverart-url").html('<img class="coverart" src="'+UI.defCover+'" data-adaptive-background="1" alt="Cover art not found">'),$("#playbar-cover").html('<img src="images/default-cover-v6.svg">');if("Yes"==SESSION.json.cover_backdrop){var a=-1===MPD.json.coverurl.indexOf("default-cover-v6")?'<img class="ss-backdrop" src="'+MPD.json.coverurl+'">':"";$("#cover-backdrop").html(a),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")}else""!=SESSION.json.bgimage&&($("#cover-backdrop").html('<img class="ss-backdrop" src="'+SESSION.json.bgimage+'">'),$("#cover-backdrop").css("filter","blur(0px)"),$("#cover-backdrop").css("transform","scale(1.0)"));$("#ss-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),coverView&&$("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),-1===MPD.json.coverurl.indexOf("default-cover-v6")?$.adaptiveBackground.run():setColors()}if("stop"===MPD.json.state)$("#extra-tags-display").html("Not playing");else if("none"==SESSION.json.extra_tags.toLowerCase()||""==SESSION.json.extra_tags)$("#extra-tags-display").html("");else if("Radio station"==MPD.json.artist)$("#extra-tags-display").html(MPD.json.bitrate?MPD.json.bitrate:"Variable bitrate");else{var o;(o=formatExtraTagsString())?$("#extra-tags-display").html(o):$("#extra-tags-display").html(MPD.json.audio_sample_depth+"/"+MPD.json.audio_sample_rate)}var s="Radio station"==MPD.json.artist?RADIO_HD_BADGE_TEXT:ALBUM_HD_BADGE_TEXT;$(".playback-hd-badge, #playbar-hd-badge, #ss-hd-badge").text(s);var r=parseInt(MPD.json.artist_count)>1?"...":"";"Radio station"==MPD.json.artist?($("#currentalbum-div").hide(),$("#currentsong").html(genSearchUrl(MPD.json.artist,MPD.json.title,MPD.json.album)),$("#currentartist").html(MPD.json.album),$("#playbar-currentalbum, #ss-currentalbum").html(-1!=MPD.json.file.indexOf("somafm")?RADIO.json[MPD.json.file].name:MPD.json.album),$("#playbar-currentsong, #ss-currentsong").html(MPD.json.title)):($("#currentalbum-div").show(),$("#currentalbum").html(MPD.json.album),$("#currentsong").html(genSearchUrl("Unknown artist"==MPD.json.artist?MPD.json.albumartist:MPD.json.artist,MPD.json.title,MPD.json.album)),$("#currentartist").html(("Unknown artist"==MPD.json.artist?MPD.json.albumartist:MPD.json.artist)+r),$("#playbar-currentsong, #ss-currentsong").html(MPD.json.title),$("#playbar-currentalbum, #ss-currentalbum").html(MPD.json.album)),"yes"==MPD.json.hidef&&SESSION.json.library_encoded_at&&"9"!=SESSION.json.library_encoded_at?("Radio station"==MPD.json.artist?$("#currentartist-div span.playback-hd-badge").show():($("#currentartist-div span.playback-hd-badge").hide(),$("#currentalbum-div span.playback-hd-badge").show()),$("#playbar-hd-badge, #ss-hd-badge").show()):$(".playback-hd-badge, #playbar-hd-badge, #ss-hd-badge").hide(),UI.currentSongId!=MPD.json.songid&&(toggleSongId="blank"==UI.currentSongId?SESSION.json.toggle_songid:UI.currentSongId,$.post("command/moode.php?cmd=updcfgsystem",{toggle_songid:toggleSongId})),UI.currentFile=MPD.json.file,UI.currentHash=MPD.json.cover_art_hash,UI.currentSongId=MPD.json.songid,"1"===MPD.json.consume?($(".consume").addClass("btn-primary"),$("#menu-check-consume").show()):($(".consume").removeClass("btn-primary"),$("#menu-check-consume").hide()),"1"===MPD.json.repeat?($(".repeat").addClass("btn-primary"),$("#menu-check-repeat").show()):($(".repeat").removeClass("btn-primary"),$("#menu-check-repeat").hide()),"1"===MPD.json.single?($(".single").addClass("btn-primary"),$("#menu-check-single").show()):($(".single").removeClass("btn-primary"),$("#menu-check-single").hide()),"1"===SESSION.json.ashufflesvc?"1"===SESSION.json.ashuffle?($(".random, .consume").addClass("btn-primary"),$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight")):$(".random").removeClass("btn-primary"):"1"===MPD.json.random?$(".random").addClass("btn-primary"):$(".random").removeClass("btn-primary"),"1"===SESSION.json.timecountup||0===parseInt(MPD.json.time)?updKnobStartFrom(parseInt(MPD.json.elapsed),MPD.json.state):updKnobStartFrom(parseInt(MPD.json.time-parseInt(MPD.json.elapsed)),MPD.json.state),0!==parseInt(MPD.json.time)&&(UI.knobPainted=!1),"play"!==MPD.json.state&&"pause"!==MPD.json.state||!1!==UI.knobPainted||updKnobAndTimeTrack(),"stop"===MPD.json.state&&updKnobAndTimeTrack(),void 0===MPD.json.idle_timeout_event||"changed: playlist"==MPD.json.idle_timeout_event||1==GLOBAL.playlistChanged?renderPlaylist(MPD.json.state):updateActivePlItem(),"1"==SESSION.json.inpactive&&inpSrcIndicator("inpactive1",SESSION.json.audioin+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>'),"1"==SESSION.json.btactive&&inpSrcIndicator("btactive1",'Bluetooth Active<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>'),"1"==SESSION.json.airplayactv&&inpSrcIndicator("aplactive1",'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>'),"1"==SESSION.json.spotactive&&inpSrcIndicator("spotactive1",'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>'),"1"==SESSION.json.slactive&&inpSrcIndicator("slactive1",'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>'),void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide()})}function genSearchUrl(e,t,a){if("Streaming source"==t||MPD.json.coverurl===UI.defCover||UI.mobile)var o=MPD.json.title;else{if(void 0===e||"Radio station"===e){var s=t.replace(/-/g," ");s=(s=s.replace(/&/g," ")).replace(/\s+/g,"+")}else s=e+"+"+a;o='<a id="coverart-link" href="http://www.google.com/search?q='+s+'" target="_blank">'+t+"</a>"}return o}function updateActivePlItem(){$.getJSON("command/moode.php?cmd=playlist",function(e){if(e)for(i=0;i<e.length;i++)i==parseInt(MPD.json.song)&&(void 0!==e[i].Name||"http"==e[i].file.substr(0,4)&&void 0===e[i].Artist&&void 0===e[i].Comment)&&(void 0===e[i].Title||""==e[i].Title.trim()||"http://stream.radioactive.fm"==e[i].file?$("#pl-"+(parseInt(MPD.json.song)+1).toString()+" .pll1").html("Streaming source"):($("#pl-"+(parseInt(MPD.json.song)+1).toString()+" .pll1").html(e[i].Title),i==parseInt(MPD.json.song)&&("http"===e[i].Title.substr(0,4)||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(e[i].Title):$("#currentsong").html(genSearchUrl(e[i].Artist,e[i].Title,e[i].Album)),$("#ss-currentsong, #playbar-currentsong").html(e[i].Title))))}),$("#playback-panel").hasClass("active")&&(customScroll("playlist",parseInt(MPD.json.song)),"block"==$("#cv-playlist").css("display")&&customScroll("cv-playlist",parseInt(MPD.json.song)))}function renderPlaylist(e){$.getJSON("command/moode.php?cmd=playlist",function(t){var a="",o=!0===GLOBAL.nativeLazyLoad?'<img loading="lazy" src=':'<img class="lazy-playlistview" data-original=',s="play"!=e?" paused":"";UI.dbEntry[4]=void 0===t.length?0:t.length;var r="Yes"==SESSION.json.playlist_art;if(t)for(i=0;i<t.length;i++){if(i==parseInt(MPD.json.song)?a+='<li id="pl-'+(i+1)+'" class="active pl-entry'+s+'">':a+='<li id="pl-'+(i+1)+'" class="pl-entry">',void 0!==t[i].Name&&"m4a"==t[i].file.substr(t[i].file.lastIndexOf(".")+1).toLowerCase())a+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===t[i].Time?"":formatSongTime(t[i].Time))+"<br><b>&hellip;</b></span>",a+='<span class="pll1">',a+=t[i].Name+"</span>",a+='<span class="pll2">',a+=void 0===t[i].Artist?"Unknown artist":t[i].Artist;else if(void 0!==t[i].Name||"http"==t[i].file.substr(0,4)&&void 0===t[i].Artist&&void 0===t[i].Comment){var n=void 0===RADIO.json[t[i].file]?'"images/notfound.jpg"':'"imagesw/radio-logos/thumbs/'+encodeURIComponent(RADIO.json[t[i].file].name)+'_sm.jpg"';if(a+=!r||void 0!==t[i].Comment&&"client=upmpdcli;"===t[i].Comment?"":'<span class="pl-thumb">'+o+n+"></span>",void 0===t[i].Title||""==t[i].Title.trim()||"http://stream.radioactive.fm"==t[i].file?(a+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===t[i].Time?"":formatSongTime(t[i].Time))+"<br><b>&hellip;</b></span>",a+='<span class="pll1">Streaming source</span>'):(a+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===t[i].Time?"":formatSongTime(t[i].Time))+"<br><b>&hellip;</b></span>",a+='<span class="pll1">'+t[i].Title+"</span>",i==parseInt(MPD.json.song)&&("http"===t[i].Title.substr(0,4)||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(t[i].Title):$("#currentsong").html(genSearchUrl(t[i].Artist,t[i].Title,t[i].Album)),$("#ss-currentsong, #playbar-currentsong").html(t[i].Title))),a+='<span class="pll2">',a+='<i class="fas fa-microphone"></i> ',void 0===RADIO.json[t[i].file]){var l=void 0===t[i].Name?"Radio station":t[i].Name;a+=l,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(l)}else a+=RADIO.json[t[i].file].name,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(RADIO.json[t[i].file].name)}else{var c=-1!=t[i].file.indexOf("/tidal/")?"images/default-cover-v6.png":"imagesw/thmcache/"+encodeURIComponent($.md5(t[i].file.substring(0,t[i].file.lastIndexOf("/"))))+"_sm.jpg";if(a+=r?'<span class="pl-thumb">'+o+'"'+c+'"/></span>':"",a+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===t[i].Time?"":formatSongTime(t[i].Time))+"<br><b>&hellip;</b></span>",a+='<span class="pll1">',void 0===t[i].Title){var d=t[i].file.lastIndexOf(".");if(-1==d)a+=t[i].file;else{var m=t[i].file.slice(0,d);d=m.lastIndexOf("/"),a+=m.slice(d+1)}a+="</span>"}else a+=t[i].Title+"</span>";a+='<span class="pll2">',a+=void 0===t[i].Artist?t[i].AlbumArtist:t[i].Artist}a+="</span></div></li>"}document.getElementById("pl-list").innerHTML=a,a?(r&&0==currentView.indexOf("playback")&&(lazyLode("playlist"),"block"==$("#cv-playlist").css("display")&&lazyLode("cv-playlist")),$("#playback-panel").hasClass("active")&&(customScroll("playlist",parseInt(MPD.json.song)),"block"==$("#cv-playlist").css("display")&&customScroll("cv-playlist",parseInt(MPD.json.song)))):$("#playback-hd-badge, #playbar-hd-badge, #ss-hd-badge").hide(),GLOBAL.playlistChanged=!1})}function mpdDbCmd(e,t){UI.dbCmd=e,-1!=["add_item","play_item","add_item_next","play_item_next","clear_add_item","clear_play_item","add_group","play_group","add_group_next","play_group_next","clear_add_group","clear_play_group","update_library"].indexOf(e)?(GLOBAL.playlistChanged=!0,$.post("command/moode.php?cmd="+e,{path:t},function(e){},"json")):"lsinfo"==e||"listsavedpl"==e?$.post("command/moode.php?cmd="+e,{path:t},function(e){renderFolderView(e,t)},"json"):"lsinfo_radio"==e?renderRadioView():"delsavedpl"==e?($.post("command/moode.php?cmd="+e,{path:t},function(e){},"json"),$.post("command/moode.php?cmd=lsinfo",{path:""},function(e){renderFolderView(e,"")},"json")):"newstation"==e||"updstation"==e?("newstation"==e?notify("creating_station"):notify("updating_station"),$.post("command/moode.php?cmd="+e,{path:t},function(a){RADIO.json[t.url]={name:t.name,type:t.type,logo:t.logo},"OK"==a?notify(e):notify("validation_check",a,5e3),$("#ra-refresh").click()},"json")):"delstation"==e&&(deleteRadioStationObject(t.slice(0,t.lastIndexOf(".")).substr(6)),$.post("command/moode.php?cmd="+e,{path:t},function(){notify("delstation"),$("#ra-refresh").click()}))}function renderFolderView(e,t,a){UI.path=t;for(var o=[],s=[],r=[],i=0,n=0,l=0,c=0;c<e.length;c++)void 0!==e[c].directory&&"RADIO"!=e[c].directory?(o[i]=e[c],i+=1):void 0!==e[c].playlist?(s[n]=e[c],n+=1):void 0!==e[c].file&&-1==e[c].file.indexOf("RADIO")&&(r[l]=e[c],l+=1);var d=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});if(void 0!==o[0]&&o.sort(function(e,t){return e=-1==e.directory.lastIndexOf("/")?removeArticles(e.directory):removeArticles(e.directory.substr(e.directory.lastIndexOf("/")+1)),t=-1==t.directory.lastIndexOf("/")?removeArticles(t.directory):removeArticles(t.directory.substr(t.directory.lastIndexOf("/")+1)),d.compare(e,t)}),void 0!==s[0]&&s.sort(function(e,t){return d.compare(removeArticles(e.playlist),removeArticles(t.playlist))}),e=o.concat(s).concat(r),$("#db-search-results").html(""),$("#db-search-results").hide(),$("#db-search-results").css("font-weight","normal"),a){var m=(e.length?e.length:"0")+" item"+(1==e.length?"":"s");$("#db-search-results").show(),$("#db-search-results").html('<a href="#notarget" data-toggle="context" data-target="#context-menu-db-search-results">'+m+"</a>")}var p="",b=document.getElementById("folderlist");for(b.innerHTML="",c=0;c<e.length;c++){if((e[c].file&&e[c>1?c-1:0].Album!=e[c].Album||e[c].file&&0==c&&e[c].Album)&&(p+='<li id="db-'+c+'" data-path="'+e[c].file.substr(0,e[c].file.lastIndexOf("/"))+'">',p+='<div class="db-icon db-action">',p+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder">',p+='<img src="imagesw/thmcache/'+encodeURIComponent($.md5(e[c].file.substring(0,e[c].file.lastIndexOf("/"))))+'_sm.jpg"></img></a></div>',p+='<div class="db-entry db-album" data-toggle="context" data-target="#context-menu-folder">',p+="<div>"+e[c].Album+"</div></div></li>"),""==t&&void 0!==e[c].file){var u=e[c].file.lastIndexOf("/");t=-1==u?"":e[c].file.slice(0,u)}if(void 0!==e[c].file){var g=e[c].file.substr(e[c].file.lastIndexOf(".")+1).toLowerCase();if(void 0!==e[c].Title)p+='<li id="db-'+(c+1)+'" data-path="'+e[c].file+'">',p+='<div class="db-icon db-song db-action">',p+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item">',p+=e[c].Track+"</a></div>",p+='<div class="db-entry db-song" data-toggle="context" data-target="#context-menu-folder-item"><div>'+e[c].Title+' <span class="songtime">'+e[c].TimeMMSS+"</span></div>";else{p+='<li id="db-'+(c+1)+'" data-path="';var v="";"http"==e[c].file.substr(0,4)?v=e[c].file:(cutpos=e[c].file.lastIndexOf("."),-1!=cutpos&&(v=e[c].file.slice(0,cutpos))),p+=e[c].file;var S="";"cue"==g?(p+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item"><i class="fas fa-list-ul icon-root db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',S="CUE sheet"):"http"==e[c].file.substr(0,4)?(p+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item"><i class="fas fa-microphone db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse" data-toggle="context" data-target="#context-menu-savedpl-item">',S=void 0===RADIO.json[e[c].file]?"Radio station":RADIO.json[e[c].file].name):(p+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item"><i class="fas fa-music db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse" data-toggle="context" data-target="#context-menu-savedpl-item">',S="Song file"),p+=v.replace(t+"/",""),p+=" <span>",p+=S,p+="</span></div></li>"}}else void 0!==e[c].playlist?"wv"==e[c].playlist.substr(e[c].playlist.lastIndexOf(".")+1).toLowerCase()?p+="":(p+='<li id="db-'+(c+1)+'" data-path="'+e[c].playlist+'">',p+='<div class="db-icon db-action">',p+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-root">',p+='<i class="fas fa-list-ul icon-root"></i></a></div>',p+='<div class="db-entry db-savedplaylist db-browse"><div>'+e[c].playlist,p+="</div></div></li>"):(p+='<li id="db-'+(c+1)+'" data-path="',p+=e[c].directory,""==t?p+='"><div class="db-icon db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder"><i class="fas fa-hdd icon-root"></i></a></div><div class="db-entry db-folder db-browse"><div>':(p+='"><div class="db-icon db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder">',p+=""!=e[c].cover_url?'<img src="'+e[c].cover_url+'">':'<i class="fas fa-folder"></i>',p+="</a></div>",p+='<div class="db-entry db-folder db-browse"><div>'),p+=e[c].directory.replace(t+"/",""),p+="</div></div></li>")}b.innerHTML=p,"folder"==currentView&&customScroll("folder",UI.dbPos[UI.dbPos[10]],100)}function renderRadioView(){$.getJSON("command/moode.php?cmd=read_cfg_radio",function(e){var t=GLOBAL.nativeLazyLoad?'<div class="thumbHW"><img loading="lazy" src="':'<div class="thumbHW"><img class="lazy-radioview" data-original="',a=SESSION.json.radioview_sort_group.split(",")[0].toLowerCase(),o=SESSION.json.radioview_sort_group.split(",")[1],s=o,r=SESSION.json.radioview_show_hide.split(",")[0],i=SESSION.json.radioview_show_hide.split(",")[1];if("Hide all"==r||"Un-hide all"==r){for(var n="Hide all"==r?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)<499&&"f"!=e[l].type&&(e[l].type=n);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Moode",stationType:n}),SESSION.json.radioview_show_hide="No action,"+i}if("Hide geo-fenced"==r||"Un-hide geo-fenced"==r){for(n="Hide geo-fenced"==r?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)<499&&"f"!=e[l].type&&"Yes"==e[l].geo_fenced&&(e[l].type=n);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Moode geo-fenced",stationType:n}),SESSION.json.radioview_show_hide="No action,"+i}if("Hide all"==i||"Un-hide all"==i){for(n="Hide all"==i?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)>499&&"f"!=e[l].type&&(e[l].type=n);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Other",stationType:n}),SESSION.json.radioview_show_hide=r+",No action"}var c=[],d=[],m=[],p=[],b=[],u=0,g=0,v=0,S=0,h=0;for(l=0;l<e.length;l++)switch(e[l].type){case"r":c[u]=e[l],u+=1,d[g]=e[l],g+=1;break;case"f":c[u]=e[l],u+=1,m[v]=e[l],v+=1;break;case"h":parseInt(e[l].id)<499?(p[S]=e[l],S+=1):(b[h]=e[l],h+=1)}var y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});c.sort(function(e,t){return"name"==a?y.compare(removeArticles(e[a]),removeArticles(t[a])):"genre"==a?y.compare(removeArticles(e[a].split(", ")[0]),removeArticles(t[a].split(", ")[0])):y.compare(e[a],t[a])});y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});d.sort(function(e,t){return"name"==a?y.compare(removeArticles(e[a]),removeArticles(t[a])):"genre"==a?y.compare(removeArticles(e[a].split(", ")[0]),removeArticles(t[a].split(", ")[0])):y.compare(e[a],t[a])});y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});m.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))});y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});p.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))}),b.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))}),"Show hidden"==r?e=p:"Show hidden"==i?e=b:"Favorites first"==o?e=m.concat(d):"Sort tag"!=o&&"No grouping"!=o||(e=c);var f=parseInt(SESSION.json.library_encoded_at),I="",_="",j="",k="",O=!0;"Favorites first"==o&&m.length>0&&(k='<li class="horiz-rule-radioview">Favorites</li>',O=!1),$(".btnlist-top-ra").show(),$("#searchResetRa").hide(),showSearchResetRa=!1,$("#ra-search-keyword").val(""),$("#ra-filter").val("");var w=!1,E="";for(l=0;l<e.length;l++){if(9!=f){var x=parseInt(e[l].bitrate),N=e[l].bitrate+"K "+e[l].format;I=f<=1?'<div class="lib-encoded-at-notvisible">'+N+"</div>":"",_=1==f&&x>RADIO_BITRATE_THRESHOLD?'<div class="lib-encoded-at-hdonly">'+RADIO_HD_BADGE_TEXT+"</div>":"",j=3==f?'<div class="lib-encoded-at-badge">'+N+"</div>":""}("bitrate"==a||"format"==a)&&(e[l].bitrate,e[l].format);var P="broadcaster"==a&&"No grouping"==o?'<div class="radioview-metadata-text">'+e[l].broadcaster+"</div>":"",M="region"==a&&e[l].country,L=(M="country"==a&&"No grouping"==o?'<div class="radioview-metadata-text">'+e[l].country+"</div>":"","language"==a&&"No grouping"==o?'<div class="radioview-metadata-text">'+e[l].language+"</div>":""),D="genre"==a?'<div class="radioview-metadata-text">'+e[l].genre.substr(e[l].genre.indexOf(", ")+1)+"</div>":"";if("Favorites first"==o&&"f"==e[l].type||"No grouping"!=o&&(o="Sort tag"),"Favorites first"==s&&!1===O&&"f"!=e[l].type&&""!=E&&(E="",O=!0),"Sort tag"==o){var A=removeArticles(e[l][a]).substr(0,1).toUpperCase(),T=removeArticles(E).substr(0,1).toUpperCase();"name"==a&&A!=T?!1===isNaN(A)&&!1===w?(k+='<li class="horiz-rule-radioview">0-9</li>',w=!0):!0===isNaN(A)&&(k+='<li class="horiz-rule-radioview">'+A+"</li>"):"genre"==a&&e[l][a].split(", ")[0]!=E.split(", ")[0]?k+='<li class="horiz-rule-radioview">'+e[l][a].split(", ")[0]+"</li>":"name"!=a&&"genre"!=a&&e[l][a]!=E&&(k+='<li class="horiz-rule-radioview">'+e[l][a]+("bitrate"==a?" kbps":"")+"</li>")}var C="local"==e[l].logo?"imagesw/radio-logos/thumbs/"+e[l].name+".jpg":e[l].logo;k+='<li id="ra-'+(l+1)+'" data-path="RADIO/'+e[l].name+".pls",k+='"><div class="db-icon db-song db-browse db-action">'+t+C+'"></div><div class="cover-menu" data-toggle="context" data-target="#context-menu-radio-item"></div></div><div class="db-entry db-song db-browse"></div>',k+=_,k+=j,k+='<span class="station-name">'+e[l].name+"</span>",k+=P,k+=M,k+=L,k+=D,k+=I,k+="</li>",E=e[l][a]}document.getElementById("radiocovers").innerHTML=k,"radio"==currentView&&lazyLode("radio")})}function formatKnobTotal(e){if("Radio station"==MPD.json.artist&&void 0===MPD.json.duration){var t="";$("#total").html("").addClass("total-radio"),$("#playbar-mtime").css("display","block"),$("#playbar-mtotal").hide()}else{t=formatSongTime(e);$("#total").removeClass("total-radio"),$("#playbar-mtime").css("display",""),$("#playbar-mtotal").show()}return t}function updKnobStartFrom(e,t){$("#countdown-display").countdown("destroy"),"play"!=t&&"pause"!=t||("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?$("#countdown-display").countdown({since:-e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}):$("#countdown-display").countdown({until:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),"pause"==t&&$("#countdown-display").countdown("pause"))}function updKnobAndTimeTrack(){var e;if(window.clearInterval(UI.knob),GLOBAL.initTime=parseInt(MPD.json.song_percent),e=parseInt(MPD.json.time)/1e3,UI.mobile?$("#timetrack").val(10*GLOBAL.initTime).trigger("change"):-1!==currentView.indexOf("playback")?$("#time").val(10*GLOBAL.initTime).trigger("change"):$("#playbar-timetrack").val(10*GLOBAL.initTime).trigger("change"),"stop"===MPD.json.state?($("#countdown-display").countdown("destroy"),UI.mobile?($("#m-total, #m-countdown, #playbar-mcount").text("00:00"),$("#playbar-mtotal").html("&nbsp;/&nbsp;00:00")):$("#playbar-total, #playbar-countdown, #countdown-display").html("00:00")):"Radio station"==MPD.json.artist&&void 0===MPD.json.duration?UI.mobile?$("#timeline").hide():($("#playbar-timeline").css("display","none"),$("#playbar-title").css("padding-bottom","0")):UI.mobile?($("#timeline").show(),$("#playbar-mcount, #m-countdown").text($("#countdown-display").text())):($("#playbar-timeline").show(),$("#playbar-countdown").text($("#countdown-display").text()),$("#playbar-title").css("padding-bottom","1rem")),"play"===MPD.json.state){var t=$("#timetrack"),a=$("#time");UI.knob=setInterval(function(){(UI.mobile||"flex"==$("#menu-bottom").css("display"))&&(timeSliderMove||(syncTimers(),UI.mobile&&t.val(10*GLOBAL.initTime).trigger("change"))),GLOBAL.initTime=0===e?GLOBAL.initTime+.5:GLOBAL.initTime+.1,UI.mobile||"flex"==$("#menu-bottom").css("display")||(0===e&&GLOBAL.initTime>100&&(window.clearInterval(UI.knob),UI.knobPainted=!0),a.val(10*GLOBAL.initTime).trigger("change"))},1e3*e)}}function formatSongTime(e){var t,a;return isNaN(parseInt(e))?"":((t=Math.floor(e/3600))>0?t+":":"")+((a=(a=Math.floor(e/60))<60?a:a%60)<10?"0"+a:a)+":"+((e%=60)<10?"0"+e:e)}function countdownRestart(e){$("#countdown-display").countdown("destroy"),$("#countdown-display").countdown({since:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})}function setVolume(e,t){e=(e=(e=parseInt(e))>GLOBAL.mpdMaxVolume?GLOBAL.mpdMaxVolume:e)<0?0:e,"0"==SESSION.json.volmute?(SESSION.json.volknob=e.toString(),sendVolCmd("POST","updvolume",{volknob:SESSION.json.volknob},!0)):(0==e&&"mute"==t?sendMpdCmd("setvol 0"):SESSION.json.volknob=e.toString(),$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob}))}function customScroll(e,t,a){var o,s,r,i,n,l,c,d;switch(a=void 0===a?200:a,e){case"folder":s=o="#database",r=4;break;case"playlist":if(isNaN(t))return;o="#playlist",s="#container-playlist",r=6;break;case"cv-playlist":if(isNaN(t))return;s=o="#cv-playlist",r=6;break;case"genres":s=o="#lib-genre",r=6;break;case"artists":s=o="#lib-artist",r=6;break;case"albums":case"albumcovers":s=o="albums"==e?"#lib-album":"#lib-albumcover",r=6,t="albums"==e?t:t+1;break;case"tracks":o="#trackscontainer",s="#lib-file",r=600;break;case"radio":case"radio_headers":s=o="#database-radio",r="radio"==e?6:600}d=null!=$(o+" ul li:nth-child("+t+")").position()?$(o+" ul li:nth-child("+t+")").position().top:0,i=parseInt($(s).height()/r),c=(l=d+(n=$(s).scrollTop())-i)>n?"+="+Math.abs(l-n)+"px":"-="+Math.abs(l-n)+"px",0==t?$(s).scrollTo(0,a):l>0?$(s).scrollTo(c,a):$(s).scrollTo(0,a)}function getMiscLibOptions(){return SESSION.json.library_misc_options.split(",")}function updateClockRadioCfgSys(){$.post("command/moode.php?cmd=updcfgsystem",{clkradio_mode:SESSION.json.clkradio_mode,clkradio_item:SESSION.json.clkradio_item.replace(/'/g,"''"),clkradio_name:SESSION.json.clkradio_name.replace(/'/g,"''"),clkradio_start:SESSION.json.clkradio_start,clkradio_stop:SESSION.json.clkradio_stop,clkradio_volume:SESSION.json.clkradio_volume,clkradio_action:SESSION.json.clkradio_action},function(){$.get("command/moode.php?cmd=updclockradio")})}function importBgImage(e){if(e[0].size>1e6)$("#error-bgimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-bgimage").text(""),UI.bgImgChange=!0,imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#current-bgimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-bgimage").css("margin-left","60px"),URL.revokeObjectURL(imgUrl);var t=new FileReader;t.onload=function(e){var a=t.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setbgimage",{blob:a})},t.readAsDataURL(e[0])}else $("#error-bgimage").text("Image format must be JPEG")}function newLogoImage(e){if(e[0].size>1e6)$("#error-new-logoimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-new-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-new-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-new-logoimage").css("margin-left","60px"),$("#new-station-tags").css("margin-top","30px");var t=$("#new-station-name").val();URL.revokeObjectURL(imgUrl);var a=new FileReader;a.onload=function(e){var o=a.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:o})},a.readAsDataURL(e[0])}else $("#error-new-logoimage").text("Image format must be JPEG")}function editLogoImage(e){if(e[0].size>1e6)$("#error-edit-logoimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-edit-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-edit-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-edit-logoimage").css("margin-left","60px");var t=$("#edit-station-name").val();URL.revokeObjectURL(imgUrl);var a=new FileReader;a.onload=function(e){var o=a.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:o})},a.readAsDataURL(e[0])}else $("#error-edit-logoimage").text("Image format must be JPEG")}function importStationPkg(e){if(e[0].size>75e6)$("#import-export-msg").text("ZIP file must be less than 75MB in size");else{$("#import-export-msg").text("Importing..."),objUrl=(URL||webkitURL).createObjectURL(e[0]),URL.revokeObjectURL(objUrl);var t=new FileReader;t.onload=function(e){var a=t.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=import_stations",{blob:a},function(e){$("#import-export-msg").text(e),$("#import-station-pkg").val("")})},t.readAsDataURL(e[0])}}function setClkRadioCtls(e){"Disabled"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!0),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):"Sleep Timer"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):($("#clockradio-ctl-grp1 *").prop("disabled",!1),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!1))}function rgbToHsl(e){var t,a,o=(e=(e=e.substr(4)).slice(0,e.length-1)).split(","),s=o[0]/255,r=o[1]/255,i=o[2]/255,n=Math.min(s,r,i),l=Math.max(s,r,i),c=l-n;return l===n?t=0:s===l?t=(r-i)/c:r===l?t=2+(i-s)/c:i===l&&(t=4+(s-r)/c),(t=Math.min(60*t,360))<0&&(t+=360),a=(n+l)/2,[t/=360,l===n?0:a<=.5?c/(l+n):c/(2-l-n),a]}function hslToRgb(e){var t,a,o,s,r,i=e[0],n=e[1],l=e[2];if(0===n)return[r=Math.round(255*l),r,r];t=2*l-(a=l<.5?l*(1+n):l+n-l*n),s=[0,0,0];for(var c=0;c<3;c++)(o=i+1/3*-(c-1))<0&&o++,o>1&&o--,r=6*o<1?t+6*(a-t)*o:2*o<1?a:3*o<2?t+(a-t)*(2/3-o)*6:t,s[c]=Math.round(255*r);return s}function hslToRgba(e,t){var a,o,s,r,i,n=e[0],l=e[1],c=e[2];if(0===l)return[i=Math.round(255*c),i,i];a=2*c-(o=c<.5?c*(1+l):c+l-c*l),r=[0,0,0];for(var d=0;d<3;d++)(s=n+1/3*-(d-1))<0&&s++,s>1&&s--,i=6*s<1?a+6*(o-a)*s:2*s<1?o:3*s<2?a+(o-a)*(2/3-s)*6:a,r[d]=Math.round(255*i);return"rgba(".concat(r[0],",",r[1],",",r[2],",",t,")")}function rgbaToRgb(e,t,a,o){return"rgba("+Math.round((1-e)*o[0]+e*a[0])+", "+Math.round((1-e)*o[1]+e*a[1])+", "+Math.round((1-e)*o[2]+e*a[2])+", "+t+")"}function splitColor(e){var t=e.slice(5,e.length-1).split(",");return[t[0],t[1],t[2],t[3]]}function splitRGB(e){var t,a=(t=(t=e.substr(4)).slice(0,t.length-1)).split(",");return[a[0],a[1],a[2]]}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,a,o){return t+t+a+a+o+o});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}function str2rgba(e){return"rgba("+e+")"}function str2hex(e){return"#"+e}function dbFastSearch(){return $("#dbsearch-alltags").val($("#dbfs").val()),$("#db-search-submit").click(),$("#dbfs").blur(),!1}function btnbarfix(e,t){var a=splitColor(e),o=hexToRgb(t),s=0;if(SESSION.json.alphablend<.85&&(s=.9-SESSION.json.alphablend)>.4&&(s=.4),tempy=s<.15?.25:.1+s,document.body.style.setProperty("--btnbarcolor",getYIQ(e)>127?"rgba(32,32,32,"+tempy+")":"rgba(224,224,224,"+tempy+")"),tempcolor=rgbaToRgb(.7-s,"0.2",a,o),document.body.style.setProperty("--btnshade",tempcolor),tempcolor=rgbaToRgb(.8-s,"0.6",a,o),document.body.style.setProperty("--btnshade2",tempcolor),tempcolor=rgbaToRgb(.3,"1.0",a,o),document.body.style.setProperty("--textvariant",tempcolor),tempcolor=rgbaToRgb(.65-s,".15",a,o),document.body.style.setProperty("--btnshade3",tempcolor),document.body.style.setProperty("--btnshade4",getYIQ(e)>127?"rgba(32,32,32,0.10)":"rgba(208,208,208,0.17)"),$("#content").hasClass("visacc")?op=.95:op=.9,document.body.style.setProperty("--modalbkdr",rgbaToRgb(.95,.95,a,o)),$("#content").hasClass("visacc"))-1==currentView.indexOf("playback")||"No"==SESSION.json.adaptive?UI.accenta=themeMcolor:UI.accenta=adaptMcolor;else{var r=hexToRgb(accentColor);UI.accenta=rgbaToRgb(.3-s,.75,a,r)}document.body.style.setProperty("--btnbarback",rgbaToRgb(.9,".9",a,o)),document.body.style.setProperty("--config_modal_btn_bg","rgba(128,128,128,0.12)")}function getYIQ(e){var t=e.match(/\d+/g);return parseInt((299*t[0]+587*t[1]+114*t[2])/1e3)}function setColors(){document.body.style.setProperty("--themebg",themeBack);var e=getYIQ(themeBack)>127;-1!==currentView.indexOf("playback")&&"Yes"==SESSION.json.adaptive?(e=getYIQ(adaptBack)>127,document.body.style.setProperty("--adaptbg",adaptBack),document.body.style.setProperty("--adapttext",adaptMcolor),document.body.style.setProperty("--adaptmbg",adaptMback),btnbarfix(adaptBack,adaptColor)):(document.body.style.setProperty("--adaptbg",themeBack),document.body.style.setProperty("--adapttext",themeMcolor),document.body.style.setProperty("--adaptmbg",themeMback),btnbarfix(themeBack,themeColor)),lastYIQ!==e&&(lastYIQ=e,e?(npIcon='url("../images/4band-npicon/audiod.svg")',npIconPaused='url("../images/4band-npicon/audiod-flat.svg")',document.body.style.setProperty("--timethumb",'url("'+thumbd+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbd+'")'),document.body.style.setProperty("--timecolor","rgba(96,96,96,0.25)"),document.body.style.setProperty("--trackfill","rgba(48,48,48,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-d.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(32,32,32,0.06)",fgColor:UI.accenta})},DEFAULT_TIMEOUT)):(npIcon='url("../images/4band-npicon/audiow.svg")',npIconPaused='url("../images/4band-npicon/audiow-flat.svg")',document.body.style.setProperty("--timethumb",'url("'+thumbw+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbw+'")'),document.body.style.setProperty("--timecolor","rgba(240,240,240,0.25)"),document.body.style.setProperty("--trackfill","rgba(240,240,240,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-l.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(224,224,224,0.09)",fgColor:UI.accenta})},DEFAULT_TIMEOUT)),document.body.style.setProperty("--npicon",npIcon))}function updEqgFreq(e,t){$(e).html(t)}function updEqpMasterGain(e,t){$(e).html(t+" dB")}function updEqpMasterGainSlider(e){var t="master-gain-up"==e?.1:-.1,a=(parseFloat($("#master-gain-slider").val())+t).toFixed(1);a=a>24?24:a<-24?-24:a,$("#master-gain-slider").val(a),$("#master-gain").html(a+" dB")}function getCSSRule(e){for(var t=0;t<document.styleSheets.length;t++)for(var a=document.styleSheets[t].cssRules,o=0;o<a.length;o++){var s=a[o];if(s.selectorText==e)return s}}function themeToColors(e){switch(e){case"Amethyst":var t="#8e44ad",a="rgba(142,68,173,0.71)";break;case"Bluejeans":t="#1a439c",a="rgba(26,67,156,0.71)";break;case"Carrot":t="#d35400",a="rgba(211,84,0,0.71)";break;case"Emerald":t="#27ae60",a="rgba(39,174,96,0.71)";break;case"Fallenleaf":t="#cb8c3e",a="rgba(203,140,62,0.71)";break;case"Grass":t="#7ead49",a="rgba(126,173,73,0.71)";break;case"Herb":t="#317589",a="rgba(49,117,137,0.71)";break;case"Lavender":t="#876dc6",a="rgba(135,109,198,0.71)";break;case"River":t="#2980b9",a="rgba(41,128,185,0.71)";break;case"Rose":t="#c1649b",a="rgba(193,100,155,0.71)";break;case"Silver":t="#999999",a="rgba(153,153,153,0.71)";break;case"Turquoise":t="#16a085",a="rgba(22,160,133,0.71)";break;default:t="#c0392b",a="rgba(192,57,43,0.71)"}return document.body.style.setProperty("--accentxts",t),document.body.style.setProperty("--accentxta",a),t}function listLook(e,t,a){itemNum=0,"#"!=a&&("radio"==t?$("#"+e).each(function(){if(removeArticles($(this).children("span").text().toLowerCase()).substr(0,1)==a)return!1;itemNum++}):"radio_headers"==t?$("#"+e).each(function(){var e=$(this).hasClass("horiz-rule-radioview")?removeArticles($(this).text().toLowerCase()):"";if("favorites"!=e&&e.substr(0,1)==a)return!1;itemNum++}):$("#"+e).each(function(){if(removeArticles($(this).text().toLowerCase()).substr(0,1)==a)return!1;itemNum++})),itemNum!=$("#"+e).length&&customScroll(t,itemNum,200)}function storeRadioPos(e){$.post("command/moode.php?cmd=updcfgsystem",{radio_pos:e})}function storeLibPos(e){$.post("command/moode.php?cmd=updcfgsystem",{lib_pos:e[0]+","+e[1]+","+e[2]})}function syncTimers(){var e=$("#countdown-display").text();e!=GLOBAL.lastTimeCount&&(UI.mobile?$("#m-countdown, #playbar-mcount").text(e):coverView||-1==currentView.indexOf("playback")?($("#playbar-countdown").text(e),GLOBAL.initTime<50?g=GLOBAL.initTime+1:g=GLOBAL.initTime-1,$("#playbar-timetrack").val(10*GLOBAL.initTime),$("#playbar-timeline .timeline-progress").css("width",g+"%")):UI.knobPainted=!1,GLOBAL.lastTimeCount=e)}function makeActive(e,t,a){switch(UI.mobile&&($("#playback-controls").css("display",""),$("#content").css("height","100vh")),$("#content .tab-pane, .viewswitch button").removeClass("active"),$("#viewswitch").removeClass("vr vf vt va"),$.post("command/moode.php?cmd=updcfgsystem",{current_view:a}),currentView=a,setColors(),"tag"!=a&&"album"!=a||""!=$("#lib-album-filter").val()&&$("#searchResetLib").show(),a){case"radio":$("#viewswitch").addClass("vr"),$("#playbar-toggles .addfav").show(),$("#random-album, .adv-search-btn").hide(),lazyLode("radio");break;case"folder":$("#viewswitch").addClass("vf"),$("#playbar-toggles .addfav").show(),$("#random-album, .adv-search-btn").hide();break;case"album":$("#viewswitch").addClass("va"),$("#playbar-toggles .addfav").hide(),$("#random-album, .adv-search-btn").show(),$("#library-panel").addClass("covers").removeClass("tag"),"Hide tracks"==$("#tracklist-toggle").text().trim()?($("#bottom-row").css("display","flex"),$("#lib-albumcover").css("height","calc(50% - env(safe-area-inset-top) - 2.75rem)"),$("#index-albumcovers").hide()):($("#bottom-row").css("display",""),$("#lib-albumcover").css("height","100%"),$("#index-albumcovers").show()),lazyLode("album");break;case"tag":$("#viewswitch").addClass("vt"),$("#playbar-toggles .addfav").hide(),$("#random-album, .adv-search-btn").show(),$("#library-panel").addClass("tag").removeClass("covers"),$("#index-albumcovers").hide(),"Yes"==SESSION.json.library_show_genres?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre"),SESSION.json.library_tagview_covers&&lazyLode("tag")}setLibMenuAndHeader(),$(e+","+t).addClass("active")}function setLibMenuAndHeader(){var e=UI.mobile||-1!=currentView.indexOf("playback")?"":"Browse by ";if("radio"==currentView)e+="Radio Stations",GLOBAL.searchRadio&&(e=GLOBAL.searchRadio);else if("folder"==currentView)e+="Folders",GLOBAL.searchFolder&&(e=GLOBAL.searchFolder);else if(("album"==currentView||"tag"==currentView)&&(e+="album"==currentView?SESSION.json.library_albumview_sort:SESSION.json.library_tagview_sort,$(".view-recents span").hide(),$(".view-all span").hide(),"recent"==GLOBAL.musicScope?($(".view-recents span").show(),LIB.recentlyAddedClicked=!0,e="Added in last "+getParamOrValue("param",SESSION.json.library_recently_added).toLowerCase()):($(".view-all span").show(),LIB.recentlyAddedClicked=!1),LIB.filters.genres.length&&(e="Browse "+LIB.filters.genres[0]),LIB.filters.artists.length&&(e="Albums by "+LIB.filters.artists[0]),"full_lib"!=SESSION.json.library_flatlist_filter)){var t=SESSION.json.library_flatlist_filter.charAt(0).toUpperCase()+SESSION.json.library_flatlist_filter.slice(1);e="tags"==SESSION.json.library_flatlist_filter?"Filtered by Advanced search":GLOBAL.oneArgFilters.includes(SESSION.json.library_flatlist_filter)?"Filtered by ("+t+")":GLOBAL.twoArgFilters.includes(SESSION.json.library_flatlist_filter)&&""==SESSION.json.library_flatlist_filter_str?"Filtered by Any: "+t:"Filtered by "+t+": "+SESSION.json.library_flatlist_filter_str}$("#menu-header").text(e)}function lazyLode(e,t,a){if(!GLOBAL.nativeLazyLoad){var o,s;switch(t=!!t,e){case"radio":s="img.lazy-radioview",o="#radiocovers";break;case"tag":"Yes"==SESSION.json.library_tagview_covers&&(s="img.lazy-tagview",o="#lib-album");break;case"album":s="img.lazy-albumview",o="#lib-albumcover";break;case"playlist":s="img.lazy-playlistview",o="#playlist";break;case"cv-playlist":s="img.lazy-playlistview",o="#cv-playlist"}s&&o&&($(o+" "+s).attr("src")&&!a||$.ensure(o+" li").then(function(){$(o+" "+s).lazyload({container:$(o),skip_invisible:t}),UI.libPos[1]>=0&&"album"==currentView&&(customScroll("albumcovers",UI.libPos[1],0),$("#albumcovers .lib-entry").eq(UI.libPos[1]).addClass("active")),UI.libPos[0]>=0&&"tag"==currentView&&(customScroll("albums",UI.libPos[0],0),$("#albumsList .lib-entry").eq(UI.libPos[0]).addClass("active"),$("#albumsList .lib-entry").eq(UI.libPos[0]).click()),UI.radioPos>=0&&"radio"==currentView&&customScroll("radio",UI.radioPos,0)}))}}function setFontSize(){var e=getParamOrValue("value",SESSION.json.font_size);UI.mobile&&(e+=.3),document.body.style.setProperty("--pbfont","calc("+e+"rem + 1vmin)")}function volMuteSwitch(){if("0"==SESSION.json.volmute){SESSION.json.volmute="1";var e=0,t="mute"}else{SESSION.json.volmute="0";e=SESSION.json.volknob,t="unmute"}$.post("command/moode.php?cmd=updcfgsystem",{volmute:SESSION.json.volmute},function(){setVolume(e,t)})}function submitLibraryUpdate(e){0==GLOBAL.libLoading?(GLOBAL.libLoading=!0,GLOBAL.libRendered=!1,mpdDbCmd("update_library",e),notify("update_library",e)):notify("library_updating")}function getThumbHW(){var e=SESSION.json.library_thumbnail_columns.slice(0,1);UI.mobile&&(e-=4);var t=Math.round(2*convertRem(1.5)),a=parseInt(($(window).width()-2*GLOBAL.sbw-t)/e);UI.thumbHW=a-t/2,$("body").get(0).style.setProperty("--thumbimagesize",UI.thumbHW+"px"),$("body").get(0).style.setProperty("--thumbmargin",(a-UI.thumbHW)/2+"px"),$("body").get(0).style.setProperty("--thumbcols",a+"px")}function convertRem(e){return e*getRootElementFontSize()}function getRootElementFontSize(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}function applyLibFilter(e,t=""){SESSION.json.library_flatlist_filter=e,SESSION.json.library_flatlist_filter_str=t,$.get("command/moode.php?cmd=clear_libcache_filtered",function(){$.post("command/moode.php?cmd=updcfgsystem",{library_flatlist_filter:e,library_flatlist_filter_str:SESSION.json.library_flatlist_filter_str},function(){LIB.recentlyAddedClicked=!1,LIB.filters.genres.length=0,LIB.filters.artists.length=0,LIB.filters.albums.length=0,LIB.artistClicked=!1,LIB.albumClicked=!1,$("#tracklist-toggle").html('<i class="fal fa-list sx"></i> Show tracks'),GLOBAL.musicScope="all","album"==currentView&&($("#albumcovers .lib-entry").removeClass("active"),$("#bottom-row").css("display",""),$("#lib-albumcover").css("height","100%")),UI.libPos.fill(-2),storeLibPos(UI.libPos),GLOBAL.libRendered=!1,loadLibrary()})})}function splitStringAtFirstSpace(e){return strArray=[],-1==e.indexOf(" ")?strArray[0]=e:(strArray[0]=e.substr(0,e.indexOf(" ")),strArray[1]=e.substr(e.indexOf(" ")+1)),strArray}function audiohardware(){audioinfo("Radio station"==MPD.json.artist?"station_info":"track_info",MPD.json.file,"hardware")}function audioinfo(e,t,a){$("#audioinfo-modal .modal-body").load("audioinfo.php",function(){$.post("command/moode.php?cmd="+e,{path:t},function(t){itemInfoModal("trackdata",t),"hardware"!=a&&(a="track"),"station_info"==e?$("#audioinfo-track").text("Station"):$("#audioinfo-track").text("Track"),$("#audioinfo-modal").removeClass("track hardware"),$("#audioinfo-modal").addClass(a),$("#audioinfo-modal").modal("show")},"json")})}function itemInfoModal(e,t){var a="";for(i=0;i<t.length;i++){var o=Object.keys(t[i]);void 0!==t[i][o]&&(a+='<li><span class="left">'+o+'</span><span class="ralign">'+t[i][o]+"</span></li>")}document.getElementById(e).innerHTML=a}$('input[type="range"]').change(function(){var e=($(this).val()-$(this).attr("min"))/($(this).attr("max")-$(this).attr("min"))*100;e<50?e+=1:e-=1,$(".timeline-progress").css("width",e+"%")}),$("#timetrack, #playbar-timetrack").bind("touchstart mousedown",function(e){timeSliderMove=!0}),$("#timetrack, #playbar-timetrack").bind("touchend mouseup",function(e){var t,a;t=(a=parseInt(MPD.json.time))/1e3;var o=Math.floor($(this).val()*t);o>a-2&&(o=a-2),sendMpdCmd("seek "+MPD.json.song+" "+o),timeSliderMove=!1}),$("#currentsong").click(function(e){if(UI.mobile){var t,a,o=parseInt(MPD.json.song);a=$("#playlist ul li:nth-child("+(o+1)+")").position().top,parseInt($("#playlist").height()/3),$("#playlist").scrollTop(),t=a+200,$("html, body").animate({scrollTop:t},"fast")}}),$(".view-all").click(function(e){$(".view-recents span").hide(),$(".view-all span").show(),$("#menu-header").click(),GLOBAL.musicScope="all",GLOBAL.searchRadio=!1,LIB.recentlyAddedClicked=!1,LIB.filters.albums.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),setLibMenuAndHeader()}),$(".view-recents").click(function(e){GLOBAL.musicScope="recent",$(".view-all span").hide(),$(".view-recents span").show(),LIB.recentlyAddedClicked=!0,LIB.filters.albums.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),setLibMenuAndHeader()}),$(".context-menu a").click(function(e){var t=UI.dbEntry[0];if(-1!=$(this).data("cmd").indexOf("_item")){if(""==$("#db-search-results").text())mpdDbCmd($(this).data("cmd"),t);else{var a=[];$("#folderlist li").each(function(){-1!=$(this).data("path").indexOf(t)&&a.push($(this).data("path"))}),a.length>1&&(a=a.slice(1)),mpdDbCmd($(this).data("cmd").replace("_item","_group"),a)}-1!=$(this).data("cmd").indexOf("add_")&&notify($(this).data("cmd")),-1==t.indexOf("/")&&"NAS"!=t&&"RADIO"!=t&&"SDCARD"!=t&&"USB"!=t?$("#pl-saveName").val(t):$("#pl-saveName").val("")}else if("update_folder"==$(this).data("cmd"))submitLibraryUpdate(t);else if("update_library"==$(this).data("cmd"))submitLibraryUpdate();else if("track_info_folder"==$(this).data("cmd"))audioinfo("track_info",t);else if("track_info_playback"==$(this).data("cmd")){if(""!=$("#currentsong").html())audioinfo("Radio station"==MPD.json.artist?"station_info":"track_info",MPD.json.file)}else if("delsavedpl"==$(this).data("cmd"))$("#savedpl-path").html(t),$("#deletesavedpl-modal").modal();else if("editradiostn"==$(this).data("cmd"))$.post("command/moode.php?cmd=readstationfile",{path:UI.dbEntry[0]},function(e){var a=t.slice(t.lastIndexOf("/")+1);a=a.slice(0,a.lastIndexOf(".")),GLOBAL.editStationId=e.id,$("#edit-station-name").val(a),$("#edit-station-url").val(e.station),$("#edit-logoimage").val(""),$("#info-toggle-edit-logoimage").css("margin-left","60px"),$("#preview-edit-logoimage").html('<img src="../imagesw/radio-logos/thumbs/'+a+'.jpg">'),$("#edit-station-tags").css("margin-top","30px"),$("#edit-station-type span").text(getParamOrValue("param",e.type)),$("#edit-station-genre").val(e.genre),$("#edit-station-broadcaster").val(e.broadcaster),$("#edit-station-language").val(e.language),$("#edit-station-country").val(e.country),$("#edit-station-region").val(e.region),$("#edit-station-bitrate").val(e.bitrate),$("#edit-station-format").val(e.format),$("#edit-station-geo-fenced span").text(e.geo_fenced),$("#editstation-modal").modal()},"json");else if("delstation"==$(this).data("cmd"))$("#station-path").html(t.slice(0,t.lastIndexOf(".")).substr(6)),$("#deletestation-modal").modal();else if("deleteplitem"==$(this).data("cmd"))$("#delete-plitem-begpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-endpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-newpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-begpos").val(t+1),$("#delete-plitem-endpos").val(t+1),$("#deleteplitems-modal").modal();else if("moveplitem"==$(this).data("cmd"))$("#move-plitem-begpos").attr("max",UI.dbEntry[4]),$("#move-plitem-endpos").attr("max",UI.dbEntry[4]),$("#move-plitem-newpos").attr("max",UI.dbEntry[4]),$("#move-plitem-begpos").val(t+1),$("#move-plitem-endpos").val(t+1),$("#move-plitem-newpos").val(t+1),$("#moveplitems-modal").modal();else if("setforclockradio"==$(this).data("cmd")||"setforclockradio-m"==$(this).data("cmd")){"setforclockradio-m"==$(this).data("cmd")&&$("#configure-modal").modal("toggle"),$("#clockradio-mode span").text(SESSION.json.clkradio_mode),"setforclockradio-m"==$(this).data("cmd")?($("#clockradio-playname").val(SESSION.json.clkradio_name),UI.dbEntry[0]="-1"):$("#clockradio-playname").val(UI.dbEntry[5]);var o=SESSION.json.clkradio_start.split(",");$("#clockradio-starttime-hh").val(o[0]),$("#clockradio-starttime-mm").val(o[1]),$("#clockradio-starttime-ampm span").text(o[2]),$("#clockradio-start-mon").prop("checked","1"==o[3]),$("#clockradio-start-tue").prop("checked","1"==o[4]),$("#clockradio-start-wed").prop("checked","1"==o[5]),$("#clockradio-start-thu").prop("checked","1"==o[6]),$("#clockradio-start-fri").prop("checked","1"==o[7]),$("#clockradio-start-sat").prop("checked","1"==o[8]),$("#clockradio-start-sun").prop("checked","1"==o[9]);var s=SESSION.json.clkradio_stop.split(",");$("#clockradio-stoptime-hh").val(s[0]),$("#clockradio-stoptime-mm").val(s[1]),$("#clockradio-stoptime-ampm span").text(s[2]),$("#clockradio-stop-mon").prop("checked","1"==s[3]),$("#clockradio-stop-tue").prop("checked","1"==s[4]),$("#clockradio-stop-wed").prop("checked","1"==s[5]),$("#clockradio-stop-thu").prop("checked","1"==s[6]),$("#clockradio-stop-fri").prop("checked","1"==s[7]),$("#clockradio-stop-sat").prop("checked","1"==s[8]),$("#clockradio-stop-sun").prop("checked","1"==s[9]),$("#clockradio-action span").text(SESSION.json.clkradio_action),$("#clockradio-volume").val(SESSION.json.clkradio_volume),setClkRadioCtls(SESSION.json.clkradio_mode),$("#clockradio-modal").modal()}else if("preferences"==$(this).data("cmd")){bgImgChange=!1;for(var r=getMiscLibOptions(),n=SESSION.json.preferences_modal_state.split(","),l=0;l<5;l++)"1"==n[l]&&$("#preferences-modal .accordian").eq(l).addClass("active");$("#theme-name span").text(SESSION.json.themename),$.post("command/moode.php?cmd=readthemename",function(e){var t="";for(i=0;i<e.length;i++)t+='<li class="modal-dropdown-text"><a href="#notarget" data-cmd="theme-name-sel" style="background-color: rgb('+e[i].bg_color+')"><span class="text" style="color: #'+e[i].tx_color+'">'+e[i].theme_name+"</span></a></li>";$("#theme-name-list").html(t),$("#alpha-blend span").text(SESSION.json.alphablend),$("#adaptive-enabled span").text(SESSION.json.adaptive),$("#accent-color span").text(SESSION.json.accent_color),$("#error-bgimage").text(""),$.ajax({url:"imagesw/bgimage.jpg",type:"HEAD",success:function(){$("#remove-bgimage").show(),$("#choose-bgimage").hide(),$("#current-bgimage").html('<img src="imagesw/bgimage.jpg">'),$("#info-toggle-bgimage").css("margin-left","60px")},error:function(){$("#remove-bgimage").hide(),$("#choose-bgimage").show(),$("#current-bgimage").html(""),$("#info-toggle-bgimage").css("margin-left","5px")}}),$("#cover-backdrop-enabled span").text(SESSION.json.cover_backdrop),$("#cover-blur span").text(SESSION.json.cover_blur),$("#cover-scale span").text(SESSION.json.cover_scale),$("#renderer-backdrop span").text(SESSION.json.renderer_backdrop),$("#font-size span").text(SESSION.json.font_size),$("#playlist-art-enabled span").text(SESSION.json.playlist_art),$("#extra-tags").val(SESSION.json.extra_tags),$("#play-history-enabled span").text(SESSION.json.playhist),$("#instant-play-action span").text(SESSION.json.library_instant_play),$("#albumview-sort-order span").text("by "+SESSION.json.library_albumview_sort),$("#tagview-sort-order span").text("by "+SESSION.json.library_tagview_sort),$("#recently-added span").text(getParamOrValue("param",SESSION.json.library_recently_added)),$("#show-encoded-at span").text(getParamOrValue("param",SESSION.json.library_encoded_at)),$("#cover-search-priority span").text(getParamOrValue("param",SESSION.json.library_covsearchpri)),$("#hires-thumbnails span").text(getParamOrValue("param",SESSION.json.library_hiresthm)),$("#thumbnail-columns span").text(SESSION.json.library_thumbnail_columns),$("#tag-view-artist span").text(SESSION.json.library_tagview_artist),$("#library-album-key span").text(r[1]),$("#library-inc-comment-tag span").text(r[0]),$("#ignore-articles").val(SESSION.json.library_ignore_articles),$("#show-genres-column span").text(SESSION.json.library_show_genres),$("#show-tagview-covers span").text(SESSION.json.library_tagview_covers),$("#ellipsis-limited-text span").text(SESSION.json.library_ellipsis_limited_text),$("#utf8-char-filter span").text(SESSION.json.library_utf8rep),$("#scnsaver-timeout span").text(getParamOrValue("param",SESSION.json.scnsaver_timeout)),$("#scnsaver-style span").text(SESSION.json.scnsaver_style),$("#preferences-modal").modal()},"json")}else"scnsaver"==$(this).data("cmd")?screenSaver("1"):"viewplayhistory"==$(this).data("cmd")?$.getJSON("command/moode.php?cmd=readplayhistory",function(e){var t="";for(i=1;i<e.length;i++)t+=e[i];$("ol.playhistory").html(t),$("#playhistory-modal").modal()}):"quickhelp"==$(this).data("cmd")?($("#quickhelp").load("quickhelp.html"),$("#quickhelp-modal").modal()):"aboutmoode"==$(this).data("cmd")&&($("#sys-raspbian-ver").text(SESSION.json.raspbianver),$("#sys-kernel-ver").text(SESSION.json.kernelver),$("#sys-processor-arch").text(SESSION.json.procarch),$("#sys-hardware-rev").text(SESSION.json.hdwrrev),$("#sys-mpd-ver").text(SESSION.json.mpdver),$("#about-modal").modal());"db-"==UI.dbEntry[3].substr(0,3)&&$("#"+UI.dbEntry[3]).removeClass("active")}),$("#btn-clockradio-update").click(function(e){var t,a,o,s,r,i;SESSION.json.clkradio_mode=$("#clockradio-mode span").text(),SESSION.json.clkradio_name=$("#clockradio-playname").val(),t=1==$("#clockradio-starttime-hh").val().length?"0"+$("#clockradio-starttime-hh").val():$("#clockradio-starttime-hh").val(),a=1==$("#clockradio-starttime-mm").val().length?"0"+$("#clockradio-starttime-mm").val():$("#clockradio-starttime-mm").val(),s=1==$("#clockradio-stoptime-hh").val().length?"0"+$("#clockradio-stoptime-hh").val():$("#clockradio-stoptime-hh").val(),r=1==$("#clockradio-stoptime-mm").val().length?"0"+$("#clockradio-stoptime-mm").val():$("#clockradio-stoptime-mm").val(),o=(!0===$("#clockradio-start-mon").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-tue").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-wed").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-thu").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-fri").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-sat").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-sun").prop("checked")?"1":"0"),i=(!0===$("#clockradio-stop-mon").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-tue").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-wed").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-thu").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-fri").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-sat").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-sun").prop("checked")?"1":"0"),SESSION.json.clkradio_start=t+","+a+","+$("#clockradio-starttime-ampm span").text()+","+o,SESSION.json.clkradio_stop=s+","+r+","+$("#clockradio-stoptime-ampm span").text()+","+i,SESSION.json.clkradio_volume=$("#clockradio-volume").val(),SESSION.json.clkradio_action=$("#clockradio-action span").text(),"Clock Radio"==SESSION.json.clkradio_mode||"Sleep Timer"==SESSION.json.clkradio_mode?($("#clockradio-icon").removeClass("clockradio-off"),$("#clockradio-icon").addClass("clockradio-on")):($("#clockradio-icon").removeClass("clockradio-on"),$("#clockradio-icon").addClass("clockradio-off")),"-1"!=UI.dbEntry[0]?$.getJSON("command/moode.php?cmd=getplitemfile&songpos="+UI.dbEntry[0],function(e){SESSION.json.clkradio_item=e,updateClockRadioCfgSys()}):updateClockRadioCfgSys(),notify("updclockradio")}),$("#btn-preferences-update").click(function(e){for(var t=!1,a=!1,o=!1,s=!1,r=!1,i=!1,n=!1,l=!1,c=!1,d=!1,m=!1,p=!1,b=!1,u=getMiscLibOptions(),g=[0,0,0,0,0],v=0;v<5;v++)"block"==$("#preferences-modal div.control-group").eq(v).css("display")&&(g[v]=1);if(SESSION.json.preferences_modal_state=g[0]+","+g[1]+","+g[2]+","+g[3]+","+g[4],SESSION.json.themename!=$("#theme-name span").text()&&(a=!0),SESSION.json.accent_color!=$("#accent-color span").text()&&(a=!0,t=!0),SESSION.json.alphablend!=$("#alpha-blend span").text()&&(a=!0),SESSION.json.adaptive!=$("#adaptive-enabled span").text()&&(a=!0),SESSION.json.cover_backdrop!=$("#cover-backdrop-enabled span").text()&&(a=!0),SESSION.json.cover_blur!=$("#cover-blur span").text()&&(a=!0),SESSION.json.cover_scale!=$("#cover-scale span").text()&&(a=!0),SESSION.json.render_backdrop,$("#renderer-backdrop span").text(),SESSION.json.font_size!=$("#font-size span").text()&&(m=!0),SESSION.json.playlist_art!=$("#playlist-art-enabled span").text()&&(p=!0),SESSION.json.extra_tags!=$("#extra-tags").val()&&(c=!0),SESSION.json.playhist!=$("#play-history-enabled span").text()&&(d=!0),SESSION.json.library_instant_play!=$("#instant-play-action span").text()&&(o=!0),SESSION.json.library_albumview_sort!=$("#albumview-sort-order span").text().replace("by ","")&&(o=!0),SESSION.json.library_tagview_sort!=$("#tagview-sort-order span").text().replace("by ","")&&(o=!0),SESSION.json.library_recently_added!=getParamOrValue("value",$("#recently-added span").text())&&(o=!0),SESSION.json.library_encoded_at!=getParamOrValue("value",$("#show-encoded-at span").text())&&(r=!0),SESSION.json.library_covsearchpri!=getParamOrValue("value",$("#cover-search-priority span").text())&&(o=!0),SESSION.json.library_hiresthm!=getParamOrValue("value",$("#hires-thumbnails span").text())&&(i=!0),SESSION.json.library_thumbnail_columns!=$("#thumbnail-columns span").text()&&(b=!0),SESSION.json.library_tagview_artist!=$("#tag-view-artist span").text()&&(o=!0),u[1]!=$("#library-album-key span").text()&&(s=!0),u[0]!=$("#library-inc-comment-tag span").text()&&(s=!0),SESSION.json.library_ignore_articles!=$("#ignore-articles").val()&&(o=!0),SESSION.json.library_show_genres!=$("#show-genres-column span").text()&&("Yes"==$("#show-genres-column span").text()?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre")),SESSION.json.library_tagview_covers!=$("#show-tagview-covers span").text()&&(o=!0),SESSION.json.library_ellipsis_limited_text!=$("#ellipsis-limited-text span").text()&&("Yes"==$("#ellipsis-limited-text span").text()?$("#library-panel, #radio-panel").addClass("limited"):$("#library-panel, #radio-panel").removeClass("limited")),SESSION.json.library_utf8rep!=$("#utf8-char-filter span").text()&&(o=!0),SESSION.json.scnsaver_timeout!=getParamOrValue("value",$("#scnsaver-timeout span").text())&&(n=!0),SESSION.json.scnsaver_style!=$("#scnsaver-style span").text()&&(l=!0),SESSION.json.themename=$("#theme-name span").text(),SESSION.json.accent_color=$("#accent-color span").text(),SESSION.json.alphablend=$("#alpha-blend span").text(),SESSION.json.adaptive=$("#adaptive-enabled span").text(),SESSION.json.cover_backdrop=$("#cover-backdrop-enabled span").text(),SESSION.json.cover_blur=$("#cover-blur span").text(),SESSION.json.cover_scale=$("#cover-scale span").text(),SESSION.json.renderer_backdrop=$("#renderer-backdrop span").text(),SESSION.json.font_size=$("#font-size span").text(),SESSION.json.playlist_art=$("#playlist-art-enabled span").text(),SESSION.json.extra_tags=$("#extra-tags").val(),SESSION.json.playhist=$("#play-history-enabled span").text(),SESSION.json.library_instant_play=$("#instant-play-action span").text(),SESSION.json.library_albumview_sort=$("#albumview-sort-order span").text().replace("by ",""),SESSION.json.library_tagview_sort=$("#tagview-sort-order span").text().replace("by ",""),SESSION.json.library_recently_added=getParamOrValue("value",$("#recently-added span").text()),SESSION.json.library_encoded_at=getParamOrValue("value",$("#show-encoded-at span").text()),SESSION.json.library_covsearchpri=getParamOrValue("value",$("#cover-search-priority span").text()),SESSION.json.library_hiresthm=getParamOrValue("value",$("#hires-thumbnails span").text()),SESSION.json.library_thumbnail_columns=$("#thumbnail-columns span").text(),SESSION.json.library_tagview_artist=$("#tag-view-artist span").text(),SESSION.json.library_misc_options=$("#library-inc-comment-tag span").text()+","+$("#library-album-key span").text(),SESSION.json.library_ignore_articles=$("#ignore-articles").val().trim(),SESSION.json.library_show_genres=$("#show-genres-column span").text(),SESSION.json.library_tagview_covers=$("#show-tagview-covers span").text(),SESSION.json.library_ellipsis_limited_text=$("#ellipsis-limited-text span").text(),SESSION.json.library_utf8rep=$("#utf8-char-filter span").text(),SESSION.json.scnsaver_timeout=getParamOrValue("value",$("#scnsaver-timeout span").text()),SESSION.json.scnsaver_style=$("#scnsaver-style span").text(),1==m&&(setFontSize(),window.dispatchEvent(new Event("resize"))),1==n&&$.get("command/moode.php?cmd=resetscnsaver"),1==s&&$.get("command/moode.php?cmd=clear_libcache_all"),1==t&&(accentColor=themeToColors(SESSION.json.accent_color),$(".playbackknob").trigger("configure",{fgColor:accentColor}),$(".volumeknob").trigger("configure",{fgColor:accentColor})),1==a){themeColor=str2hex(THEME.json[SESSION.json.themename].tx_color),themeBack="rgba("+THEME.json[SESSION.json.themename].bg_color+","+SESSION.json.alphablend+")";var S=splitColor(adaptBack);adaptBack="rgba("+S[0]+","+S[1]+","+S[2]+","+SESSION.json.alphablend+")",themeMcolor=str2hex(THEME.json[SESSION.json.themename].tx_color),tempcolor=THEME.json[SESSION.json.themename].mbg_color.split(","),themeMback="rgba("+tempcolor[0]+","+tempcolor[1]+","+tempcolor[2]+","+themeOp+")",lastYIQ=0,"Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#cover-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):$("#cover-backdrop").html(""),setColors()}1==p&&renderPlaylist(MPD.json.state),b&&getThumbHW(),$.post("command/moode.php?cmd=updcfgsystem",{themename:SESSION.json.themename,accent_color:SESSION.json.accent_color,alphablend:SESSION.json.alphablend,adaptive:SESSION.json.adaptive,cover_backdrop:SESSION.json.cover_backdrop,cover_blur:SESSION.json.cover_blur,cover_scale:SESSION.json.cover_scale,renderer_backdrop:SESSION.json.renderer_backdrop,font_size:SESSION.json.font_size,playlist_art:SESSION.json.playlist_art,extra_tags:SESSION.json.extra_tags,playhist:SESSION.json.playhist,library_instant_play:SESSION.json.library_instant_play,library_albumview_sort:SESSION.json.library_albumview_sort,library_tagview_sort:SESSION.json.library_tagview_sort,library_recently_added:SESSION.json.library_recently_added,library_encoded_at:SESSION.json.library_encoded_at,library_covsearchpri:SESSION.json.library_covsearchpri,library_hiresthm:SESSION.json.library_hiresthm,library_thumbnail_columns:SESSION.json.library_thumbnail_columns,library_tagview_artist:SESSION.json.library_tagview_artist,library_misc_options:SESSION.json.library_misc_options,library_ignore_articles:SESSION.json.library_ignore_articles,library_show_genres:SESSION.json.library_show_genres,library_tagview_covers:SESSION.json.library_tagview_covers,library_ellipsis_limited_text:SESSION.json.library_ellipsis_limited_text,library_utf8rep:SESSION.json.library_utf8rep,scnsaver_timeout:SESSION.json.scnsaver_timeout,scnsaver_style:SESSION.json.scnsaver_style,preferences_modal_state:SESSION.json.preferences_modal_state},function(){c||l||d||o||s||""!=SESSION.json.bgimage&&"No"==SESSION.json.cover_backdrop||1==UI.bgImgChange?(notify("settings_updated","Auto-refresh in 2 seconds"),setTimeout(function(){location.reload(!0)},2e3)):r?($("#ra-refresh").click(),loadLibrary()):i?notify("regen_thumbs","Thumbnails must be regenerated after changing this setting",5e3):notify("settings_updated")})}),$("#remove-bgimage").click(function(e){return e.preventDefault(),""!=$("#current-bgimage").html()&&($("#choose-bgimage").show(),$("#remove-bgimage").hide(),$("#current-bgimage").html(""),$("#cover-backdrop").css("background-image",""),$("#info-toggle-bgimage").css("margin-left","5px"),$.post("command/moode.php?cmd=rmbgimage"),UI.bgImgChange=!0),!1}),$("body").on("click",".dropdown-menu .custom-select a",function(e){var t="#"+$(this).data("cmd").substr(0,$(this).data("cmd").indexOf("-sel"));$(t+" span").text($(this).text()),"clockradio-mode-sel"==$(this).data("cmd")&&setClkRadioCtls($(this).text())}),$("#system-restart").click(function(e){UI.restart="restart",notify("restart","",8e3),$.get("command/moode.php?cmd=reboot")}),$("#system-shutdown").click(function(e){UI.restart="shutdown",notify("shutdown","",8e3),$.get("command/moode.php?cmd=poweroff")}),$(window).on("scroll",function(e){UI.mobile&&"panels"==GLOBAL.scriptSection&&-1!=currentView.indexOf("playback")&&($(window).scrollTop()>1&&!showMenuTopW?($("#playback-controls").hide(),$("#container-playlist").css("visibility","visible"),$("#menu-bottom").show(),$("#menu-top").css("height",$("#menu-top").css("line-height")),$("#menu-top").css("backdrop-filter","blur(20px)"),$("#playbar-toggles .addfav").show(),$("#addfav-li, #random-album").hide(),showMenuTopW=!0):UI.mobile&&"0"==$(window).scrollTop()&&($("#container-playlist").css("visibility","hidden"),$("#playback-controls").css("display",""),$("#menu-bottom").hide(),$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),showMenuTopW=!1))}),$("#index-genres li").on("click",function(e){listLook("genresList li","genres",$(this).text())}),$("#index-artists li").on("click",function(e){listLook("artistsList li","artists",$(this).text())}),$("#index-albums li").on("click",function(e){className=SESSION.json.library_tagview_sort.toLowerCase().split("/"),"Yes"==SESSION.json.library_tagview_covers?classPrefix="-name-art":classPrefix="-name",listLook("albumsList li "+("."+className[0]+classPrefix),"albums",$(this).text())}),$("#index-albumcovers li").on("click",function(e){listLook("albumcovers li "+("."+SESSION.json.library_albumview_sort.toLowerCase()+"-name").replace(/\/year/g,""),"albumcovers",$(this).text())}),$("#index-browse li").on("click",function(e){listLook("database li","folder",$(this).text())}),$("#index-radio li").on("click",function(e){list="No grouping"==SESSION.json.radioview_sort_group.split(",")[1]?"radio":"radio_headers",listLook("radiocovers li",list,$(this).text())}),$("#coverart-url, #playback-switch").click(function(e){$("#playback-panel").hasClass("cv")?e.stopImmediatePropagation():($("#coverart-link").hide(),currentView=currentView.split(",")[1],$("#container-playlist").css("visibility","hidden"),$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),$("#menu-bottom, .viewswitch").css("display","flex"),syncTimers(),"tag"==currentView?(makeActive(".tag-view-btn","#library-panel","tag"),GLOBAL.libRendered||loadLibrary()):"album"==currentView?(makeActive(".album-view-btn","#library-panel","album"),UI.libPos[1]>=0&&"Hide tracks"==$("#tracklist-toggle").text().trim()&&($("#bottom-row").css("display","flex"),$("#lib-albumcover").css("height","calc(50% - env(safe-area-inset-top) - 2.75rem)"),$("#index-albumcovers").hide()),GLOBAL.libRendered||loadLibrary()):"radio"==currentView?makeActive(".radio-view-btn","#radio-panel",currentView):makeActive(".folder-view-btn","#folder-panel","folder"))}),$("#playbar-switch, #playbar-cover, #playbar-title").click(function(e){if(!coverView)if("Yes"==SESSION.json.playlist_art&&lazyLode("playlist"),0==currentView.indexOf("playback"))$(window).scrollTop(0);else{if(currentView="playback,"+currentView,$.post("command/moode.php?cmd=updcfgsystem",{current_view:currentView}),syncTimers(),setColors(),$("#coverart-link").show(),$("#menu-header").text(""),$("#container-playlist").css("visibility",""),$("#menu-bottom, .viewswitch").css("display","none"),$("#playback-controls").css("display",""),$("#addfav-li").hide(),UI.mobile){showMenuTopW=!1,$(window).scrollTop(0),$("#content").css("height","unset"),$("#container-playlist").css("visibility","hidden");var t=$("#countdown-display").text()?$("#m-countdown").text(t):$("#m-countdown").text("00:00")}else customScroll("playlist",parseInt(MPD.json.song),0);$("#folder-panel, #radio-panel, #library-panel").removeClass("active"),$("#playback-panel").addClass("active")}}),$("#context-backdrop").click(function(e){$("#context-backdrop").hide(),$(".context-menu").removeClass("open"),$(".context-menu-lib").removeClass("open"),"folder"==currentView||"radio"==currentView?$("#"+UI.dbEntry[3]).removeClass("active"):"tag"==currentView?($("#lib-song-"+(UI.dbEntry[0]+1).toString()).removeClass("active"),$("img.lib-coverart").removeClass("active")):"album"==currentView&&$("#albumcovers .lib-entry").eq(UI.libPos[1]).removeClass("active")}),$("#preferences-modal .h5").click(function(e){$(this).parent("div.accordian").toggleClass("active")}),$.ensure=function(e){var t=$.Deferred(),a=setInterval(function(){$(e)[0]&&(clearInterval(a),t.resolve())},1);return t};
