/*!
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-MM-DD TC moOde 7.0.0
 *
 */
const FEAT_KERNEL=1,FEAT_AIRPLAY=2,FEAT_MINIDLNA=4,FEAT_MPDAS=8,FEAT_SQUEEZELITE=16,FEAT_UPMPDCLI=32,FEAT_SQSHCHK=64,FEAT_GMUSICAPI=128,FEAT_LOCALUI=256,FEAT_INPSOURCE=512,FEAT_UPNPSYNC=1024,FEAT_SPOTIFY=2048,FEAT_GPIO=4096,FEAT_DJMOUNT=8192,FEAT_BLUETOOTH=16384,FEAT_DEVTWEAKS=32768,DEFAULT_TIMEOUT=250,SEARCH_TIMEOUT=750,LAZYLOAD_TIMEOUT=250,SCROLLTO_TIMEOUT=250,KNOBCOLOR_TIMEOUT=250,LIBSEARCH_TIMEOUT=250,RASEARCH_TIMEOUT=750,PLSEARCH_TIMEOUT=750,PHSEARCH_TIMEOUT=750,CLRPLAY_TIMEOUT=500,RALBUM_TIMEOUT=1500,ENGINE_TIMEOUT=3e3;var themeColor,themeBack,themeMcolor,tempcolor,themeOp,themeMback,adaptColor,adaptBack,adaptMhalf,adaptMcolor,adaptMback,tempback,accentColor,abFound,showMenuTopW,showMenuTopR,alphabitsFilter,UI={knob:null,path:"",restart:"",currentFile:"blank",currentHash:"blank",currentSongId:"blank",defCover:"images/default-cover-v6.svg",knobPainted:!1,chipOptions:"",hideReconnect:!1,bgImgChange:!1,clientIP:"",dbPos:[0,0,0,0,0,0,0,0,0,0,0],dbEntry:["","","","",""],dbCmd:"",libPos:[-1,-1,-1],radioPos:-1,libAlbum:"",mobile:!1},MPD={json:0},SESSION={json:0},RADIO={json:0},THEME={json:0},NETWORK={json:0},GLOBAL={musicScope:"all",searchLib:"",searchRadio:"",searchFolder:"",scriptSection:"panels",regExIgnoreArticles:"",libRendered:!1,libLoading:!1,playbarPlaylistTimer:"",plActionClicked:!1,mpdMaxVolume:0,lastTimeCount:0,editStationId:"",nativeLazyLoad:!1,playlistChanged:!1},timeSliderMove=!1,thumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='3.5'/></svg>",thumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='3.5'/></svg>",fatthumbw="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23f0f0f0' cx='6.5' cy='10' r='5.5'/></svg>",fatthumbd="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='13' height='20'><circle fill='%23303030' cx='6.5' cy='10' r='5.5'/></svg>",blurrr=CSS.supports("-webkit-backdrop-filter","blur(1px)"),dbFilterResults=[],searchTimer="",showSearchResetPl=!1,showSearchResetLib=!1,showSearchResetRa=!1,showSearchResetPh=!1,eqGainUpdInterval="",toolbarTimer="",toggleSongId="blank",currentView="playback",lastYIQ="",coverView=!1;function debugLog(e){"1"==SESSION.json.debuglog&&console.log(Date.now()+": "+e)}function sendMpdCmd(e,t){void 0===t&&(t=!0),$.ajax({type:"GET",url:"command/index.php?cmd="+e,async:t,cache:!1,success:function(e){}})}function sendVolCmd(e,t,o,a){var s;return void 0===o&&(o=""),void 0===a&&(a=!1),$.ajax({type:e,url:"command/moode.php?cmd="+t,async:a,cache:!1,data:o,success:function(e){s=JSON.parse(e)},error:function(){s=!1}}),s}function engineMpd(){$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){try{MPD.json=JSON.parse(e)}catch(e){MPD.json.error=e}if(void 0===MPD.json.error)!0===UI.hideReconnect&&hideReconnect(),MPD.json.idle_timeout_event,"changed: update"==MPD.json.idle_timeout_event?void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide():"changed: mixer"==MPD.json.idle_timeout_event?renderUIVol():"changed: player"==MPD.json.idle_timeout_event&&null==MPD.json.file?resetPlayCtls():renderUI(),engineMpd();else{if(debugLog("engineMpd(): success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),"object"==typeof MPD.json.error){var t=void 0===MPD.json.error.code?"":" ("+MPD.json.error.code+")";"JSON Parse error: Unexpected EOF"!=MPD.json.error.message&&notify("mpderror",MPD.json.error.message+t)}else'Failed to open "ALSA bluetooth" (alsa); Failed to open ALSA device "btstream": No such device'==MPD.json.error?notify("mpderror","Failed to open ALSA bluetooth output, no such device or connection"):"SyntaxError: JSON Parse error: Unexpected EOF"==MPD.json.error?notify("mpderror","JSON Parse error: Unexpected EOF"):"Not seekable"==MPD.json.error||notify("mpderror",MPD.json.error);renderUI(),setTimeout(function(){engineMpd()},ENGINE_TIMEOUT)}},error:function(e){debugLog("engineMpd(): error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpd()},ENGINE_TIMEOUT)}})}function engineMpdLite(){$.ajax({type:"GET",url:"engine-mpd.php?state="+MPD.json.state,async:!0,cache:!1,success:function(e){try{MPD.json=JSON.parse(e)}catch(e){MPD.json.error=e}void 0===MPD.json.error?(!0===UI.hideReconnect&&hideReconnect(),void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide(),engineMpdLite()):setTimeout(function(){debugLog("engineMpdLite(): success branch: error=("+MPD.json.error+"), module=("+MPD.json.module+")"),engineMpdLite()},ENGINE_TIMEOUT)},error:function(e){debugLog("engineMpdLite(): error branch: data=("+JSON.stringify(e)+")"),setTimeout(function(){"error"==e.statusText&&0==e.readyState&&renderReconnect(),MPD.json.state="reconnect",engineMpdLite()},ENGINE_TIMEOUT)}})}function engineCmd(){var e;$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(t){switch((e=JSON.parse(t).split(","))[0]){case"inpactive1":case"inpactive0":inpSrcIndicator(e[0],e[1]+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>');break;case"btactive1":case"btactive0":inpSrcIndicator(e[0],"Bluetooth Active"+e[1]+'<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>');break;case"aplactive1":case"aplactive0":inpSrcIndicator(e[0],'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>');break;case"spotactive1":case"spotactive0":inpSrcIndicator(e[0],'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>');break;case"slactive1":case"slactive0":inpSrcIndicator(e[0],'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>');break;case"scnactive1":screenSaver(e[0]);break;case"libupd_done":$(".busy-spinner").hide(),loadLibrary();break;case"set_logo_image1":$(".busy-spinner").show();break;case"set_logo_image0":$(".busy-spinner").hide()}engineCmd()},error:function(e){setTimeout(function(){engineCmd()},ENGINE_TIMEOUT)}})}function engineCmdLite(){$.ajax({type:"GET",url:"engine-cmd.php",async:!0,cache:!1,success:function(e){"libregen_done"==JSON.parse(e).split(",")[0]&&($(".busy-spinner").hide(),loadLibrary()),engineCmdLite()},error:function(e){setTimeout(function(){engineCmdLite()},ENGINE_TIMEOUT)}})}function inpSrcIndicator(e,t){if(UI.currentFile="blank","1"==e.slice(-1)){$("#inpsrc-indicator").css("display","block"),$("#inpsrc-msg").html(t);var o="disabled"==SESSION.json.mpdmixer?"0dB":SESSION.json.volknob;$("#inpsrc-preamp-volume").text(o)}else $("#inpsrc-msg").html(""),$("#inpsrc-indicator").css("display","")}function screenSaver(e){"block"==$("#inpsrc-indicator").css("display")||UI.mobile||"1"==e.slice(-1)&&($("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),$("body").addClass("cv"),$("#lib-coverart-img").hide(),coverView=!0)}function renderReconnect(){"restart"==UI.restart?$("#restart").show():"shutdown"==UI.restart?$("#shutdown").show():$("#reconnect").show(),$("#countdown-display, #m-countdown, #playbar-countdown").countdown("pause"),window.clearInterval(UI.knob),UI.hideReconnect=!0}function hideReconnect(){$("#reconnect, #restart, #shutdown").hide(),UI.hideReconnect=!1}function disableVolKnob(){SESSION.json.volmute,$("#volumedn, #volumeup, #volumedn-2, #volumeup-2").prop("disabled",!0),$("#volumeup, #volumedn, #volumedn-2, #volumeup-2, .volume-display").css("opacity",".3"),$(".volume-display div, #inpsrc-preamp-volume").text("0dB"),$(".volume-display").css("cursor","unset"),UI.mobile&&($("#mvol-progress").css("width","100%"),$(".repeat").show(),$(".volume-popup-btn").hide())}function resetPlayCtls(){$("#m-total, #playbar-total, #playbar-mtotal").html(updTimeKnob("0")),$(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),$("#total").html(updTimeKnob("0")+("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?'<i class="fas fa-caret-up countdown-caret"></i>':'<i class="fas fa-caret-down countdown-caret"></i>')),$(".playlist li.active ").removeClass("active"),refreshTimeKnob(),refreshTimer(0,0,MPD.json.state),$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").html("00:00")}function renderUIVol(){$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){!1===e?console.log("renderUIVol(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(SESSION.json.feat_bitmask&FEAT_UPNPSYNC&&"0"==SESSION.json.btactive&&"0"==SESSION.json.airplayactv&&"0"==SESSION.json.slsvc&&SESSION.json.volknob!=MPD.json.volume&&"0"==SESSION.json.volmute&&(SESSION.json.volknob=MPD.json.volume,$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob})),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume").text(SESSION.json.volknob),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?$(".volume-display div, #inpsrc-preamp-volume").text("mute"):$(".volume-display div").text(SESSION.json.volknob))})}function renderUI(){if("Radio station"!=MPD.json.artist&&$("#songsList li").length>0)for(i=0;i<filteredSongs.length;i++)if(filteredSongs[i].title==MPD.json.title){$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight"),$("#lib-song-"+(i+1)+" .lib-entry-song .songtrack").addClass("lib-track-highlight");break}$.getJSON("command/moode.php?cmd=readcfgsystem",function(e){if(!1===e?console.log("renderUI(): No data returned from readcfgsystem"):SESSION.json=e,"disabled"==SESSION.json.mpdmixer?disableVolKnob():(UI.mobile&&$(".volume-popup-btn").show(),$("#volume").val(SESSION.json.volknob).trigger("change"),$(".volume-display div, #inpsrc-preamp-volume").text(SESSION.json.volknob),$("#volume-2").val(SESSION.json.volknob).trigger("change"),$("#mvol-progress").css("width",SESSION.json.volknob+"%"),"1"==SESSION.json.volmute?$(".volume-display div, #inpsrc-preamp-volume").text("mute"):$(".volume-display div").text(SESSION.json.volknob)),"play"==MPD.json.state?($(".play i").removeClass("fas fa-play").addClass("fas fa-pause"),$(".playlist li.active").removeClass("active"),$(".playlist li:nth-child("+(parseInt(MPD.json.song)+1)+")").addClass("active")):"pause"!=MPD.json.state&&"stop"!=MPD.json.state||$(".play i").removeClass("fas fa-pause").addClass("fas fa-play"),$("#total").html(updTimeKnob(MPD.json.time?MPD.json.time:0)+("Radio station"==MPD.json.artist?"":"1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?'<i class="fas fa-caret-up countdown-caret"></i>':'<i class="fas fa-caret-down countdown-caret"></i>')),$("#m-total, #playbar-total").html(updTimeKnob(MPD.json.time?MPD.json.time:0)),$("#playbar-mtotal").html("&nbsp;/&nbsp;"+updTimeKnob(MPD.json.time)),$("#playbar-total").text().length>5?$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").addClass("long-time"):$("#playbar-countdown, #m-countdown, #playbar-total, #m-total").removeClass("long-time"),MPD.json.file!==UI.currentFile&&MPD.json.cover_art_hash!==UI.currentHash){if($("#coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" data-adaptive-background="1" alt="Cover art not found">'),MPD.json.file){var t="Radio station"==MPD.json.artist?encodeURIComponent(MPD.json.coverurl.replace("imagesw/radio-logos","imagesw/radio-logos/thumbs")):"/imagesw/thmcache/"+encodeURIComponent($.md5(MPD.json.file.substring(0,MPD.json.file.lastIndexOf("/"))))+".jpg";$("#playbar-cover").html('<img src="'+t+'">')}else $("#playbar-cover").html('<img src="'+UI.defCover+'">');"Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#cover-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):""!=SESSION.json.bgimage&&($("#cover-backdrop").html('<img class="ss-backdrop" src="'+SESSION.json.bgimage+'">'),$("#cover-backdrop").css("filter","blur(0px)"),$("#cover-backdrop").css("transform","scale(1.0)")),$("#ss-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),coverView&&$("#ss-coverart-url").html('<img class="coverart" src="'+MPD.json.coverurl+'" alt="Cover art not found">'),-1===MPD.json.coverurl.indexOf("default-cover-v6")?$.adaptiveBackground.run():setColors()}if("stop"===MPD.json.state)$("#extra-tags-display").html("Not playing");else if("none"==SESSION.json.extra_tags.toLowerCase()||""==SESSION.json.extra_tags)$("#extra-tags-display").html("");else if("Radio station"==MPD.json.artist)$("#extra-tags-display").html(MPD.json.bitrate?MPD.json.bitrate:"Variable bitrate");else{var o;(o=formatExtraTagsString())?$("#extra-tags-display").html(o):$("#extra-tags-display").html(MPD.json.audio_sample_depth+"/"+MPD.json.audio_sample_rate)}MPD.json.album?($("#currentalbum").html("Radio station"==MPD.json.artist?MPD.json.album:MPD.json.artist+" - "+MPD.json.album),$("#playbar-currentalbum, #ss-currentalbum").html("Radio station"==MPD.json.artist?-1!=MPD.json.file.indexOf("somafm")?RADIO.json[MPD.json.file].name:MPD.json.album:MPD.json.artist+" - "+MPD.json.album)):$("#currentalbum, #playbar-currentalbum, #ss-currentalbum").html(""),"Streaming source"===MPD.json.title||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(MPD.json.title):$("#currentsong").html(genSearchUrl(MPD.json.artist,MPD.json.title,MPD.json.album)),$("#playbar-currentsong, #ss-currentsong").html(MPD.json.title),UI.currentSongId!=MPD.json.songid&&(toggleSongId="blank"==UI.currentSongId?SESSION.json.toggle_songid:UI.currentSongId,$.post("command/moode.php?cmd=updcfgsystem",{toggle_songid:toggleSongId})),UI.currentFile=MPD.json.file,UI.currentHash=MPD.json.cover_art_hash,UI.currentSongId=MPD.json.songid,"1"===MPD.json.consume?($(".consume").addClass("btn-primary"),$("#menu-check-consume").show()):($(".consume").removeClass("btn-primary"),$("#menu-check-consume").hide()),"1"===MPD.json.repeat?($(".repeat").addClass("btn-primary"),$("#menu-check-repeat").show()):($(".repeat").removeClass("btn-primary"),$("#menu-check-repeat").hide()),"1"===MPD.json.single?($(".single").addClass("btn-primary"),$("#menu-check-single").show()):($(".single").removeClass("btn-primary"),$("#menu-check-single").hide()),"1"===SESSION.json.ashufflesvc?"1"===SESSION.json.ashuffle?($(".random, .consume").addClass("btn-primary"),$("#songsList .lib-entry-song .songtrack").removeClass("lib-track-highlight")):$(".random").removeClass("btn-primary"):"1"===MPD.json.random?$(".random").addClass("btn-primary"):$(".random").removeClass("btn-primary"),"1"===SESSION.json.timecountup||0===parseInt(MPD.json.time)?refreshTimer(parseInt(MPD.json.elapsed),parseInt(MPD.json.time),MPD.json.state):refreshTimer(parseInt(MPD.json.time-parseInt(MPD.json.elapsed)),0,MPD.json.state),0!==parseInt(MPD.json.time)&&(UI.knobPainted=!1),"play"!==MPD.json.state&&"pause"!==MPD.json.state||!1!==UI.knobPainted||refreshTimeKnob(),"stop"===MPD.json.state&&refreshTimeKnob(),void 0===MPD.json.idle_timeout_event||"changed: playlist"==MPD.json.idle_timeout_event||1==GLOBAL.playlistChanged?renderPlaylist():updateActivePlItem(),"1"==SESSION.json.inpactive&&inpSrcIndicator("inpactive1",SESSION.json.audioin+' Input Active: <button class="btn volume-popup-btn" data-toggle="modal"><i class="fal fa-volume-up"></i></button><span id="inpsrc-preamp-volume"></span><br><a class="btn configure-renderer" href="inp-config.php">Input Source</a>'),"1"==SESSION.json.btactive&&inpSrcIndicator("btactive1",'Bluetooth Active<br><a class="btn configure-renderer" href="blu-config.php">BlueZ Config</a>'),"1"==SESSION.json.airplayactv&&inpSrcIndicator("aplactive1",'Airplay Active<br><button class="btn disconnect-renderer" data-job="airplaysvc">disconnect</button>'),"1"==SESSION.json.spotactive&&inpSrcIndicator("spotactive1",'Spotify Active<br><button class="btn disconnect-renderer" data-job="spotifysvc">disconnect</button>'),"1"==SESSION.json.slactive&&inpSrcIndicator("slactive1",'Squeezelite Active<br><button class="btn disconnect-renderer" data-job="slsvc">turn off</button>'),void 0!==MPD.json.updating_db?$(".busy-spinner").show():$(".busy-spinner").hide()})}function genSearchUrl(e,t,o){if(void 0===e||"Radio station"===e){var a=t.replace(/-/g," ");a=(a=a.replace(/&/g," ")).replace(/\s+/g,"+")}else a=e+"+"+o;return'<a id="coverart-link" href="http://www.google.com/search?q='+a+'" target="_blank">'+t+"</a>"}function updateActivePlItem(){$.getJSON("command/moode.php?cmd=playlist",function(e){if(e)for(i=0;i<e.length;i++)i==parseInt(MPD.json.song)&&(void 0!==e[i].Name||"http"==e[i].file.substr(0,4)&&void 0===e[i].Artist&&void 0===e[i].Comment)&&(void 0===e[i].Title||""==e[i].Title.trim()||"http://stream.radioactive.fm"==e[i].file?$("#pl-"+(parseInt(MPD.json.song)+1).toString()+" .pll1").html("Streaming source"):($("#pl-"+(parseInt(MPD.json.song)+1).toString()+" .pll1").html(e[i].Title),i==parseInt(MPD.json.song)&&("http"===e[i].Title.substr(0,4)||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(e[i].Title):$("#currentsong").html(genSearchUrl(e[i].Artist,e[i].Title,e[i].Album)),$("#ss-currentsong, #playbar-currentsong").html(e[i].Title))))}),setTimeout(function(){$("#playback-panel").hasClass("active")&&(customScroll("playlist",parseInt(MPD.json.song)),"block"==$("#cv-playlist").css("display")&&customScroll("cv-playlist",parseInt(MPD.json.song)))},SCROLLTO_TIMEOUT)}function renderPlaylist(){$.getJSON("command/moode.php?cmd=playlist",function(e){var t="",o=!0===GLOBAL.nativeLazyLoad?'<img loading="lazy" src=':'<img class="lazy-playlistview" data-original=';UI.dbEntry[4]=void 0===e.length?0:e.length;var a="Yes"==SESSION.json.playlist_art;if(e)for(i=0;i<e.length;i++){if(i==parseInt(MPD.json.song)?t+='<li id="pl-'+(i+1)+'" class="active pl-entry">':t+='<li id="pl-'+(i+1)+'" class="pl-entry">',void 0!==e[i].Name&&"m4a"==e[i].file.substr(e[i].file.lastIndexOf(".")+1).toLowerCase())t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">',t+=e[i].Name+"</span>",t+='<span class="pll2">',t+=void 0===e[i].Artist?"Unknown artist":e[i].Artist,t+=" - ",t+=void 0===e[i].Album?"Unknown album":e[i].Album;else if(void 0!==e[i].Name||"http"==e[i].file.substr(0,4)&&void 0===e[i].Artist&&void 0===e[i].Comment){var s=void 0===RADIO.json[e[i].file]?'"images/notfound.jpg"':'"imagesw/radio-logos/thumbs/'+encodeURIComponent(RADIO.json[e[i].file].name)+'.jpg"';if(t+=!a||void 0!==e[i].Comment&&"client=upmpdcli;"===e[i].Comment?"":'<span class="pl-thumb">'+o+s+"></span>",void 0===e[i].Title||""==e[i].Title.trim()||"http://stream.radioactive.fm"==e[i].file?(t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlis2qesfct-item">'+(void 0===e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">Streaming source</span>'):(t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">'+e[i].Title+"</span>",i==parseInt(MPD.json.song)&&("http"===e[i].Title.substr(0,4)||MPD.json.coverurl===UI.defCover||UI.mobile?$("#currentsong").html(e[i].Title):$("#currentsong").html(genSearchUrl(e[i].Artist,e[i].Title,e[i].Album)),$("#ss-currentsong, #playbar-currentsong").html(e[i].Title))),t+='<span class="pll2">',t+='<i class="fas fa-microphone"></i> ',void 0===RADIO.json[e[i].file]){var r=void 0===e[i].Name?"Radio station":e[i].Name;t+=r,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(r)}else t+=RADIO.json[e[i].file].name,i==parseInt(MPD.json.song)&&$("#playbar-currentalbum, #ss-currentalbum").html(RADIO.json[e[i].file].name)}else{if(t+=a?'<span class="pl-thumb">'+o+'"imagesw/thmcache/'+encodeURIComponent($.md5(e[i].file.substring(0,e[i].file.lastIndexOf("/"))))+'.jpg"/></span>':"",t+='<span class="pl-action" data-toggle="context" data-target="#context-menu-playlist-item">'+(void 0===e[i].Time?"":formatSongTime(e[i].Time))+"<br><b>&hellip;</b></span>",t+='<span class="pll1">',void 0===e[i].Title){var n=e[i].file.lastIndexOf(".");if(-1==n)t+=e[i].file;else{var l=e[i].file.slice(0,n);n=l.lastIndexOf("/"),t+=l.slice(n+1)}t+="</span>"}else t+=e[i].Title+"</span>";t+='<span class="pll2">',t+=void 0===e[i].Artist?"Unknown artist":e[i].Artist,t+=" - ",t+=void 0===e[i].Album?"Unknown album":e[i].Album}t+="</span></div></li>"}$("#playlist ul").html(t),$("#cv-playlist ul").html(t),a&&(lazyLode("playlist"),lazyLode("cv-playlist")),setTimeout(function(){$("#playback-panel").hasClass("active")&&(customScroll("playlist",parseInt(MPD.json.song)),"block"==$("#cv-playlist").css("display")&&customScroll("cv-playlist",parseInt(MPD.json.song)))},SCROLLTO_TIMEOUT),GLOBAL.playlistChanged=!1})}function mpdDbCmd(e,t){UI.dbCmd=e,-1!=["add","play","clradd","clrplay","addall","playall","clrplayall","update_library"].indexOf(e)?(GLOBAL.playlistChanged=!0,$.post("command/moode.php?cmd="+e,{path:t},function(e){},"json")):"lsinfo"==e||"listsavedpl"==e?$.post("command/moode.php?cmd="+e,{path:t},function(e){renderFolderView(e,t)},"json"):"lsinfo_radio"==e?renderRadioView():"delsavedpl"==e?($.post("command/moode.php?cmd="+e,{path:t},function(e){},"json"),$.post("command/moode.php?cmd=lsinfo",{path:""},function(e){renderFolderView(e,"")},"json")):"newstation"==e||"updstation"==e?("newstation"==e?notify("creating_station"):notify("updating_station"),$.post("command/moode.php?cmd="+e,{path:t},function(o){RADIO.json[t.url]={name:t.name,type:t.type,logo:t.logo},"OK"==o?notify(e):notify("validation_check",o,5e3),$("#ra-refresh").click()},"json")):"delstation"==e&&(deleteRadioStationObject(t.slice(0,t.lastIndexOf(".")).substr(6)),$.post("command/moode.php?cmd="+e,{path:t},function(){notify("delstation"),$("#ra-refresh").click()}))}function renderFolderView(e,t,o){UI.path=t;for(var a=[],s=[],r=[],n=0,i=0,l=0,c=0;c<e.length;c++)void 0!==e[c].directory&&"RADIO"!=e[c].directory?(a[n]=e[c],n+=1):void 0!==e[c].playlist?(s[i]=e[c],i+=1):void 0!==e[c].file&&-1==e[c].file.indexOf("RADIO")&&(r[l]=e[c],l+=1);try{var d=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});void 0!==a[0]&&a.sort(function(e,t){return e=-1==e.directory.lastIndexOf("/")?removeArticles(e.directory):removeArticles(e.directory.substr(e.directory.lastIndexOf("/")+1)),t=-1==t.directory.lastIndexOf("/")?removeArticles(t.directory):removeArticles(t.directory.substr(t.directory.lastIndexOf("/")+1)),d.compare(e,t)}),void 0!==s[0]&&s.sort(function(e,t){return d.compare(removeArticles(e.playlist),removeArticles(t.playlist))})}catch(e){void 0!==a[0]&&a.sort(function(e,t){return(e=-1==e.directory.lastIndexOf("/")?removeArticles(e.directory.toLowerCase()):removeArticles(e.directory.substr(e.directory.lastIndexOf("/")+1).toLowerCase()))>(t=-1==t.directory.lastIndexOf("/")?removeArticles(t.directory.toLowerCase()):removeArticles(t.directory.substr(t.directory.lastIndexOf("/")+1).toLowerCase()))?1:e<t?-1:0}),void 0!==s[0]&&s.sort(function(e,t){return(e=removeArticles(e.playlist.toLowerCase()))>(t=removeArticles(t.playlist.toLowerCase()))?1:e<t?-1:0})}if(e=a.concat(s).concat(r),$("#db-search-results").html(""),$("#db-search-results").hide(),$("#db-search-results").css("font-weight","normal"),o){var m=(e.length?e.length:"0")+" item"+(1==e.length?"":"s");$("#db-search-results").show(),$("#db-search-results").html('<a href="#notarget" data-toggle="context" data-target="#context-menu-db-search-results">'+m+"</a>")}for($("ul.database").html(""),c=0;c<e.length;c++)$("ul.database").append(formatFolderViewEntries(e,t,c));customScroll("folder",UI.dbPos[UI.dbPos[10]],100),""!=t&&UI.dbPos[UI.dbPos[10]]>1&&$("#db-"+UI.dbPos[UI.dbPos[10]].toString()).addClass("active")}function formatFolderViewEntries(e,t,o){var a="";if(""==t&&void 0!==e[o].file){var s=e[o].file.lastIndexOf("/");t=-1==s?"":e[o].file.slice(0,s)}if(void 0!==e[o].file){var r=e[o].file.substr(e[o].file.lastIndexOf(".")+1).toLowerCase();if(void 0!==e[o].Title)a='<li id="db-'+(o+1)+'" data-path="'+e[o].file+'">',a+='<div class="db-icon db-song db-action">',a+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item">',a+='<i class="fas fa-music sx db-browse db-browse-icon"></i></a></div>',a+='<div class="db-entry db-song">'+e[o].Title+' <em class="songtime">'+e[o].TimeMMSS+"</em>",a+=" <span>"+e[o].Artist+" - "+e[o].Album+"</span></div></li>";else{a='<li id="db-'+(o+1)+'" data-path="';var n="";"http"==e[o].file.substr(0,4)?n=e[o].file:(cutpos=e[o].file.lastIndexOf("."),-1!=cutpos&&(n=e[o].file.slice(0,cutpos))),a+=e[o].file;var i="";"cue"==r?(a+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder-item"><i class="fas fa-list-ul icon-root sx db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',i="CUE sheet"):"http"==e[o].file.substr(0,4)?(a+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item" style="width:100vw;height:2em;"><i class="fas fa-microphone sx db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',i=void 0===RADIO.json[e[o].file]?"Radio station":RADIO.json[e[o].file].name):(a+='"><div class="db-icon db-song db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-item" style="width:100vw;height:2em;"><i class="fas fa-music sx db-browse db-browse-icon"></i></a></div><div class="db-entry db-song db-browse">',i="Song file"),a+=n.replace(t+"/",""),a+=" <span>",a+=i,a+="</span></div></li>"}}else void 0!==e[o].playlist?"wv"==e[o].playlist.substr(e[o].playlist.lastIndexOf(".")+1).toLowerCase()?a="":(a='<li id="db-'+(o+1)+'" data-path="'+e[o].playlist+'">',a+='<div class="db-icon db-action">',a+='<a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-savedpl-root">',a+='<i class="fas fa-list-ul icon-root sx"></i></a></div>',a+='<div class="db-entry db-savedplaylist db-browse">'+e[o].playlist,a+="</div></li>"):(a='<li id="db-'+(o+1)+'" data-path="',a+=e[o].directory,""==t?a+='"><div class="db-icon db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder"><i class="fas fa-hdd icon-root sx"></i></a></div><div class="db-entry db-folder db-browse">':(a+='"><div class="db-icon db-browse db-action"><a class="btn" href="#notarget" data-toggle="context" data-target="#context-menu-folder">',a+=""!=e[o].cover_url?'<img src="'+e[o].cover_url+'">':'<i class="fas fa-folder sx"></i>',a+="</a></div>",a+='<div class="db-entry db-folder db-browse">'),a+=e[o].directory.replace(t+"/",""),a+="</div></li>");return a}function renderRadioView(){$.getJSON("command/moode.php?cmd=read_cfg_radio",function(e){var t=GLOBAL.nativeLazyLoad?'<img loading="lazy" src="':'<img class="lazy-radioview" data-original="',o=SESSION.json.radioview_sort_group.split(",")[0].toLowerCase(),a=SESSION.json.radioview_sort_group.split(",")[1],s=a,r=SESSION.json.radioview_show_hide.split(",")[0],n=SESSION.json.radioview_show_hide.split(",")[1];if("Hide all"==r||"Un-hide all"==r){for(var i="Hide all"==r?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)<499&&"f"!=e[l].type&&(e[l].type=i);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Moode",stationType:i}),SESSION.json.radioview_show_hide="No action,"+n}if("Hide geo-fenced"==r||"Un-hide geo-fenced"==r){for(i="Hide geo-fenced"==r?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)<499&&"f"!=e[l].type&&"Yes"==e[l].geo_fenced&&(e[l].type=i);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Moode geo-fenced",stationType:i}),SESSION.json.radioview_show_hide="No action,"+n}if("Hide all"==n||"Un-hide all"==n){for(i="Hide all"==n?"h":"r",l=0;l<e.length;l++)parseInt(e[l].id)>499&&"f"!=e[l].type&&(e[l].type=i);e.length>0&&$.post("command/moode.php?cmd=upd_cfg_radio_show_hide",{stationBlock:"Other",stationType:i}),SESSION.json.radioview_show_hide=r+",No action"}var c=[],d=[],m=[],p=[],u=[],b=0,v=0,h=0,g=0,S=0;for(l=0;l<e.length;l++)switch(e[l].type){case"r":c[b]=e[l],b+=1,d[v]=e[l],v+=1;break;case"f":c[b]=e[l],b+=1,m[h]=e[l],h+=1;break;case"h":parseInt(e[l].id)<499?(p[g]=e[l],g+=1):(u[S]=e[l],S+=1)}try{var y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});c.sort(function(e,t){return"name"==o?y.compare(removeArticles(e[o]),removeArticles(t[o])):"genre"==o?y.compare(removeArticles(e[o].split(", ")[0]),removeArticles(t[o].split(", ")[0])):y.compare(e[o],t[o])})}catch(e){c.sort(function(e,t){return"name"==o?(e=removeArticles(e[o]))>(t=removeArticles(t[o]))?1:e<t?-1:0:"genre"==o?(e=removeArticles(e[o].split(", ")[0]))>(t=removeArticles(t[o].split(", ")[0]))?1:e<t?-1:0:y.compare(e[o],t[o])})}try{y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});d.sort(function(e,t){return"name"==o?y.compare(removeArticles(e[o]),removeArticles(t[o])):"genre"==o?y.compare(removeArticles(e[o].split(", ")[0]),removeArticles(t[o].split(", ")[0])):y.compare(e[o],t[o])})}catch(e){d.sort(function(e,t){return"name"==o?(e=removeArticles(e[o]))>(t=removeArticles(t[o]))?1:e<t?-1:0:"genre"==o?(e=removeArticles(e[o].split(", ")[0]))>(t=removeArticles(t[o].split(", ")[0]))?1:e<t?-1:0:y.compare(e[o],t[o])})}try{y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});m.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))})}catch(e){m.sort(function(e,t){return(e=removeArticles(e.name))>(t=removeArticles(t.name))?1:e<t?-1:0})}try{y=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});p.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))}),u.sort(function(e,t){return y.compare(removeArticles(e.name),removeArticles(t.name))})}catch(e){u.sort(function(e,t){return(e=removeArticles(e.name))>(t=removeArticles(t.name))?1:e<t?-1:0}),u.sort(function(e,t){return(e=removeArticles(e.name))>(t=removeArticles(t.name))?1:e<t?-1:0})}"Show hidden"==r?e=p:"Show hidden"==n?e=u:"Favorites first"==a?e=m.concat(d):"Sort tag"!=a&&"No grouping"!=a||(e=c);var f=parseInt(SESSION.json.library_encoded_at),I="",w="",j="",O="",k=!0;"Favorites first"==a&&m.length>0&&(O='<li class="horiz-rule-radioview">Favorites</li>',k=!1),$(".btnlist-top-ra").show(),$("#searchResetRa").hide(),showSearchResetRa=!1,$("#ra-search-keyword").val(""),$("#ra-filter").val("");var _=!1,E="";for(l=0;l<e.length;l++){if(9!=f){var x=parseInt(e[l].bitrate),N=e[l].bitrate+"K "+e[l].format;I=f<=1?'<div class="encoded-at-notvisible">'+N+"</div>":"",w=1==f&&x>128?'<div class="encoded-at-hdonly">HD</div>':"",j=3==f?'<div class="encoded-at-badge">'+N+"</div>":""}var M="genre"==o?'<div class="radioview-metadata-text">'+e[l].genre.substr(e[l].genre.indexOf(", ")+1)+"</div>":"",P="region"==o?'<div class="radioview-metadata-text">'+e[l].country+"</div>":"",L="bitrate"==o||"format"==o?'<div class="radioview-metadata-text">'+e[l].bitrate+"K "+e[l].format+"</div>":"";if("Favorites first"==a&&"f"==e[l].type||"No grouping"!=a&&(a="Sort tag"),"Favorites first"==s&&!1===k&&"f"!=e[l].type&&""!=E&&(E="",k=!0),"Sort tag"==a){var T=removeArticles(e[l][o]).substr(0,1).toUpperCase(),C=removeArticles(E).substr(0,1).toUpperCase();"name"==o&&T!=C?!1===isNaN(T)&&!1===_?(O+='<li class="horiz-rule-radioview">0-9</li>',_=!0):!0===isNaN(T)&&(O+='<li class="horiz-rule-radioview">'+T+"</li>"):"genre"==o&&e[l][o].split(", ")[0]!=E.split(", ")[0]?O+='<li class="horiz-rule-radioview">'+e[l][o].split(", ")[0]+"</li>":"name"!=o&&"genre"!=o&&e[l][o]!=E&&(O+='<li class="horiz-rule-radioview">'+e[l][o]+("bitrate"==o?" kbps":"")+"</li>")}var U="local"==e[l].logo?"imagesw/radio-logos/thumbs/"+e[l].name+".jpg":e[l].logo;O+='<li id="ra-'+(l+1)+'" data-path="RADIO/'+e[l].name+".pls",O+='"><div class="db-icon db-song db-browse db-action">'+t+U+'"><div class="cover-menu" data-toggle="context" data-target="#context-menu-radio-item"></div></div><div class="db-entry db-song db-browse"></div>',O+=w,O+=j,O+='<span class="station-name">'+e[l].name+"</span>",O+=M,O+=P,O+=L,O+=I,O+="</li>",E=e[l][o]}$("ul.database-radio").html(O)})}function updTimeKnob(e){if("Radio station"==MPD.json.artist&&void 0===MPD.json.duration){var t="";$("#total").html("").addClass("total-radio"),$("#playbar-mtime").css("display","block"),$("#playbar-mtotal").hide()}else{t=formatSongTime(e);$("#total").removeClass("total-radio"),$("#playbar-mtime").css("display",""),$("#playbar-mtotal").show()}return t}function refreshTimer(e,t,o){$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("destroy"),"play"==o||"pause"==o?("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?($("#countdown-display").countdown({since:-e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:-e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})):($("#countdown-display").countdown({until:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({until:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})),"pause"==o&&$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause")):"stop"==o&&("1"==SESSION.json.timecountup||0==parseInt(MPD.json.time)?($("#countdown-display").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})):($("#countdown-display").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({until:0,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})),$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause"))}function refreshTimeKnob(){var e,t;if(window.clearInterval(UI.knob),e=parseInt(MPD.json.song_percent),t=parseInt(MPD.json.time)/1e3,UI.mobile?$("#timetrack").val(10*e).trigger("change"):-1!==currentView.indexOf("playback")?$("#time").val(10*e).trigger("change"):$("#playbar-timetrack").val(10*e).trigger("change"),"stop"===MPD.json.state?($("#countdown-display").countdown("destroy"),UI.mobile?($("#m-total, #m-countdown, #playbar-mcount").html("00:00"),$("#playbar-mtotal").html("&nbsp;/&nbsp;00:00")):$("#playbar-total, #playbar-countdown, #countdown-display").html("00:00")):"Radio station"==MPD.json.artist&&void 0===MPD.json.duration?UI.mobile?$("#timeline").hide():($("#playbar-timeline").css("display","none"),$("#playbar-title").css("padding-bottom","0")):UI.mobile?$("#timeline").show():($("#playbar-timeline").show(),$("#playbar-title").css("padding-bottom","1rem")),"play"===MPD.json.state){var o=$("#timetrack"),a=($("playbar-#timetrack"),$("#time")),s=currentView.indexOf("playback");UI.knob=setInterval(function(){(UI.mobile||-1==s||1==coverView)&&(timeSliderMove||(syncTimers(),UI.mobile&&o.val(10*e).trigger("change"))),e+=0===t?.5:.1,UI.mobile||(0===t&&e>100&&(window.clearInterval(UI.knob),UI.knobPainted=!0),a.val(10*e).trigger("change"))},1e3*t)}}function formatSongTime(e){var t,o;return isNaN(parseInt(e))?"":((t=Math.floor(e/3600))>0?t+":":"")+((o=(o=Math.floor(e/60))<60?o:o%60)<10?"0"+o:o)+":"+((e%=60)<10?"0"+e:e)}function formatTotalTime(e){var t,o,a,s,r;return isNaN(parseInt(e))?t="":(s=0==(o=~~(e/3600))?"":1==o?o+" hour":o+" hours",r=0==(a=~~((e%=3600)/60))?"":1==a?a+" min":a+" mins",t=o>0?a>0?s+" "+r:s:r),formatNumCommas(t)}function formatNumCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function countdownRestart(e){$("#countdown-display, #m-countdown, #playbar-countdown, #playbar-mcount").countdown("destroy"),$("#countdown-display").countdown({since:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"}),$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown({since:e,compact:!0,format:"hMS",layout:"{h<}{hn}{sep}{h>}{mnn}{sep}{snn}"})}function setVolume(e,t){e=(e=(e=parseInt(e))>GLOBAL.mpdMaxVolume?GLOBAL.mpdMaxVolume:e)<0?0:e,"0"==SESSION.json.volmute?(SESSION.json.volknob=e.toString(),sendVolCmd("POST","updvolume",{volknob:SESSION.json.volknob},!0)):(0==e&&"mute"==t?sendMpdCmd("setvol 0"):SESSION.json.volknob=e.toString(),$.post("command/moode.php?cmd=updcfgsystem",{volknob:SESSION.json.volknob}))}function customScroll(e,t,o){var a,s,r,n,i,l,c,d;switch(o=void 0===o?200:o,e){case"folder":s=a="#database",r=4;break;case"playlist":if(isNaN(t))return;a="#playlist",s="#container-playlist",r=6;break;case"cv-playlist":if(isNaN(t))return;s=a="#cv-playlist",r=6;break;case"genres":s=a="#lib-genre",r=6;break;case"artists":s=a="#lib-artist",r=6;break;case"albums":case"albumcovers":s=a="albums"==e?"#lib-album":"#lib-albumcover",r=6,t="albums"==e?t:t+1;break;case"tracks":a="#trackscontainer",s="#lib-file",r=600;break;case"radio":case"radio_headers":s=a="#database-radio",r="radio"==e?6:600}d=null!=$(a+" ul li:nth-child("+t+")").position()?$(a+" ul li:nth-child("+t+")").position().top:0,n=parseInt($(s).height()/r),c=(l=d+(i=$(s).scrollTop())-n)>i?"+="+Math.abs(l-i)+"px":"-="+Math.abs(l-i)+"px",0==t?$(s).scrollTo(0,o):l>0?$(s).scrollTo(c,o):$(s).scrollTo(0,o)}function updateClockRadioCfgSys(){$.post("command/moode.php?cmd=updcfgsystem",{clkradio_mode:SESSION.json.clkradio_mode,clkradio_item:SESSION.json.clkradio_item.replace(/'/g,"''"),clkradio_name:SESSION.json.clkradio_name.replace(/'/g,"''"),clkradio_start:SESSION.json.clkradio_start,clkradio_stop:SESSION.json.clkradio_stop,clkradio_volume:SESSION.json.clkradio_volume,clkradio_action:SESSION.json.clkradio_action},function(){$.get("command/moode.php?cmd=updclockradio")})}function setLibraryThumbnailCols(e){var t={6:"15vw,45vw",7:"13vw,30vw",8:"11vw,22vw"}[e].split(",");document.body.style.setProperty("--thumbcols",t[0]),document.body.style.setProperty("--mthumbcols",t[1])}function importBgImage(e){if(e[0].size>1e6)$("#error-bgimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-bgimage").text(""),UI.bgImgChange=!0,imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#current-bgimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-bgimage").css("margin-left","60px"),URL.revokeObjectURL(imgUrl);var t=new FileReader;t.onload=function(e){var o=t.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setbgimage",{blob:o})},t.readAsDataURL(e[0])}else $("#error-bgimage").text("Image format must be JPEG")}function newLogoImage(e){if(e[0].size>1e6)$("#error-new-logoimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-new-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-new-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-new-logoimage").css("margin-left","60px"),$("#new-station-tags").css("margin-top","30px");var t=$("#new-station-name").val();URL.revokeObjectURL(imgUrl);var o=new FileReader;o.onload=function(e){var a=o.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:a})},o.readAsDataURL(e[0])}else $("#error-new-logoimage").text("Image format must be JPEG")}function editLogoImage(e){if(e[0].size>1e6)$("#error-edit-logoimage").text("Image must be less than 1MB in size");else if("image/jpeg"==e[0].type){$("#error-edit-logoimage").text(""),imgUrl=(URL||webkitURL).createObjectURL(e[0]),$("#preview-edit-logoimage").html("<img src='"+imgUrl+"' />"),$("#info-toggle-edit-logoimage").css("margin-left","60px");var t=$("#edit-station-name").val();URL.revokeObjectURL(imgUrl);var o=new FileReader;o.onload=function(e){var a=o.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=setlogoimage",{name:t,blob:a})},o.readAsDataURL(e[0])}else $("#error-edit-logoimage").text("Image format must be JPEG")}function importStationPkg(e){if(e[0].size>75e6)$("#import-export-msg").text("ZIP file must be less than 75MB in size");else{$("#import-export-msg").text("Importing..."),objUrl=(URL||webkitURL).createObjectURL(e[0]),URL.revokeObjectURL(objUrl);var t=new FileReader;t.onload=function(e){var o=t.result.match(/,(.*)$/)[1];$.post("command/moode.php?cmd=import_stations",{blob:o},function(){$("#import-export-msg").text("Import complete"),$("#import-station-pkg").val("")})},t.readAsDataURL(e[0])}}function setClkRadioCtls(e){"Disabled"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!0),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):"Sleep Timer"==e?($("#clockradio-ctl-grp1 *").prop("disabled",!0),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!0)):($("#clockradio-ctl-grp1 *").prop("disabled",!1),$("#clockradio-ctl-grp2 *").prop("disabled",!1),$("#clockradio-ctl-grp3 *").prop("disabled",!1))}function rgbToHsl(e){var t,o,a=(e=(e=e.substr(4)).slice(0,e.length-1)).split(","),s=a[0]/255,r=a[1]/255,n=a[2]/255,i=Math.min(s,r,n),l=Math.max(s,r,n),c=l-i;return l===i?t=0:s===l?t=(r-n)/c:r===l?t=2+(n-s)/c:n===l&&(t=4+(s-r)/c),(t=Math.min(60*t,360))<0&&(t+=360),o=(i+l)/2,[t/=360,l===i?0:o<=.5?c/(l+i):c/(2-l-i),o]}function hslToRgb(e){var t,o,a,s,r,n=e[0],i=e[1],l=e[2];if(0===i)return[r=Math.round(255*l),r,r];t=2*l-(o=l<.5?l*(1+i):l+i-l*i),s=[0,0,0];for(var c=0;c<3;c++)(a=n+1/3*-(c-1))<0&&a++,a>1&&a--,r=6*a<1?t+6*(o-t)*a:2*a<1?o:3*a<2?t+(o-t)*(2/3-a)*6:t,s[c]=Math.round(255*r);return s}function hslToRgba(e,t){var o,a,s,r,n,i=e[0],l=e[1],c=e[2];if(0===l)return[n=Math.round(255*c),n,n];o=2*c-(a=c<.5?c*(1+l):c+l-c*l),r=[0,0,0];for(var d=0;d<3;d++)(s=i+1/3*-(d-1))<0&&s++,s>1&&s--,n=6*s<1?o+6*(a-o)*s:2*s<1?a:3*s<2?o+(a-o)*(2/3-s)*6:o,r[d]=Math.round(255*n);return"rgba(".concat(r[0],",",r[1],",",r[2],",",t,")")}function rgbaToRgb(e,t,o,a){return"rgba("+Math.round((1-e)*a[0]+e*o[0])+", "+Math.round((1-e)*a[1]+e*o[1])+", "+Math.round((1-e)*a[2]+e*o[2])+", "+t+")"}function splitColor(e){var t=e.slice(5,e.length-1).split(",");return[t[0],t[1],t[2],t[3]]}function splitRGB(e){var t,o=(t=(t=e.substr(4)).slice(0,t.length-1)).split(",");return[o[0],o[1],o[2]]}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,o,a){return t+t+o+o+a+a});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}function str2rgba(e){return"rgba("+e+")"}function str2hex(e){return"#"+e}function dbFastSearch(){return $("#dbsearch-alltags").val($("#dbfs").val()),$("#db-search-submit").click(),!1}function btnbarfix(e,t){var o=splitColor(e),a=hexToRgb(t),s=0;if(SESSION.json.alphablend<.85&&(s=.9-SESSION.json.alphablend)>.4&&(s=.4),tempy=s<.15?.25:.1+s,document.body.style.setProperty("--btnbarcolor",getYIQ(e)>127?"rgba(32,32,32,"+tempy+")":"rgba(224,224,224,"+tempy+")"),tempcolor=rgbaToRgb(.7-s,"0.2",o,a),document.body.style.setProperty("--btnshade",tempcolor),tempcolor=rgbaToRgb(.8-s,"0.6",o,a),document.body.style.setProperty("--btnshade2",tempcolor),tempcolor=rgbaToRgb(.45,"1.0",o,a),document.body.style.setProperty("--textvariant",tempcolor),tempcolor=rgbaToRgb(.6,".7",o,a),document.body.style.setProperty("--btnshade3",tempcolor),document.body.style.setProperty("--btnshade4",getYIQ(e)>127?"rgba(32,32,32,0.10)":"rgba(208,208,208,0.17)"),$("#content").hasClass("visacc")?op=.95:op=.9,document.body.style.setProperty("--modalbkdr",rgbaToRgb(.95,op,o,a)),$("#content").hasClass("visacc"))-1==currentView.indexOf("playback")||"No"==SESSION.json.adaptive?UI.accenta=themeMcolor:UI.accenta=adaptMcolor;else{var r=hexToRgb(accentColor);UI.accenta=rgbaToRgb(.3-s,.75,o,r)}document.body.style.setProperty("--btnbarback",rgbaToRgb(.9,".9",o,a)),document.body.style.setProperty("--config_modal_btn_bg","rgba(128,128,128,0.12)")}function getYIQ(e){var t=e.match(/\d+/g);return parseInt((299*t[0]+587*t[1]+114*t[2])/1e3)}function setColors(){document.body.style.setProperty("--themebg",themeBack);var e=getYIQ(themeBack)>127;-1!==currentView.indexOf("playback")&&"Yes"==SESSION.json.adaptive?(e=getYIQ(adaptBack)>127,document.body.style.setProperty("--adaptbg",adaptBack),document.body.style.setProperty("--adapttext",adaptMcolor),document.body.style.setProperty("--adaptmbg",adaptMback),btnbarfix(adaptBack,adaptColor)):(document.body.style.setProperty("--adaptbg",themeBack),document.body.style.setProperty("--adapttext",themeMcolor),document.body.style.setProperty("--adaptmbg",themeMback),btnbarfix(themeBack,themeColor)),lastYIQ!==e&&(lastYIQ=e,e?(document.body.style.setProperty("--timethumb",'url("'+thumbd+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbd+'")'),document.body.style.setProperty("--timecolor","rgba(96,96,96,0.25)"),document.body.style.setProperty("--trackfill","rgba(48,48,48,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-d.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(32,32,32,0.06)",fgColor:UI.accenta})},KNOBCOLOR_TIMEOUT)):(document.body.style.setProperty("--timethumb",'url("'+thumbw+'")'),document.body.style.setProperty("--fatthumb",'url("'+fatthumbw+'")'),document.body.style.setProperty("--timecolor","rgba(240,240,240,0.25)"),document.body.style.setProperty("--trackfill","rgba(240,240,240,1.0)"),document.body.style.setProperty("--radiobadge",'url("../images/radio-l.svg")'),setTimeout(function(){$(".playbackknob, .volumeknob").trigger("configure",{bgColor:"rgba(224,224,224,0.09)",fgColor:UI.accenta})},KNOBCOLOR_TIMEOUT)))}function updEqgFreq(e,t){$(e).html(t)}function updEqpMasterGain(e,t){$(e).html(t+" dB")}function updEqpFreq(e,t,o){$(e).html(o+" Hz"),$(t).val(o)}function updEqpMasterGainSlider(e){var t="master-gain-up"==e?.1:-.1,o=(parseFloat($("#master-gain-slider").val())+t).toFixed(1);o=o>24?24:o<-24?-24:o,$("#master-gain-slider").val(o),$("#master-gain").html(o+" dB")}function getCSSRule(e){for(var t=0;t<document.styleSheets.length;t++)for(var o=document.styleSheets[t].cssRules,a=0;a<o.length;a++){var s=o[a];if(s.selectorText==e)return s}}function themeToColors(e){switch(e){case"Amethyst":var t="#8e44ad",o="rgba(142,68,173,0.71)";break;case"Bluejeans":t="#1a439c",o="rgba(26,67,156,0.71)";break;case"Carrot":t="#d35400",o="rgba(211,84,0,0.71)";break;case"Emerald":t="#27ae60",o="rgba(39,174,96,0.71)";break;case"Fallenleaf":t="#cb8c3e",o="rgba(203,140,62,0.71)";break;case"Grass":t="#7ead49",o="rgba(126,173,73,0.71)";break;case"Herb":t="#317589",o="rgba(49,117,137,0.71)";break;case"Lavender":t="#876dc6",o="rgba(135,109,198,0.71)";break;case"River":t="#2980b9",o="rgba(41,128,185,0.71)";break;case"Rose":t="#c1649b",o="rgba(193,100,155,0.71)";break;case"Silver":t="#999999",o="rgba(153,153,153,0.71)";break;case"Turquoise":t="#16a085",o="rgba(22,160,133,0.71)";break;default:t="#c0392b",o="rgba(192,57,43,0.71)"}return document.body.style.setProperty("--accentxts",t),document.body.style.setProperty("--accentxta",o),t}function listLook(e,t,o){itemNum=0,"#"!=o&&("radio"==t?$("#"+e).each(function(){if(removeArticles($(this).children("span").text().toLowerCase()).substr(0,1)==o)return!1;itemNum++}):"radio_headers"==t?$("#"+e).each(function(){if(($(this).hasClass("horiz-rule-radioview")?removeArticles($(this).text().toLowerCase()):"").substr(0,1)==o)return!1;itemNum++}):$("#"+e).each(function(){if(removeArticles($(this).text().toLowerCase()).substr(0,1)==o)return!1;itemNum++})),itemNum!=$("#"+e).length&&customScroll(t,itemNum,200)}function storeRadioPos(e){$.post("command/moode.php?cmd=updcfgsystem",{radio_pos:e})}function storeLibPos(e){$.post("command/moode.php?cmd=updcfgsystem",{lib_pos:e[0]+","+e[1]+","+e[2]})}function syncTimers(){var e=$("#countdown-display").text();if(e!=GLOBAL.lastTimeCount){if(UI.mobile)$("#m-countdown").text(e),$("#playbar-mcount").text(e);else if(coverView||-1==currentView.indexOf("playback")){$("#playbar-countdown").text(e);var t=e.split(":"),o=$("#playbar-total").text().split(":");switch(t.length){case 1:var a=parseInt(t[0]);break;case 2:a=parseInt(60*t[0])+parseInt(t[1]);break;case 3:a=parseInt(3600*t[0])+parseInt(60*t[1])+parseInt(t[2])}switch(o.length){case 1:var s=parseInt(o[0]);break;case 2:s=parseInt(60*o[0])+parseInt(o[1]);break;case 3:s=parseInt(3600*o[0])+parseInt(60*o[1])+parseInt(o[2])}"1"==SESSION.json.timecountup?g=a/s*100:g=100-a/s*100,$("#playbar-timetrack").val(10*g),g<50?g="calc("+g+"% + 2px)":g="calc("+g+"% - 2px)",$("#playbar-timeline .timeline-progress").css("width",g.toString())}else UI.knobPainted=!1;GLOBAL.lastTimeCount=e}}function makeActive(e,t,o){switch(UI.mobile&&($("#playback-controls").css("display",""),$("#content").css("height","100vh")),$("#content .tab-pane, .viewswitch button").removeClass("active"),$(e+","+t).addClass("active"),$.post("command/moode.php?cmd=updcfgsystem",{current_view:o}),currentView=o,setColors(),setLibMenuHeader(),$("#viewswitch span.pane").hide(),o){case"radio":lazyLode("radio"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").hide(),$("#viewswitch .album-view-btn").removeClass("menu-separator"),$(".radio-view-btn .pane").show();break;case"folder":$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").hide(),$("#viewswitch .album-view-btn").removeClass("menu-separator"),$(".folder-view-btn .pane").show();break;case"album":lazyLode("album"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").show(),$("#viewswitch .album-view-btn").addClass("menu-separator"),$(".album-view-btn .pane").show(),$("#library-panel").addClass("covers").removeClass("tag"),"Hide tracks"==$("#tracklist-toggle").text().trim()?($("#bottom-row").css("display","flex"),$("#lib-albumcover").css("height","calc(47% - 2em)"),$("#index-albumcovers").hide()):($("#bottom-row").css("display",""),$("#lib-albumcover").css("height","100%"),$("#index-albumcovers").show());break;case"tag":lazyLode("tag"),$("#viewswitch-search, #viewswitch .view-all, #viewswitch .view-recents").show(),$("#viewswitch .album-view-btn").addClass("menu-separator"),$(".tag-view-btn .pane").show(),$("#library-panel").addClass("tag").removeClass("covers"),"Yes"==SESSION.json.library_show_genres?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre")}}function setLibMenuHeader(){var e=UI.mobile?"":"Browse by ";"radio"==currentView?(e+="Radio Stations",GLOBAL.searchRadio&&(e=GLOBAL.searchRadio)):"folder"==currentView?(e+="Folders",GLOBAL.searchFolder&&(e=GLOBAL.searchFolder)):"album"!=currentView&&"tag"!=currentView||(GLOBAL.searchLib&&"all"==GLOBAL.musicScope?e=GLOBAL.searchLib:(e+="album"==currentView?SESSION.json.library_albumview_sort:SESSION.json.library_tagview_sort,$(".view-recents span").hide(),$(".view-all span").hide(),"recent"==GLOBAL.musicScope?($(".view-recents span").show(),LIB.recentlyAddedClicked=!0,e="Recently Added ("+getParamOrValue("param",SESSION.json.library_recently_added)+")"):($(".view-all span").show(),LIB.recentlyAddedClicked=!1),LIB.filters.genres.length&&(e="Browse "+LIB.filters.genres[0]),LIB.filters.artists.length&&(e="Albums by "+LIB.filters.artists[0]))),$("#menu-header").text(e)}function lazyLode(e){if(!GLOBAL.nativeLazyLoad){var t,o;switch(e){case"radio":o="img.lazy-radioview",t="#radiocovers";break;case"tag":"Yes"==SESSION.json.library_tagview_covers&&(o="img.lazy-tagview",t="#lib-album");break;case"album":o="img.lazy-albumview",t="#lib-albumcover";break;case"playlist":o="img.lazy-playlistview",t="#playlist";break;case"cv-playlist":o="img.lazy-playlistview",t="#cv-playlist"}o&&t&&setTimeout(function(){$(o).lazyload({container:$(t)})},LAZYLOAD_TIMEOUT)}}function setFontSize(){var e=getParamOrValue("value",SESSION.json.font_size);UI.mobile&&(e+=.3),document.body.style.setProperty("--pbfont","calc("+e+"rem + 1vmin)")}function volMuteSwitch(){if("0"==SESSION.json.volmute){SESSION.json.volmute="1";var e=0,t="mute"}else{SESSION.json.volmute="0";e=SESSION.json.volknob,t="unmute"}$.post("command/moode.php?cmd=updcfgsystem",{volmute:SESSION.json.volmute},function(){setVolume(e,t)})}function submitLibraryUpdate(e){0==GLOBAL.libLoading?(GLOBAL.libLoading=!0,GLOBAL.libRendered=!1,mpdDbCmd("update_library",e),notify("update_library",e)):notify("library_updating")}$('input[type="range"]').change(function(){var e=($(this).val()-$(this).attr("min"))/($(this).attr("max")-$(this).attr("min"))*100;e<50?e+=1:e-=1,$(".timeline-progress").css("width",e+"%")}),$("#timetrack, #playbar-timetrack").bind("touchstart mousedown",function(e){timeSliderMove=!0,$("#m-countdown, #playbar-countdown, #playbar-mcount").countdown("pause")}),$("#timetrack, #playbar-timetrack").bind("touchend mouseup",function(e){var t,o;t=(o=parseInt(MPD.json.time))/1e3;var a=Math.floor($(this).val()*t);a>o-2&&(a=o-2),sendMpdCmd("seek "+MPD.json.song+" "+a),timeSliderMove=!1}),$("#currentsong").click(function(e){if(UI.mobile){var t,o,a=parseInt(MPD.json.song);o=$("#playlist ul li:nth-child("+(a+1)+")").position().top,parseInt($("#playlist").height()/3),$("#playlist").scrollTop(),t=o+200,$("html, body").animate({scrollTop:t},"fast")}}),$(".view-all").click(function(e){$(".view-recents span").hide(),$(".view-all span").show(),$("#menu-header").click(),GLOBAL.musicScope="all",GLOBAL.searchLib,GLOBAL.searchRadio=!1,LIB.recentlyAddedClicked=!1,LIB.filters.albums.length=0,LIB.filters.year.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),$("#searchResetLib").hide(),showSearchResetLib=!1,setLibMenuHeader()}),$(".view-recents").click(function(e){GLOBAL.musicScope="recent",$(".view-all span").hide(),$(".view-recents span").show(),LIB.recentlyAddedClicked=!0,LIB.filters.albums.length=0,LIB.filters.year.length=0,UI.libPos.fill(-2),filterLib(),renderAlbums(),storeLibPos(UI.libPos),$("#searchResetLib").hide(),showSearchResetLib=!1,$("#menu-header").text("Recently Added ("+getParamOrValue("param",SESSION.json.library_recently_added)+")")}),$(".context-menu a").click(function(e){var t=UI.dbEntry[0];if("add"==$(this).data("cmd"))mpdDbCmd("add",t),notify("add");else if("play"==$(this).data("cmd"))mpdDbCmd("play",t);else if("clradd"==$(this).data("cmd"))mpdDbCmd("clradd",t),notify("clradd"),-1==t.indexOf("/")&&"NAS"!=t&&"RADIO"!=t&&"SDCARD"!=t?$("#pl-saveName").val(t):$("#pl-saveName").val("");else if("clrplay"==$(this).data("cmd"))mpdDbCmd("clrplay",t),notify("clrplay"),-1==t.indexOf("/")&&"NAS"!=t&&"RADIO"!=t&&"SDCARD"!=t?$("#pl-saveName").val(t):$("#pl-saveName").val("");else if("update_folder"==$(this).data("cmd"))submitLibraryUpdate(t);else if("update_library"==$(this).data("cmd"))submitLibraryUpdate();else if("track_info_folder"==$(this).data("cmd"))$.post("command/moode.php?cmd=track_info",{path:t},function(e){$("#track-info-text").html(e),$("#track-info-modal").modal()},"json");else if("delsavedpl"==$(this).data("cmd"))$("#savedpl-path").html(t),$("#deletesavedpl-modal").modal();else if("editradiostn"==$(this).data("cmd"))$.post("command/moode.php?cmd=readstationfile",{path:UI.dbEntry[0]},function(e){var o=t.slice(t.lastIndexOf("/")+1);o=o.slice(0,o.lastIndexOf(".")),GLOBAL.editStationId=e.id,$("#edit-station-name").val(o),$("#edit-station-url").val(e.station),$("#edit-logoimage").val(""),$("#info-toggle-edit-logoimage").css("margin-left","60px"),$("#preview-edit-logoimage").html('<img src="../imagesw/radio-logos/thumbs/'+o+'.jpg">'),$("#edit-station-tags").css("margin-top","30px"),$("#edit-station-type span").text(getParamOrValue("param",e.type)),$("#edit-station-genre").val(e.genre),$("#edit-station-broadcaster").val(e.broadcaster),$("#edit-station-language").val(e.language),$("#edit-station-country").val(e.country),$("#edit-station-region").val(e.region),$("#edit-station-bitrate").val(e.bitrate),$("#edit-station-format").val(e.format),$("#edit-station-geo-fenced span").text(e.geo_fenced),$("#editstation-modal").modal()},"json");else if("delstation"==$(this).data("cmd"))$("#station-path").html(t.slice(0,t.lastIndexOf(".")).substr(6)),$("#deletestation-modal").modal();else if("deleteplitem"==$(this).data("cmd"))$("#delete-plitem-begpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-endpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-newpos").attr("max",UI.dbEntry[4]),$("#delete-plitem-begpos").val(t+1),$("#delete-plitem-endpos").val(t+1),$("#deleteplitems-modal").modal();else if("moveplitem"==$(this).data("cmd"))$("#move-plitem-begpos").attr("max",UI.dbEntry[4]),$("#move-plitem-endpos").attr("max",UI.dbEntry[4]),$("#move-plitem-newpos").attr("max",UI.dbEntry[4]),$("#move-plitem-begpos").val(t+1),$("#move-plitem-endpos").val(t+1),$("#move-plitem-newpos").val(t+1),$("#moveplitems-modal").modal();else if("setforclockradio"==$(this).data("cmd")||"setforclockradio-m"==$(this).data("cmd")){"setforclockradio-m"==$(this).data("cmd")&&$("#configure-modal").modal("toggle"),$("#clockradio-mode span").text(SESSION.json.clkradio_mode),"setforclockradio-m"==$(this).data("cmd")?($("#clockradio-playname").val(SESSION.json.clkradio_name),UI.dbEntry[0]="-1"):$("#clockradio-playname").val(UI.dbEntry[3]);var o=SESSION.json.clkradio_start.split(",");$("#clockradio-starttime-hh").val(o[0]),$("#clockradio-starttime-mm").val(o[1]),$("#clockradio-starttime-ampm span").text(o[2]),$("#clockradio-start-mon").prop("checked","1"==o[3]),$("#clockradio-start-tue").prop("checked","1"==o[4]),$("#clockradio-start-wed").prop("checked","1"==o[5]),$("#clockradio-start-thu").prop("checked","1"==o[6]),$("#clockradio-start-fri").prop("checked","1"==o[7]),$("#clockradio-start-sat").prop("checked","1"==o[8]),$("#clockradio-start-sun").prop("checked","1"==o[9]);var a=SESSION.json.clkradio_stop.split(",");$("#clockradio-stoptime-hh").val(a[0]),$("#clockradio-stoptime-mm").val(a[1]),$("#clockradio-stoptime-ampm span").text(a[2]),$("#clockradio-stop-mon").prop("checked","1"==a[3]),$("#clockradio-stop-tue").prop("checked","1"==a[4]),$("#clockradio-stop-wed").prop("checked","1"==a[5]),$("#clockradio-stop-thu").prop("checked","1"==a[6]),$("#clockradio-stop-fri").prop("checked","1"==a[7]),$("#clockradio-stop-sat").prop("checked","1"==a[8]),$("#clockradio-stop-sun").prop("checked","1"==a[9]),$("#clockradio-action span").text(SESSION.json.clkradio_action),$("#clockradio-volume").val(SESSION.json.clkradio_volume),setClkRadioCtls(SESSION.json.clkradio_mode),$("#clockradio-modal").modal()}else if("appearance"==$(this).data("cmd")){bgImgChange=!1;for(var s=SESSION.json.appearance_modal_state.split(","),r=0;r<5;r++)"1"==s[r]&&($("#appearance-modal div.control-group").eq(r).show(),$("#appearance-modal .accordian .dtopen").eq(r).show(),$("#appearance-modal .accordian .dtclose").eq(r).hide());$("#theme-name span").text(SESSION.json.themename),$.post("command/moode.php?cmd=readthemename",function(e){var t="";for(i=0;i<e.length;i++)t+='<li class="modal-dropdown-text"><a href="#notarget" data-cmd="theme-name-sel" style="background-color: rgb('+e[i].bg_color+')"><span class="text" style="color: #'+e[i].tx_color+'">'+e[i].theme_name+"</span></a></li>";$("#theme-name-list").html(t),$("#alpha-blend span").text(SESSION.json.alphablend),$("#adaptive-enabled span").text(SESSION.json.adaptive),$("#accent-color span").text(SESSION.json.accent_color),$("#error-bgimage").text(""),$.ajax({url:"imagesw/bgimage.jpg",type:"HEAD",success:function(){$("#remove-bgimage").show(),$("#choose-bgimage").hide(),$("#current-bgimage").html('<img src="imagesw/bgimage.jpg">'),$("#info-toggle-bgimage").css("margin-left","60px")},error:function(){$("#remove-bgimage").hide(),$("#choose-bgimage").show(),$("#current-bgimage").html(""),$("#info-toggle-bgimage").css("margin-left","5px")}}),$("#cover-backdrop-enabled span").text(SESSION.json.cover_backdrop),$("#cover-blur span").text(SESSION.json.cover_blur),$("#cover-scale span").text(SESSION.json.cover_scale),$("#instant-play-action span").text(SESSION.json.library_instant_play),$("#show-genres-column span").text(SESSION.json.library_show_genres),$("#show-tagview-covers span").text(SESSION.json.library_tagview_covers),$("#show-encoded-at span").text(getParamOrValue("param",SESSION.json.library_encoded_at)),$("#ellipsis-limited-text span").text(SESSION.json.library_ellipsis_limited_text),$("#thumbnail-columns span").text(SESSION.json.library_thumbnail_columns),$("#albumview-sort-order span").text("by "+SESSION.json.library_albumview_sort),$("#tagview-sort-order span").text("by "+SESSION.json.library_tagview_sort),$("#compilation-identifier").val(SESSION.json.library_comp_id),$("#recently-added span").text(getParamOrValue("param",SESSION.json.library_recently_added)),$("#ignore-articles").val(SESSION.json.library_ignore_articles),$("#utf8-char-filter span").text(SESSION.json.library_utf8rep),$("#hires-thumbnails span").text(SESSION.json.library_hiresthm),$("#cover-search-priority span").text(getParamOrValue("param",SESSION.json.library_covsearchpri)),$("#scnsaver-timeout span").text(getParamOrValue("param",SESSION.json.scnsaver_timeout)),$("#scnsaver-style span").text(SESSION.json.scnsaver_style),$("#font-size span").text(SESSION.json.font_size),$("#play-history-enabled span").text(SESSION.json.playhist),$("#playlist-art-enabled span").text(SESSION.json.playlist_art),$("#extra-tags").val(SESSION.json.extra_tags),$("#appearance-modal").modal()},"json")}else"scnsaver"==$(this).data("cmd")?screenSaver("1"):"viewplayhistory"==$(this).data("cmd")?$.getJSON("command/moode.php?cmd=readplayhistory",function(e){var t="";for(i=1;i<e.length;i++)t+=e[i];$("ol.playhistory").html(t),$("#playhistory-modal").modal()}):"quickhelp"==$(this).data("cmd")?($("#quickhelp").load("quickhelp.html"),$("#quickhelp-modal").modal()):"aboutmoode"==$(this).data("cmd")&&($("#sys-raspbian-ver").text(SESSION.json.raspbianver),$("#sys-kernel-ver").text(SESSION.json.kernelver),$("#sys-processor-arch").text(SESSION.json.procarch),$("#sys-hardware-rev").text(SESSION.json.hdwrrev),$("#sys-mpd-ver").text(SESSION.json.mpdver),$("#about-modal").modal());"db-"==UI.dbEntry[3].substr(0,3)&&$("#"+UI.dbEntry[3]).removeClass("active")}),$("#btn-clockradio-update").click(function(e){var t,o,a,s,r,n;SESSION.json.clkradio_mode=$("#clockradio-mode span").text(),SESSION.json.clkradio_name=$("#clockradio-playname").val(),t=1==$("#clockradio-starttime-hh").val().length?"0"+$("#clockradio-starttime-hh").val():$("#clockradio-starttime-hh").val(),o=1==$("#clockradio-starttime-mm").val().length?"0"+$("#clockradio-starttime-mm").val():$("#clockradio-starttime-mm").val(),s=1==$("#clockradio-stoptime-hh").val().length?"0"+$("#clockradio-stoptime-hh").val():$("#clockradio-stoptime-hh").val(),r=1==$("#clockradio-stoptime-mm").val().length?"0"+$("#clockradio-stoptime-mm").val():$("#clockradio-stoptime-mm").val(),a=(!0===$("#clockradio-start-mon").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-tue").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-wed").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-thu").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-fri").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-sat").prop("checked")?"1":"0")+","+(!0===$("#clockradio-start-sun").prop("checked")?"1":"0"),n=(!0===$("#clockradio-stop-mon").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-tue").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-wed").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-thu").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-fri").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-sat").prop("checked")?"1":"0")+","+(!0===$("#clockradio-stop-sun").prop("checked")?"1":"0"),SESSION.json.clkradio_start=t+","+o+","+$("#clockradio-starttime-ampm span").text()+","+a,SESSION.json.clkradio_stop=s+","+r+","+$("#clockradio-stoptime-ampm span").text()+","+n,SESSION.json.clkradio_volume=$("#clockradio-volume").val(),SESSION.json.clkradio_action=$("#clockradio-action span").text(),"Clock Radio"==SESSION.json.clkradio_mode||"Sleep Timer"==SESSION.json.clkradio_mode?($("#clockradio-icon").removeClass("clockradio-off"),$("#clockradio-icon").addClass("clockradio-on")):($("#clockradio-icon").removeClass("clockradio-on"),$("#clockradio-icon").addClass("clockradio-off")),"-1"!=UI.dbEntry[0]?$.getJSON("command/moode.php?cmd=getplitemfile&songpos="+UI.dbEntry[0],function(e){SESSION.json.clkradio_item=e,updateClockRadioCfgSys()}):updateClockRadioCfgSys(),notify("updclockradio")}),$("#btn-appearance-update").click(function(e){for(var t=!1,o=!1,a=!1,s=!1,r=!1,n=!1,i=!1,l=!1,c=!1,d=!1,m=[0,0,0,0,0],p=0;p<5;p++)"block"==$("#appearance-modal div.control-group").eq(p).css("display")&&(m[p]=1);if(SESSION.json.appearance_modal_state=m[0]+","+m[1]+","+m[2]+","+m[3]+","+m[4],SESSION.json.themename!=$("#theme-name span").text()&&(o=!0),SESSION.json.accent_color!=$("#accent-color span").text()&&(o=!0,t=!0),SESSION.json.alphablend!=$("#alpha-blend span").text()&&(o=!0),SESSION.json.adaptive!=$("#adaptive-enabled span").text()&&(o=!0),SESSION.json.cover_backdrop!=$("#cover-backdrop-enabled span").text()&&(o=!0),SESSION.json.cover_blur!=$("#cover-blur span").text()&&(o=!0),SESSION.json.cover_scale!=$("#cover-scale span").text()&&(o=!0),SESSION.json.library_instant_play!=$("#instant-play-action span").text()&&(a=!0),SESSION.json.library_show_genres!=$("#show-genres-column span").text()&&("Yes"==$("#show-genres-column span").text()?$("#top-columns").removeClass("nogenre"):$("#top-columns").addClass("nogenre")),SESSION.json.library_tagview_covers!=$("#show-tagview-covers span").text()&&(a=!0),SESSION.json.library_encoded_at!=getParamOrValue("value",$("#show-encoded-at span").text())&&(c=!0),SESSION.json.library_ellipsis_limited_text!=$("#ellipsis-limited-text span").text()&&("Yes"==$("#ellipsis-limited-text span").text()?$("#library-panel").addClass("limited"):$("#library-panel").removeClass("limited")),SESSION.json.library_thumbnail_columns!=$("#thumbnail-columns span").text()&&setLibraryThumbnailCols($("#thumbnail-columns span").text().substring(0,1)),SESSION.json.library_albumview_sort!=$("#albumview-sort-order span").text().replace("by ","")&&(a=!0),SESSION.json.library_tagview_sort!=$("#tagview-sort-order span").text().replace("by ","")&&(a=!0),SESSION.json.library_comp_id!=$("#compilation-identifier").val()&&(a=!0),SESSION.json.library_recently_added!=getParamOrValue("value",$("#recently-added span").text())&&(a=!0),SESSION.json.library_ignore_articles!=$("#ignore-articles").val()&&(a=!0),SESSION.json.library_utf8rep!=$("#utf8-char-filter span").text()&&(a=!0),SESSION.json.library_hiresthm!=$("#hires-thumbnails span").text()&&(a=!0),SESSION.json.library_covsearchpri!=getParamOrValue("value",$("#cover-search-priority span").text())&&(a=!0),SESSION.json.scnsaver_timeout!=getParamOrValue("value",$("#scnsaver-timeout span").text())&&(s=!0),SESSION.json.scnsaver_style!=$("#scnsaver-style span").text()&&(r=!0),SESSION.json.font_size!=$("#font-size span").text()&&(l=!0),SESSION.json.extra_tags!=$("#extra-tags").val()&&(n=!0),SESSION.json.playhist!=$("#play-history-enabled span").text()&&(i=!0),SESSION.json.playlist_art!=$("#playlist-art-enabled span").text()&&(d=!0),SESSION.json.themename=$("#theme-name span").text(),SESSION.json.accent_color=$("#accent-color span").text(),SESSION.json.alphablend=$("#alpha-blend span").text(),SESSION.json.adaptive=$("#adaptive-enabled span").text(),SESSION.json.cover_backdrop=$("#cover-backdrop-enabled span").text(),SESSION.json.cover_blur=$("#cover-blur span").text(),SESSION.json.cover_scale=$("#cover-scale span").text(),SESSION.json.library_instant_play=$("#instant-play-action span").text(),SESSION.json.library_show_genres=$("#show-genres-column span").text(),SESSION.json.library_tagview_covers=$("#show-tagview-covers span").text(),SESSION.json.library_encoded_at=getParamOrValue("value",$("#show-encoded-at span").text()),SESSION.json.library_ellipsis_limited_text=$("#ellipsis-limited-text span").text(),SESSION.json.library_thumbnail_columns=$("#thumbnail-columns span").text(),SESSION.json.library_albumview_sort=$("#albumview-sort-order span").text().replace("by ",""),SESSION.json.library_tagview_sort=$("#tagview-sort-order span").text().replace("by ",""),SESSION.json.library_comp_id=$("#compilation-identifier").val().trim(),SESSION.json.library_recently_added=getParamOrValue("value",$("#recently-added span").text()),SESSION.json.library_ignore_articles=$("#ignore-articles").val().trim(),SESSION.json.library_utf8rep=$("#utf8-char-filter span").text(),SESSION.json.library_hiresthm=$("#hires-thumbnails span").text(),SESSION.json.library_covsearchpri=getParamOrValue("value",$("#cover-search-priority span").text()),SESSION.json.scnsaver_timeout=getParamOrValue("value",$("#scnsaver-timeout span").text()),SESSION.json.scnsaver_style=$("#scnsaver-style span").text(),SESSION.json.font_size=$("#font-size span").text(),SESSION.json.playhist=$("#play-history-enabled span").text(),SESSION.json.extra_tags=$("#extra-tags").val(),SESSION.json.playlist_art=$("#playlist-art-enabled span").text(),1==l&&(setFontSize(),window.dispatchEvent(new Event("resize"))),1==s&&$.get("command/moode.php?cmd=resetscnsaver"),1==t&&(accentColor=themeToColors(SESSION.json.accent_color),$(".playbackknob").trigger("configure",{fgColor:accentColor}),$(".volumeknob").trigger("configure",{fgColor:accentColor})),1==o){themeColor=str2hex(THEME.json[SESSION.json.themename].tx_color),themeBack="rgba("+THEME.json[SESSION.json.themename].bg_color+","+SESSION.json.alphablend+")";var u=splitColor(adaptBack);adaptBack="rgba("+u[0]+","+u[1]+","+u[2]+","+SESSION.json.alphablend+")",themeMcolor=str2hex(THEME.json[SESSION.json.themename].tx_color),tempcolor=THEME.json[SESSION.json.themename].mbg_color.split(","),themeMback="rgba("+tempcolor[0]+","+tempcolor[1]+","+tempcolor[2]+","+themeOp+")",lastYIQ=0,"Yes"==SESSION.json.cover_backdrop&&-1===MPD.json.coverurl.indexOf("default-cover-v6")?($("#cover-backdrop").html('<img class="ss-backdrop" src="'+MPD.json.coverurl+'">'),$("#cover-backdrop").css("filter","blur("+SESSION.json.cover_blur+")"),$("#cover-backdrop").css("transform","scale("+SESSION.json.cover_scale+")")):$("#cover-backdrop").html(""),setColors()}1==d&&renderPlaylist(),$.post("command/moode.php?cmd=updcfgsystem",{themename:SESSION.json.themename,accent_color:SESSION.json.accent_color,alphablend:SESSION.json.alphablend,adaptive:SESSION.json.adaptive,cover_backdrop:SESSION.json.cover_backdrop,cover_blur:SESSION.json.cover_blur,cover_scale:SESSION.json.cover_scale,library_instant_play:SESSION.json.library_instant_play,library_show_genres:SESSION.json.library_show_genres,library_tagview_covers:SESSION.json.library_tagview_covers,library_encoded_at:SESSION.json.library_encoded_at,library_ellipsis_limited_text:SESSION.json.library_ellipsis_limited_text,library_thumbnail_columns:SESSION.json.library_thumbnail_columns,library_albumview_sort:SESSION.json.library_albumview_sort,library_tagview_sort:SESSION.json.library_tagview_sort,library_comp_id:SESSION.json.library_comp_id,library_recently_added:SESSION.json.library_recently_added,library_ignore_articles:SESSION.json.library_ignore_articles,library_utf8rep:SESSION.json.library_utf8rep,library_hiresthm:SESSION.json.library_hiresthm,library_covsearchpri:SESSION.json.library_covsearchpri,scnsaver_timeout:SESSION.json.scnsaver_timeout,scnsaver_style:SESSION.json.scnsaver_style,font_size:SESSION.json.font_size,playhist:SESSION.json.playhist,extra_tags:SESSION.json.extra_tags,appearance_modal_state:SESSION.json.appearance_modal_state,playlist_art:SESSION.json.playlist_art},function(){n||r||i||a||""!=SESSION.json.bgimage&&"No"==SESSION.json.cover_backdrop||1==UI.bgImgChange?(notify("settings_updated","Auto-refresh in 2 seconds"),setTimeout(function(){location.reload(!0)},2e3)):c?($("#ra-refresh").click(),loadLibrary()):notify("settings_updated")})}),$("#remove-bgimage").click(function(e){return e.preventDefault(),""!=$("#current-bgimage").html()&&($("#choose-bgimage").show(),$("#remove-bgimage").hide(),$("#current-bgimage").html(""),$("#cover-backdrop").css("background-image",""),$("#info-toggle-bgimage").css("margin-left","5px"),$.post("command/moode.php?cmd=rmbgimage"),UI.bgImgChange=!0),!1}),$("body").on("click",".dropdown-menu .custom-select a",function(e){var t="#"+$(this).data("cmd").substr(0,$(this).data("cmd").indexOf("-sel"));$(t+" span").text($(this).text()),"clockradio-mode-sel"==$(this).data("cmd")&&setClkRadioCtls($(this).text())}),$("#system-restart").click(function(e){UI.restart="restart",notify("restart","",8e3),$.get("command/moode.php?cmd=reboot")}),$("#system-shutdown").click(function(e){UI.restart="shutdown",notify("shutdown","",8e3),$.get("command/moode.php?cmd=poweroff")}),$(window).on("scroll",function(e){UI.mobile&&"panels"==GLOBAL.scriptSection&&-1!=currentView.indexOf("playback")&&($(window).scrollTop()>1&&!showMenuTopW?($("#playback-controls").hide(),$("#container-playlist").css("visibility","visible"),$("#menu-bottom").show(),$("#menu-top").css("height",$("#menu-top").css("line-height")),$("#menu-top").css("backdrop-filter","blur(20px)"),showMenuTopW=!0):UI.mobile&&"0"==$(window).scrollTop()&&($("#container-playlist").css("visibility","hidden"),$("#playback-controls").css("display",""),$("#menu-bottom").hide(),$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),showMenuTopW=!1))}),$("#index-genres li").on("click",function(e){listLook("genresList li","genres",$(this).text())}),$("#index-artists li").on("click",function(e){listLook("artistsList li","artists",$(this).text())}),$("#index-albums li").on("click",function(e){className=SESSION.json.library_tagview_sort.toLowerCase().split("/"),"Yes"==SESSION.json.library_tagview_covers?classPrefix="-name-art":classPrefix="-name",listLook("albumsList li "+("."+className[0]+classPrefix),"albums",$(this).text())}),$("#index-albumcovers li").on("click",function(e){listLook("albumcovers li "+("."+SESSION.json.library_albumview_sort.toLowerCase()+"-name").replace(/\/year/g,""),"albumcovers",$(this).text())}),$("#index-browse li").on("click",function(e){listLook("database li","db",$(this).text())}),$("#index-radio li").on("click",function(e){list="No grouping"==SESSION.json.radioview_sort_group.split(",")[1]?"radio":"radio_headers",listLook("radiocovers li",list,$(this).text())}),$("#coverart-url, #playback-switch").click(function(e){$("#playback-panel").hasClass("cv")?e.stopImmediatePropagation():($("#coverart-link").hide(),currentView=currentView.split(",")[1],$("#container-playlist").css("visibility","hidden"),$("#menu-top").css("height","0"),$("#menu-top").css("backdrop-filter",""),$("#menu-bottom, .viewswitch").css("display","flex"),syncTimers(),"tag"==currentView?(makeActive(".tag-view-btn","#library-panel","tag"),setTimeout(function(){UI.libPos[0]>=0&&customScroll("albums",UI.libPos[0],200)},SCROLLTO_TIMEOUT),GLOBAL.libRendered||loadLibrary()):"album"==currentView?(makeActive(".album-view-btn","#library-panel","album"),setTimeout(function(){UI.libPos[1]>=0&&(customScroll("albumcovers",UI.libPos[1],0),"Hide tracks"==$("#tracklist-toggle").text().trim()&&($("#bottom-row").css("display","flex"),$("#lib-albumcover").css("height","calc(47% - 2em)"),$("#index-albumcovers").hide()))},SCROLLTO_TIMEOUT),GLOBAL.libRendered||loadLibrary()):"radio"==currentView?(makeActive(".radio-view-btn","#radio-panel",currentView),setTimeout(function(){UI.radioPos>=0&&customScroll("radio",UI.radioPos,0)},SCROLLTO_TIMEOUT)):makeActive(".folder-view-btn","#folder-panel","folder"))}),$("#playbar-switch, #playbar-cover, #playbar-title").click(function(e){if(!coverView)if(0==currentView.indexOf("playback"))$(window).scrollTop(0);else if(currentView="playback,"+currentView,$.post("command/moode.php?cmd=updcfgsystem",{current_view:currentView}),syncTimers(),setColors(),$("#coverart-link").show(),$("#menu-header").text(""),$("#container-playlist").css("visibility",""),$("#menu-bottom, .viewswitch").css("display","none"),$("#folder-panel, #radio-panel, #library-panel").removeClass("active"),$("#playback-panel").addClass("active"),$("#playback-controls").css("display",""),UI.mobile){showMenuTopW=!1,$(window).scrollTop(0),$("#content").css("height","unset"),$("#container-playlist").css("visibility","hidden");var t=$("#countdown-display").text()?$("#m-countdown").text(t):$("#m-countdown").text("00:00")}else setTimeout(function(){customScroll("playlist",parseInt(MPD.json.song),0)},SCROLLTO_TIMEOUT)}),$("#context-backdrop").click(function(e){$("#context-backdrop").hide(),$(".context-menu").removeClass("open"),$(".context-menu-lib").removeClass("open"),"folder"==currentView||"radio"==currentView?$("#"+UI.dbEntry[3]).removeClass("active"):"tag"==currentView?($("#lib-song-"+(UI.dbEntry[0]+1).toString()).removeClass("active"),$("img.lib-coverart").removeClass("active")):"album"==currentView&&$("#albumcovers .lib-entry").eq(UI.libPos[1]).removeClass("active")}),$("#appearance-modal .h5").click(function(e){$(this).parent().children("div.control-group").slideToggle(100),$(this).parent().children(".dtclose, .dtopen").toggle()});
